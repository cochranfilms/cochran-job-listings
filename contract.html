<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>Freelancer Contracts | Cochran Films</title>

  <!-- Meta SEO -->
  <meta name="description" content="Access and sign your freelancer contract with Cochran Films. Secure, easy-to-use contract portal for approved creative collaborators." />
  <meta name="keywords" content="Cochran Films, Freelancer Contract, Sign Contract Online, Media Production Contractor, Creative Job Agreement, Freelance Videographer Contract, Onboarding, Contractor Portal" />
  <meta name="author" content="Cochran Films" />

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="Freelancer Contract Portal | Cochran Films" />
  <meta property="og:description" content="Freelancers and creatives working with Cochran Films can securely access and sign their official contracts here." />
  <meta property="og:image" content="https://static.wixstatic.com/media/aeef42_6176e450dd04427abe0bccd0a26e887e~mv2.jpg" />
  <meta property="og:url" content="https://collaborate.cochranfilms.com" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Freelancer Contract Portal | Cochran Films" />
  <meta name="twitter:description" content="Freelancers and creatives working with Cochran Films can securely access and sign their official contracts here." />
  <meta name="twitter:image" content="https://static.wixstatic.com/media/aeef42_6176e450dd04427abe0bccd0a26e887e~mv2.jpg" />

  <!-- Favicon -->
      <link rel="icon" href="https://static.wixstatic.com/media/aeef42_570164eee75f4394a4fc1cf9c62ceae0~mv2.png" type="image/png" />

  <!-- Schema Markup -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Freelancer Contracts | Cochran Films",
    "description": "Access and sign your freelancer contract with Cochran Films. Secure, easy-to-use contract portal for approved creative collaborators.",
    "url": "https://collaborate.cochranfilms.com",
    "publisher": {
      "@type": "Organization",
      "name": "Cochran Films",
      "url": "https://www.cochranfilms.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://static.wixstatic.com/media/aeef42_6176e450dd04427abe0bccd0a26e887e~mv2.jpg"
      }
    }
  }
  </script>

    <!-- Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #FFB200;
            --primary-dark: #FF9000;
            --gold: #FFD700;
            --black: #000000;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray-medium: #6c757d;
            --gray-dark: #343a40;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Login Screen Styles */
        .login-screen {
            min-height: 100vh;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .login-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(255,178,0,0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .container {
            background: rgba(0, 0, 0, 0.8);
            padding: 3rem;
            border-radius: 16px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.5),
                0 0 0 1px rgba(255,178,0,0.2);
            text-align: center;
            max-width: 450px;
            width: 100%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.3);
            position: relative;
            z-index: 2;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Expanded state for contract view */
        .login-screen.expanded {
            align-items: flex-start;
            padding: 2rem 1rem;
        }
        
        .container.expanded {
            max-width: 1200px;
            width: 100%;
            margin-top: 2rem;
        }
        
        /* Ensure login elements are COMPLETELY hidden when expanded */
        .container.expanded .login-elements,
        .login-screen.expanded .login-elements {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            overflow: hidden !important;
        }
        
        .logo {
            margin-bottom: 2rem;
        }
        
        .logo img {
            width: 140px;
            height: auto;
            filter: 
                drop-shadow(0 0 3px #FFB200)
                drop-shadow(0 0 6px #FFB200)
                drop-shadow(2px 2px 0px #000000);
            animation: logoGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes logoGlow {
            0% {
                filter: 
                    drop-shadow(0 0 3px #FFB200)
                    drop-shadow(0 0 6px #FFB200)
                    drop-shadow(2px 2px 0px #000000);
            }
            100% {
                filter: 
                    drop-shadow(0 0 5px #FFB200)
                    drop-shadow(0 0 8px #FFB200)
                    drop-shadow(2px 2px 0px #000000);
            }
        }
        
        h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .subtitle {
            color: rgba(255,255,255,0.8);
            margin-bottom: 2rem;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #FFB200;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            font-size: 1rem;
            color: #fff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        input:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.6);
            border-color: #FFB200;
            box-shadow: 0 0 0 2px rgba(255, 178, 0, 0.2);
        }
        
        .btn {
            width: 100%;
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFB200;
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn:hover::before {
            transform: scaleX(1);
        }
        
        .btn:hover {
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        .message {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 16px;
            margin-top: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
            text-align: left;
        }
        
        .message h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: #FFB200;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .success {
            border-left: 4px solid #22c55e;
        }
        
        .error {
            border-left: 4px solid #ef4444;
        }
        
        .error h2 {
            color: #ef4444;
        }
        
        .contract-link {
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            margin-right: 1rem;
            margin-top: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            display: inline-block;
            text-decoration: none;
        }
        
        .contract-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFB200;
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .contract-link:hover::before {
            transform: scaleX(1);
        }
        
        .contract-link:hover {
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        .hidden {
            display: none;
        }
        
        /* Aggressively prevent ALL browser overlays and loading indicators */
        .login-form {
            position: relative;
        }
        
        .login-form::before,
        .login-form::after {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }
        
        /* Disable ALL browser form validation and autocomplete overlays */
        input:invalid,
        input:valid,
        input:focus,
        input:hover,
        input:active {
            box-shadow: none !important;
            outline: none !important;
        }
        
        /* Force disable any loading spinners or overlays */
        *::before,
        *::after {
            animation: none !important;
        }
        
        /* Prevent browser autocomplete overlays */
        input[type="text"],
        input[type="email"] {
            -webkit-appearance: none !important;
            appearance: none !important;
        }
        
        /* Kill any potential modal overlays or loading screens */
        body > .loading-overlay,
        body > .modal-overlay,
        body > .spinner-overlay {
            display: none !important;
        }
        
        /* Disable any potential loading states */
        body.loading,
        html.loading,
        *.loading {
            pointer-events: auto !important;
            opacity: 1 !important;
        }
        

        
        .login-header {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .security-note {
            background: rgba(255,178,0,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            border: 1px solid rgba(255,178,0,0.3);
            backdrop-filter: blur(10px);
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
        }
        
        /* Login elements transition */
        .login-elements {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Hide login elements when contract is accessed */
        .login-elements.hidden {
            display: none !important;
            opacity: 0 !important;
            transform: translateY(-20px) !important;
            pointer-events: none !important;
            height: 0 !important;
            overflow: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
            visibility: hidden !important;
        }
        
        /* Success message starts hidden and fades in */
        .message.success {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .message.success:not(.hidden) {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Contract Details Styling */
        .contract-section {
            background: rgba(0, 0, 0, 0.4);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 178, 0, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .contract-section:hover {
            border-color: #FFB200;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255,178,0,0.2);
        }
        
        .contract-section h4 {
            color: var(--primary);
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
            font-family: 'Cinzel', serif;
            font-weight: 600;
        }
        
        .project-info {
            background: rgba(255, 178, 0, 0.15);
            border: 1px solid rgba(255, 178, 0, 0.3);
        }
        
        .signature-section {
            background: rgba(255, 178, 0, 0.1);
            border: 2px solid rgba(255, 178, 0, 0.3);
        }
        
        .workflow-info {
            background: rgba(255,178,0,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 1px solid rgba(255,178,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .download-instructions {
            background: rgba(255, 178, 0, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
            border: 1px solid rgba(255, 178, 0, 0.2);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .login-screen {
                padding: 1rem;
            }
            
            .container {
                padding: 2rem;
            }
            
            .container.expanded {
                padding: 1.5rem;
                margin-top: 1rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .message {
                padding: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 1.5rem;
            }
            
            .container.expanded {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .contract-section {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="container" id="mainContainer">
            <div class="logo">
                <img src="https://static.wixstatic.com/media/aeef42_d31420a75a164d2cb4508bdd7d99ca88~mv2.png" alt="Cochran Films Logo">
            </div>
            
            <!-- Login Elements - will be hidden after access -->
            <div id="loginElements" class="login-elements">
                <h1><i class="fas fa-lock"></i> Contract Access</h1>
                <p class="subtitle">Enter your details to access your personalized contract if you've been approved to join our team.</p>
                
                <div id="contractForm" class="login-form">
                    <div class="form-group">
                        <label for="freelancerName"><i class="fas fa-user"></i> Full Name</label>
                        <input type="text" id="freelancerName" placeholder="Enter your full name" autocomplete="off" spellcheck="false">
                    </div>
                    
                    <div class="form-group">
                        <label for="freelancerEmail"><i class="fas fa-envelope"></i> Email Address</label>
                        <input type="email" id="freelancerEmail" placeholder="Enter your email address" autocomplete="off" spellcheck="false">
                    </div>
                    
                    <button type="button" class="btn" onclick="performAccessCheck()">
                        <i class="fas fa-search"></i> Verify Access
                    </button>
                </div>
                
                <div class="security-note">
                    <strong><i class="fas fa-shield-alt"></i> Security Note:</strong> This system verifies your identity against our approved freelancer database. Your information is secure and will not be stored.
                </div>
                

            </div>
            
            <div id="success-message" class="message success hidden">
                <!-- Contract Header -->
                <div style="text-align: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid rgba(255, 178, 0, 0.3);">
                    <h1 style="font-family: 'Cinzel', serif; font-size: 2.2rem; color: #FFB200; margin-bottom: 0.5rem;">
                        <i class="fas fa-file-contract"></i> Your Freelance Contract
                    </h1>
                    <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem; margin: 0;">
                        Cochran Films • Digital Agreement
                    </p>
                </div>
                
                <div class="workflow-info">
                    <h3 style="color: #22c55e; margin-bottom: 1rem;"><i class="fas fa-check-circle"></i> Access Granted!</h3>
                    <p><strong>Welcome to the Cochran Films team!</strong> Your contract is ready for review and signing.</p>
                    <p>Please review all contract details carefully before proceeding with digital signature.</p>
                </div>
                
                <!-- Contract Review Section -->
                <div id="contractReview">
                    <div class="contract-section" id="contractDetailsSection">
                        <h4><i class="fas fa-file-contract"></i> Contract Details</h4>
                        <div id="contractDetails">
                            <!-- Contract details will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Digital Signature Section -->
                    <div class="contract-section signature-section" id="signatureSection">
                        <h4><i class="fas fa-signature"></i> Digital Signature</h4>
                        
                        <div class="form-group">
                            <label for="digitalSignature"><i class="fas fa-pen"></i> Type your full name to sign the contract</label>
                            <input type="text" id="digitalSignature" placeholder="Enter your full name" style="font-family: cursive; font-size: 16px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="signatureDate"><i class="fas fa-calendar"></i> Signature Date</label>
                            <input type="date" id="signatureDate">
                        </div>
                        
                        <!-- Portal Password Section -->
                        <div class="contract-section" style="background: rgba(255, 178, 0, 0.05); border: 1px solid rgba(255, 178, 0, 0.2); border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;">
                            <h4 style="color: #FFB200; margin-bottom: 1rem;"><i class="fas fa-key"></i> Set Portal Password</h4>
                            <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem; font-size: 0.9rem;">
                                Create a password for your freelancer portal access. This will allow you to view your contracts, job details, and project timeline.
                            </p>
                            
                            <div class="form-group">
                                <label for="portalPassword"><i class="fas fa-lock"></i> Portal Password</label>
                                <input type="password" id="portalPassword" placeholder="Create a secure password" minlength="6">
                                <small style="color: rgba(255,255,255,0.6); font-size: 0.8rem; margin-top: 0.25rem; display: block;">
                                    Minimum 6 characters. This password will be sent to admin for account activation.
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword"><i class="fas fa-check-circle"></i> Confirm Password</label>
                                <input type="password" id="confirmPassword" placeholder="Confirm your password">
                            </div>
                        </div>
                        
                        <button id="signContractBtn" class="btn" onclick="signContract()" disabled>
                            <i class="fas fa-signature"></i> Sign Contract
                        </button>
                        
                        <button id="downloadSignedBtn" class="contract-link" onclick="downloadSignedContract()" style="display: none;">
                            <i class="fas fa-download"></i> Download Signed Contract
                        </button>
                        
                        <div id="downloadInstructions" class="download-instructions" style="display: none;">
                            <strong><i class="fas fa-info-circle"></i> How to Download:</strong> Click the button above to open a print dialog. Choose "Save as PDF" as your destination instead of printing to a physical printer. This will save the signed contract to your computer.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contract Signed Successfully -->
            <div id="signed-message" class="success-screen" style="display: none;">
                <div class="success-icon">✅</div>
                <h2>Contract Signed Successfully!</h2>
                <p>Your contract has been digitally signed and is now legally binding.</p>
                
                <div style="text-align: left; margin: 2rem 0;">
                <div class="contract-section" style="background: rgba(34, 197, 94, 0.1); border-color: #22c55e;">
                    <h4 style="color: #22c55e;"><i class="fas fa-clipboard-check"></i> Next Steps</h4>
                        <ul style="list-style: none; padding: 0; color: rgba(255,255,255,0.9);">
                            <li style="margin-bottom: 0.5rem;">✅ Your digital signature has been recorded</li>
                            <li style="margin-bottom: 0.5rem;">✅ Contract data has been saved securely</li>
                            <li style="margin-bottom: 0.5rem;">✅ You will receive a confirmation email shortly</li>
                            <li style="margin-bottom: 0.5rem;">✅ Admin has been notified with your signed contract</li>
                            <li>📋 We have you scheduled for the job - thank you!</li>
                    </ul>
                    
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(34, 197, 94, 0.3);">
                        <h4 style="color: #22c55e; margin-bottom: 1rem;"><i class="fas fa-user-circle"></i> Access Your Portal</h4>
                        <p style="margin-bottom: 1rem; color: rgba(255,255,255,0.9);">
                            View your contracts, job details, and project timeline in your personal freelancer portal.
                        </p>
                        <a href="https://collaborate.cochranfilms.com/user-portal.html" class="contract-link" style="margin-right: 0;">
                            <i class="fas fa-external-link-alt"></i> Open Freelancer Portal
                        </a>
                    </div>
                </div>
                </div>
            </div>
            
            <div id="error-message" class="message error hidden">
                <h2><i class="fas fa-exclamation-triangle"></i> Access Not Granted</h2>
                <p>We couldn't verify your access at this time. Please check your information and try again, or contact us if you believe this is an error.</p>
                <div class="workflow-info" style="background: rgba(239, 68, 68, 0.1); border-color: #ef4444;">
                    <p><strong>Common Issues:</strong></p>
                    <ul>
                        <li>Name spelling must match exactly as provided to us</li>
                        <li>Email address must match your application</li>
                        <li>You may not be in our approved freelancer database yet</li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>



    <!-- Using browser's built-in print-to-PDF instead of html2pdf.js -->
    <!-- EmailJS for sending notifications -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    
    <script>
        // Approved freelancers database - loaded from JSON file
        let approvedFreelancers = {};
        let currentFreelancerData = null; // Store current user's data for PDF generation
        let contractSigned = false; // Track if contract has been signed
        let signatureData = null; // Store signature information
        
        // EmailJS Configuration
        const EMAILJS_CONFIG = {
            publicKey: 'p4pF3OWvh-DXtae4c',
            serviceId: 'service_t11yvru',
            templateId: 'template_6izinct', // Admin notification template
            userTemplateId: 'template_user_confirm' // User confirmation template - UPDATE THIS IN EMAILJS
        };
        
        // Global GitHub configuration
        let GITHUB_CONFIG = {
            token: null,
            owner: 'cochranfilms',
            repo: 'cochran-job-listings',
            repoOwner: 'cochranfilms',
            repoName: 'cochran-job-listings',
            branch: 'main'
        };
        
        // Load GitHub configuration from server
        async function loadGitHubConfig() {
            try {
                const response = await fetch('/api/github/info');
                if (response.ok) {
                    const config = await response.json();
                    GITHUB_CONFIG = {
                        owner: config.owner || 'cochranfilms',
                        repo: config.repo || 'cochran-job-listings',
                        repoOwner: config.owner || 'cochranfilms',
                        repoName: config.repo || 'cochran-job-listings',
                        branch: config.branch || 'main'
                    };
                    console.log('✅ GitHub configuration loaded successfully');
                    return config.tokenConfigured;
                } else {
                    console.warn('⚠️ Could not load GitHub config from server');
                    return false;
                }
            } catch (error) {
                console.warn('⚠️ Error loading GitHub config:', error);
                return false;
            }
        }
        
        function getGitHubToken() {
            // Token is handled server-side, client doesn't need it
            return 'server-handled';
        }
        
        function setGitHubToken(newToken) {
            localStorage.setItem('github_token', newToken);
            console.log('✅ GitHub token updated securely');
        }
        

        
        // Initialize EmailJS and GitHub config
        document.addEventListener('DOMContentLoaded', async function() {
            if (typeof emailjs !== 'undefined') {
                emailjs.init(EMAILJS_CONFIG.publicKey);
                console.log('✅ EmailJS initialized successfully');
            } else {
                console.warn('⚠️ EmailJS library not loaded');
            }
            
            // Load GitHub configuration
            await loadGitHubConfig();
        });
        
        // Update JSON file on GitHub via server API
        async function updateGitHubFile(filename, content, commitMessage, retryCount = 0) {
            try {
                console.log(`🔄 Updating ${filename} on GitHub via server... (attempt ${retryCount + 1})`);
                
                const response = await fetch(`/api/github/file/${filename}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: content,
                        message: commitMessage
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log(`✅ File updated successfully:`, result.commit.sha);
                    return result;
                } else {
                    const error = await response.json();
                    throw new Error(`Server API error: ${error.error}`);
                }
            } catch (error) {
                console.error(`❌ Error updating ${filename}:`, error);
                throw error;
            }
        }
        
        // ==================== PDF GENERATION & GITHUB UPLOAD ====================
        
        // Generate PDF contract content
        function generateContractPDF(contractData) {
            try {
                console.log('📄 Starting PDF generation for contract:', contractData.contractId);
                
                const { jsPDF } = window.jspdf;
                if (!jsPDF) {
                    throw new Error('jsPDF library not loaded');
                }
                
                const doc = new jsPDF();
                
                // Set up fonts and styling
                doc.setFont('helvetica');
                doc.setFontSize(12);
                
                // Header
                doc.setFontSize(20);
                doc.setTextColor(0, 0, 0);
                doc.text('COCHRAN FILMS', 105, 20, { align: 'center' });
                doc.setFontSize(16);
                doc.text('FREELANCER CONTRACT', 105, 35, { align: 'center' });
                
                // Contract ID
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Contract ID: ${contractData.contractId}`, 20, 50);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 55);
                
                // Freelancer Information
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('FREELANCER INFORMATION:', 20, 75);
                doc.setFontSize(10);
                doc.text(`Name: ${contractData.freelancerName}`, 25, 85);
                doc.text(`Email: ${contractData.freelancerEmail}`, 25, 92);
                doc.text(`Role: ${contractData.role}`, 25, 99);
                doc.text(`Location: ${contractData.location}`, 25, 106);
                doc.text(`Rate: ${contractData.rate}`, 25, 113);
                doc.text(`Project Start: ${contractData.projectStart}`, 25, 120);
                
                // Contract Terms
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('CONTRACT TERMS:', 20, 140);
                doc.setFontSize(10);
                
                const terms = [
                    '1. Freelancer agrees to provide professional services as specified.',
                    '2. Payment will be made within 24 hours of project completion.',
                    '3. All work must meet Cochran Films quality standards.',
                    '4. Professional attire (all black) is required on set.',
                    '5. Arrive 15 minutes before scheduled start time.',
                    '6. Bring valid ID and signed contract to all projects.',
                    '7. Use provided Cochran Films branded equipment.',
                    '8. Maintain professional demeanor at all times.',
                    '9. Follow all safety protocols and guidelines.',
                    '10. Respect confidentiality of project details.'
                ];
                
                let yPos = 150;
                terms.forEach((term, index) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    doc.text(term, 25, yPos);
                    yPos += 7;
                });
                
                // Signature Section
                doc.addPage();
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text('SIGNATURE SECTION:', 20, 30);
                doc.setFontSize(10);
                doc.text(`Freelancer Name: ${contractData.freelancerName}`, 25, 45);
                doc.text(`Digital Signature: ${contractData.signature}`, 25, 52);
                doc.text(`Signature Date: ${contractData.signatureDate}`, 25, 59);
                doc.text(`Contract ID: ${contractData.contractId}`, 25, 66);
                doc.text(`Signed Timestamp: ${contractData.signedDateTime}`, 25, 73);
                
                // Footer
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('This contract was digitally signed and is legally binding.', 105, 280, { align: 'center' });
                doc.text('Generated by Cochran Films Contract Portal', 105, 285, { align: 'center' });
                
                return doc;
            } catch (error) {
                console.error('❌ Error generating PDF:', error);
                throw error;
            }
        }
        
        // Upload PDF to GitHub via server API
        async function uploadPDFToGitHub(contractData) {
            try {
                console.log('📄 Generating PDF for contract:', contractData.contractId);
                
                // Generate PDF
                const doc = generateContractPDF(contractData);
                
                // Convert PDF to base64
                const pdfBase64 = doc.output('datauristring').split(',')[1];
                
                // Create filename using contract ID
                const filename = `contracts/${contractData.contractId}.pdf`;
                
                console.log('📤 Uploading PDF to GitHub via server:', filename);
                
                // Upload to GitHub via server API
                const response = await fetch(`/api/github/upload/${filename}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: pdfBase64,
                        message: `Add signed contract: ${contractData.contractId}`
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log(`✅ PDF uploaded successfully:`, result.content.download_url);
                    
                    // Update uploaded contracts tracking
                    const uploadedContract = {
                        contractId: contractData.contractId,
                        freelancerName: contractData.freelancerName,
                        freelancerEmail: contractData.freelancerEmail,
                        role: contractData.role,
                        rate: contractData.rate,
                        location: contractData.location,
                        fileName: `${contractData.contractId}.pdf`,
                        fileSize: Math.round(pdfBase64.length * 0.75), // Approximate size
                        uploadDate: new Date().toISOString(),
                        status: 'uploaded',
                        githubUrl: result.content.download_url,
                        notes: 'Automatically uploaded via contract signing'
                    };
                    
                    // Save to localStorage for immediate access
                    let existingUploads = JSON.parse(localStorage.getItem('uploadedContracts') || '[]');
                    existingUploads.push(uploadedContract);
                    localStorage.setItem('uploadedContracts', JSON.stringify(existingUploads));
                    
                    console.log('✅ Contract uploaded and tracked locally');
                    return uploadedContract;
                } else {
                    const error = await response.json();
                    throw new Error(`Server upload error: ${error.error}`);
                }
                
            } catch (error) {
                console.error('❌ Error uploading PDF to GitHub:', error);
                throw error;
            }
        }
        
        // Load freelancer data from JSON file
        async function loadFreelancerData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/cochranfilms/cochran-job-listings/main/freelancers.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                approvedFreelancers = data.approvedFreelancers || {};
                console.log('✅ Freelancer data loaded:', Object.keys(approvedFreelancers).length, 'freelancers');
            } catch (error) {
                console.error('❌ Error loading freelancer data:', error);
                console.log('📋 Using fallback freelancer data for testing');
                // Fallback to hardcoded data if JSON loading fails
                approvedFreelancers = {
                    "Francisco Flores": {
                        email: "ciscocinema@gmail.com",
                        contractUrl: "contract.html",
                        role: "Backdrop Photographer",
                        location: "6695 Church Street, Douglasville, GA 30134",
                        projectStart: "November 8, 2025 at 3:15 PM",
                        rate: "$400.00 USD (Flat)",
                        approvedDate: "2025-11-08"
                    },
                    "Test User": {
                        email: "test@example.com",
                        contractUrl: "contract.html",
                        role: "Test Role",
                        location: "Test Location",
                        projectStart: "TBD",
                        rate: "$150/day",
                        approvedDate: "2025-01-01"
                    }
                };
            }
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadFreelancerData();
            
            // Ensure main containers are visible on page load
            const loginScreen = document.getElementById('loginScreen');
            const mainContainer = document.getElementById('mainContainer');
            
            if (loginScreen) {
                loginScreen.style.display = 'flex';
                loginScreen.style.visibility = 'visible';
                console.log('✅ Login screen initialized as visible');
            }
            
            if (mainContainer) {
                mainContainer.style.display = 'block';
                mainContainer.style.visibility = 'visible';
                console.log('✅ Main container initialized as visible');
            }
            
            // Ensure form inputs are ready for user interaction
            const nameInput = document.getElementById('freelancerName');
            const emailInput = document.getElementById('freelancerEmail');
            const contractForm = document.getElementById('contractForm');
            
            if (contractForm) {
                contractForm.style.pointerEvents = 'auto';
                contractForm.style.display = 'block';
                contractForm.style.visibility = 'visible';
                console.log('✅ Contract form initialized as interactive');
            }
            
            if (nameInput) {
                nameInput.disabled = false;
                nameInput.style.pointerEvents = 'auto';
                nameInput.readOnly = false;
                console.log('✅ Name input enabled');
            }
            
            if (emailInput) {
                emailInput.disabled = false;
                emailInput.style.pointerEvents = 'auto';
                emailInput.readOnly = false;
                console.log('✅ Email input enabled');
            }
            
            // Aggressively disable any browser loading overlays (but not main containers)
            forceClearLoadingStates();
            
            // Prevent ANY form submission or navigation
            preventAllNavigation();
        });
        
        // Prevent form submission but allow normal page navigation
        function preventAllNavigation() {
            // Catch any form submission attempts
            document.addEventListener('submit', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('🚫 Blocked form submission attempt');
                return false;
            }, true);
            
            // Override form submission methods globally
            const originalSubmit = HTMLFormElement.prototype.submit;
            HTMLFormElement.prototype.submit = function() {
                console.log('🚫 Blocked programmatic form submission');
                return false;
            };
            
            // Note: Removed beforeunload prevention to allow normal page refresh
            console.log('✅ Form submission blocked, but page navigation allowed');
        }
        
        // Force clear any loading states or overlays
        function forceClearLoadingStates() {
            // Remove any potential loading classes from document
            document.body.classList.remove('loading', 'spinner', 'overlay');
            document.documentElement.classList.remove('loading', 'spinner', 'overlay');
            
            // Hide any potential loading overlays (but NEVER main containers)
            const potentialOverlays = document.querySelectorAll('.loading, .spinner, .overlay, .modal, [class*="loading"], [class*="spinner"]');
            potentialOverlays.forEach(el => {
                // Never hide main containers or login screen
                if (el && 
                    !el.classList.contains('login-screen') && 
                    el.id !== 'loginScreen' && 
                    el.id !== 'mainContainer' &&
                    !el.closest('#loginScreen') &&
                    !el.closest('#mainContainer')) {
                    el.style.display = 'none';
                    el.style.visibility = 'hidden';
                    el.style.opacity = '0';
                }
            });
            
            // ALSO check for any duplicate/stuck login form elements (not main container)
            const stuckLoginElements = document.querySelectorAll('.login-elements:not(.hidden)');
            if (stuckLoginElements.length > 1) {
                console.log('🚨 Found multiple visible login form elements, hiding extras:', stuckLoginElements.length);
                stuckLoginElements.forEach((el, index) => {
                    // Never hide the main containers or the active form
                    if (!el.classList.contains('login-screen') && 
                        el.id !== 'loginScreen' && 
                        el.id !== 'mainContainer' &&
                        el.id !== 'contractForm' && 
                        el.id !== 'loginElements') {
                        if (index > 0) { // Keep only the first one
                            el.style.display = 'none';
                            el.style.visibility = 'hidden';
                            console.log('🔨 Hidden duplicate login form element:', index);
                        }
                    }
                });
            }
            
            // Clear any loading states on form container and ensure inputs are enabled
            const formContainer = document.getElementById('contractForm');
            if (formContainer) {
                formContainer.classList.remove('loading', 'processing', 'submitting');
                formContainer.style.pointerEvents = 'auto';
                formContainer.style.display = 'block';
                formContainer.style.visibility = 'visible';
                
                // Ensure input fields are enabled and interactive
                const nameInput = document.getElementById('freelancerName');
                const emailInput = document.getElementById('freelancerEmail');
                
                if (nameInput) {
                    nameInput.disabled = false;
                    nameInput.style.pointerEvents = 'auto';
                    nameInput.style.opacity = '1';
                }
                
                if (emailInput) {
                    emailInput.disabled = false;
                    emailInput.style.pointerEvents = 'auto';
                    emailInput.style.opacity = '1';
                }
            }
        }

        function checkAccess(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            console.log('🔍 Starting access verification...');
            
            // Immediately proceed with validation - no loading screen
            performAccessCheck();
        }
        
        async function performAccessCheck() {
            const name = document.getElementById("freelancerName").value.trim();
            const email = document.getElementById("freelancerEmail").value.trim().toLowerCase();
            
            console.log('📝 Input data:', { name, email });
            
            // First, load the latest freelancer data from JSON file (prevent caching)
            try {
                const timestamp = new Date().getTime();
                const response = await fetch('https://raw.githubusercontent.com/cochranfilms/cochran-job-listings/main/freelancers.json');
                if (response.ok) {
                    const jsonData = await response.json();
                    if (jsonData.approvedFreelancers) {
                        approvedFreelancers = jsonData.approvedFreelancers;
                        console.log('✅ Loaded latest freelancer data from JSON file:', Object.keys(jsonData.approvedFreelancers));
                        console.log('🔍 Contract statuses:', Object.entries(jsonData.approvedFreelancers).map(([name, data]) => ({
                            name,
                            email: data.email,
                            contractStatus: data.contractStatus
                        })));
                    }
                }
            } catch (error) {
                console.warn('⚠️ Could not load latest freelancer data, using fallback:', error);
            }
            
            console.log('👥 Available freelancers:', Object.keys(approvedFreelancers));
            
            const successDiv = document.getElementById("success-message");
            const errorDiv = document.getElementById("error-message");
            
            if (!successDiv || !errorDiv) {
                console.error('❌ Could not find success or error message divs');
                return;
            }
            
            // Hide previous messages
            successDiv.classList.add("hidden");
            errorDiv.classList.add("hidden");
            
            // Check if freelancer exists and email matches (case-insensitive for both name and email)
            const normalizedName = name.toLowerCase();
            const matchingFreelancer = Object.keys(approvedFreelancers).find(key => 
                key.toLowerCase() === normalizedName
            );
            
            console.log('🔍 Matching logic:', { 
                normalizedName, 
                matchingFreelancer,
                expectedEmail: matchingFreelancer ? approvedFreelancers[matchingFreelancer].email.toLowerCase() : 'N/A',
                inputEmail: email
            });
            
            if (matchingFreelancer && approvedFreelancers[matchingFreelancer].email.toLowerCase() === email) {
                const freelancerData = approvedFreelancers[matchingFreelancer];
                
                // Store freelancer data for both signed and unsigned contracts
                currentFreelancerData = {
                    name: matchingFreelancer,
                    ...freelancerData
                };
                
                // Check if contract is already signed/uploaded
                if (freelancerData.contractStatus === 'signed' || freelancerData.contractStatus === 'uploaded') {
                    console.log('📋 Contract already signed for:', matchingFreelancer);
                    showAlreadySignedMessage(freelancerData);
                    return;
                }
                
                console.log('✅ Access granted for:', matchingFreelancer);
                
                // Populate contract details
                populateContractDetails();
                
                // Set default signature date to today in user's local timezone
                const today = new Date();
                const localDate = today.toLocaleDateString('en-CA'); // 'en-CA' gives YYYY-MM-DD format
                document.getElementById('signatureDate').value = localDate;
                
                // Set up signature validation now that elements exist
                setupSignatureValidation();
                
                // AGGRESSIVELY hide login elements to prevent duplication
                const loginElements = document.getElementById('loginElements');
                if (loginElements) {
                    console.log('🔨 Hiding login elements to prevent duplication');
                    loginElements.classList.add('hidden');
                    loginElements.style.display = 'none';
                    loginElements.style.visibility = 'hidden';
                    loginElements.style.opacity = '0';
                    loginElements.style.height = '0';
                    loginElements.style.overflow = 'hidden';
                    console.log('✅ Login elements hidden successfully');
                }
                
                // Show success message after a brief delay for smooth transition
                setTimeout(() => {
                    // Debug: Check ONLY the login form elements (not the main container)
                    const loginFormElements = document.querySelectorAll('#loginElements, .login-form, #contractForm');
                    loginFormElements.forEach((el, index) => {
                        console.log(`Login form element ${index}:`, {
                            id: el.id,
                            className: el.className,
                            display: window.getComputedStyle(el).display,
                            visibility: window.getComputedStyle(el).visibility,
                            opacity: window.getComputedStyle(el).opacity
                        });
                        // Only hide form elements, NOT the main login screen container
                        if (el.id !== 'loginScreen' && el.id !== 'mainContainer' && !el.classList.contains('login-screen')) {
                            if (window.getComputedStyle(el).display !== 'none') {
                                console.log('🔨 Hiding login form element:', el.id);
                                el.style.display = 'none';
                                el.style.visibility = 'hidden';
                            }
                        }
                    });
                    
                    successDiv.classList.remove("hidden");
                    
                    // Expand to show more content comfortably and ensure main containers are visible
                    const loginScreen = document.getElementById('loginScreen');
                    const mainContainer = document.getElementById('mainContainer');
                    
                    if (loginScreen) {
                        loginScreen.classList.add('expanded');
                        loginScreen.style.display = 'flex'; // Ensure it's visible
                        loginScreen.style.visibility = 'visible';
                        console.log('✅ Login screen expanded and visible');
                    }
                    
                    if (mainContainer) {
                        mainContainer.classList.add('expanded');
                        mainContainer.style.display = 'block'; // Ensure it's visible
                        mainContainer.style.visibility = 'visible';
                        console.log('✅ Main container expanded and visible');
                    }
                    
                    // Scroll to the very top of the page to show the logo
                    // Users will start at the top and can scroll down manually
                    window.scrollTo({ 
                        top: 0, 
                        behavior: 'smooth' 
                    });
                }, 400); // Wait for login elements to finish hiding
            } else {
                console.log('❌ Access denied for:', { name, email });
                
                // Access denied
                errorDiv.classList.remove("hidden");
                
                // Scroll to error message
                errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Populate contract details in the UI
        function populateContractDetails() {
            if (!currentFreelancerData) return;
            
            const data = currentFreelancerData;
            const effectiveDate = data.approvedDate || new Date().toISOString().split('T')[0];
            const role = data.role || 'Contractor';
            const location = data.location || 'Atlanta Area';
            const projectStart = data.projectStart || 'TBD';
            const rate = data.rate || '$150/day';
            
            const contractDetailsDiv = document.getElementById('contractDetails');
            contractDetailsDiv.innerHTML = `
                <!-- Basic Contract Info -->
                <div class="contract-section project-info">
                    <h4><i class="fas fa-info-circle"></i> Project Information</h4>
                    <div style="display: grid; gap: 0.75rem; margin-top: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-user" style="color: #FFB200; width: 20px;"></i> <strong>Name:</strong> ${data.name}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-envelope" style="color: #FFB200; width: 20px;"></i> <strong>Email:</strong> ${data.email}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-briefcase" style="color: #FFB200; width: 20px;"></i> <strong>Role:</strong> ${role}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-map-marker-alt" style="color: #FFB200; width: 20px;"></i> <strong>Location:</strong> ${location}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-clock" style="color: #FFB200; width: 20px;"></i> <strong>Project Start:</strong> ${projectStart}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-dollar-sign" style="color: #FFB200; width: 20px;"></i> <strong>Rate:</strong> ${rate}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-calendar" style="color: #FFB200; width: 20px;"></i> <strong>Effective Date:</strong> ${effectiveDate}</div>
                    </div>
                </div>

                <!-- Contract Terms -->
                <div class="contract-section">
                    <h4><i class="fas fa-tasks"></i> Your Responsibilities</h4>
                    <ul style="margin: 1rem 0 0 0; padding-left: 1.5rem; line-height: 1.8;">
                        <li><i class="fas fa-check-circle" style="color: #22c55e; margin-right: 0.5rem;"></i>Arrive at the project location on time</li>
                        <li><i class="fas fa-check-circle" style="color: #22c55e; margin-right: 0.5rem;"></i>Professionally manage your assigned role and responsibilities</li>
                        <li><i class="fas fa-check-circle" style="color: #22c55e; margin-right: 0.5rem;"></i>Complete the job to professional standards</li>
                        <li><i class="fas fa-check-circle" style="color: #22c55e; margin-right: 0.5rem;"></i>Use personal equipment unless otherwise arranged</li>
                        <li><i class="fas fa-check-circle" style="color: #22c55e; margin-right: 0.5rem;"></i>Maintain a respectful demeanor with staff and clients</li>
                        <li><i class="fas fa-check-circle" style="color: #22c55e; margin-right: 0.5rem;"></i>Wear company-branded gear provided (no charge)</li>
                        <li><i class="fas fa-check-circle" style="color: #22c55e; margin-right: 0.5rem;"></i>Wear all black regardless of branded gear provided</li>
                    </ul>
                </div>

                <!-- BTS Content Policy -->
                <div class="contract-section">
                    <h4><i class="fas fa-camera"></i> BTS Content & Ownership</h4>
                    <p style="margin: 1rem 0 0 0; line-height: 1.8; color: rgba(255,255,255,0.9);">
                        <i class="fas fa-info-circle" style="color: #3B82F6; margin-right: 0.5rem;"></i>
                        You may freely take and share behind-the-scenes content. Cochran Films may repost with credit. 
                        Content ownership remains with you.
                    </p>
                </div>

                <!-- Payment Terms -->
                <div class="contract-section">
                    <h4><i class="fas fa-credit-card"></i> Payment Terms</h4>
                    <p style="margin: 1rem 0 0 0; line-height: 1.8; color: rgba(255,255,255,0.9);">
                        <i class="fas fa-money-bill-wave" style="color: #10B981; margin-right: 0.5rem;"></i>
                        Payment of <strong style="color: #FFB200;">${rate}</strong> will be made no later than 24 hours after the event 
                        by the agreed method (Zelle, PayPal, etc.).
                    </p>
                </div>

                <!-- Independent Contractor -->
                <div class="contract-section">
                    <h4><i class="fas fa-shield-alt"></i> Independent Contractor</h4>
                    <p style="margin: 1rem 0 0 0; line-height: 1.8; color: rgba(255,255,255,0.9);">
                        <i class="fas fa-exclamation-triangle" style="color: #F59E0B; margin-right: 0.5rem;"></i>
                        You are not an employee. No taxes or benefits will be withheld. You handle all personal 
                        tax obligations and transportation.
                    </p>
                </div>

                <!-- Agreement -->
                <div class="contract-section signature-section">
                    <h4><i class="fas fa-handshake"></i> Agreement</h4>
                    <p style="margin: 1rem 0 0 0; line-height: 1.8; color: rgba(255,255,255,0.9);">
                        <i class="fas fa-pen-nib" style="color: #FFB200; margin-right: 0.5rem;"></i>
                        By signing below, both parties agree to the above terms and conditions. This creates a 
                        legally binding freelance agreement between you and Cochran Films.
                    </p>
                </div>
            `;
        }
        
        // Digital signature validation - set up when elements exist
        function setupSignatureValidation() {
            const signatureInput = document.getElementById('digitalSignature');
            const passwordInput = document.getElementById('portalPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const signButton = document.getElementById('signContractBtn');
            
            if (signatureInput && signButton) {
                // Function to validate all inputs
                function validateAllInputs() {
                    const signature = signatureInput.value.trim();
                    const password = passwordInput ? passwordInput.value : '';
                    const confirmPassword = confirmPasswordInput ? confirmPasswordInput.value : '';
                    const expectedName = currentFreelancerData ? currentFreelancerData.name.toLowerCase() : '';
                    
                    // Check signature
                    const signatureValid = signature.length >= 3 && signature.toLowerCase() === expectedName;
                    
                    // Check password
                    const passwordValid = password.length >= 6;
                    const passwordsMatch = password === confirmPassword;
                    
                    // Update signature input styling
                    if (signatureValid) {
                        signatureInput.style.borderColor = '#22c55e';
                    } else {
                        signatureInput.style.borderColor = signature.length >= 3 ? '#ef4444' : 'rgba(255, 178, 0, 0.5)';
                    }
                    
                    // Update password input styling
                    if (passwordInput) {
                        if (password.length >= 6) {
                            passwordInput.style.borderColor = passwordsMatch ? '#22c55e' : '#ef4444';
                        } else {
                            passwordInput.style.borderColor = 'rgba(255, 178, 0, 0.5)';
                        }
                    }
                    
                    if (confirmPasswordInput) {
                        if (confirmPassword.length > 0) {
                            confirmPasswordInput.style.borderColor = passwordsMatch ? '#22c55e' : '#ef4444';
                        } else {
                            confirmPasswordInput.style.borderColor = 'rgba(255, 178, 0, 0.5)';
                        }
                    }
                    
                    // Enable button if all validations pass
                    if (signatureValid && passwordValid && passwordsMatch) {
                        signButton.disabled = false;
                        signButton.style.opacity = '1';
                    } else {
                        signButton.disabled = true; 
                        signButton.style.opacity = '0.5';
                    }
                }
                
                // Add event listeners
                signatureInput.addEventListener('input', validateAllInputs);
                if (passwordInput) passwordInput.addEventListener('input', validateAllInputs);
                if (confirmPasswordInput) confirmPasswordInput.addEventListener('input', validateAllInputs);
                
                // Initial validation
                validateAllInputs();
            }
        }

        // Show message when contract is already signed
        function showAlreadySignedMessage(freelancerData) {
            const loginElements = document.getElementById('loginElements');
            if (loginElements) {
                loginElements.classList.add('hidden');
                loginElements.style.display = 'none';
            }
            
            const container = document.getElementById('mainContainer');
            container.innerHTML = `
                <div class="logo">
                    <img src="https://static.wixstatic.com/media/aeef42_d31420a75a164d2cb4508bdd7d99ca88~mv2.png" alt="Cochran Films Logo">
                </div>
                
                <div class="message success">
                    <div class="message-header">
                        <h2><i class="fas fa-check-circle"></i> Contract Already Signed</h2>
                    </div>
                    
                    <div class="message-content">
                        <p><strong>Hi ${freelancerData.name},</strong></p>
                        <p>Your contract has already been signed and processed!</p>
                        
                        <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 1rem;"><i class="fas fa-info-circle"></i> Contract Status</h4>
                            <div style="display: grid; grid-template-columns: 1fr; gap: 0.75rem; color: rgba(255,255,255,0.9);">
                                <div><strong>Status:</strong> ${freelancerData.contractStatus === 'uploaded' ? 'Signed & Uploaded' : 'Digitally Signed'}</div>
                                ${freelancerData.contractSignedDate ? `<div><strong>Signed Date:</strong> ${freelancerData.contractSignedDate}</div>` : ''}
                                ${freelancerData.contractUploadedDate ? `<div><strong>Processed Date:</strong> ${freelancerData.contractUploadedDate}</div>` : ''}
                                ${freelancerData.contractId ? `<div><strong>Contract ID:</strong> ${freelancerData.contractId}</div>` : ''}
                            </div>
                        </div>
                        
                        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(34, 197, 94, 0.3);">
                            <h4 style="color: #22c55e; margin-bottom: 1rem;"><i class="fas fa-user-circle"></i> Access Your Portal</h4>
                            <p style="margin-bottom: 1rem; color: rgba(255,255,255,0.9);">
                                View your contracts, job details, and project timeline in your personal freelancer portal.
                            </p>
                            <a href="https://collaborate.cochranfilms.com/user-portal.html" class="contract-link" style="margin-right: 0;">
                                <i class="fas fa-external-link-alt"></i> Open Freelancer Portal
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Sign contract function
        async function signContract() {
            const signature = document.getElementById('digitalSignature').value.trim();
            const signatureDate = document.getElementById('signatureDate').value;
            const password = document.getElementById('portalPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!signature || !signatureDate) {
                alert('❌ Please enter your signature and date to sign the contract.');
                return;
            }
            
            if (!password || password.length < 6) {
                alert('❌ Please enter a password with at least 6 characters.');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('❌ Passwords do not match. Please check your password confirmation.');
                return;
            }
            
            if (!currentFreelancerData) {
                alert('❌ Contract data not available. Please refresh and try again.');
                return;
            }
            
            // Validate signature matches name
            if (signature.toLowerCase() !== currentFreelancerData.name.toLowerCase()) {
                alert('❌ Your signature must match your full name exactly.');
                return;
            }
            
            const signButton = document.getElementById('signContractBtn');
            const originalText = signButton.textContent;
            signButton.textContent = '📝 Signing Contract...';
            signButton.disabled = true;
            
            try {
                // Store signature data
                signatureData = {
                    signature: signature,
                    date: signatureDate,
                    timestamp: new Date().toISOString(),
                    freelancerName: currentFreelancerData.name,
                    freelancerEmail: currentFreelancerData.email,
                    portalPassword: password
                };
                
                contractSigned = true;
                
                // Save signed contract data and send emails
                await saveSignedContractData();
                
                // Update UI to show contract signed successfully
                document.getElementById('success-message').classList.add('hidden');
                document.getElementById('signed-message').style.display = 'block';
                document.getElementById('signed-message').scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                console.log('Contract signed successfully!', signatureData);
                
            } catch (error) {
                console.error('Error signing contract:', error);
                signButton.textContent = originalText;
                signButton.disabled = false;
                alert('❌ There was an error processing your signature. Please try again or contact support.');
            }
        }
        
        // Save signed contract data and send emails
        async function saveSignedContractData() {
            try {
                // Generate unique contract ID for tracking
                const contractId = 'CF-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
                
                const signedContractData = {
                    contractId: contractId,
                    freelancerName: signatureData.freelancerName,
                    freelancerEmail: signatureData.freelancerEmail,
                    role: currentFreelancerData.role || 'Contractor',
                    location: currentFreelancerData.location || 'Atlanta Area',
                    projectStart: currentFreelancerData.projectStart || 'TBD',
                    rate: currentFreelancerData.rate || 'Not specified',
                    effectiveDate: currentFreelancerData.approvedDate || new Date().toISOString().split('T')[0],
                    signatureDate: signatureData.date,
                    signedTimestamp: signatureData.timestamp,
                    signature: signatureData.signature,
                    portalPassword: document.getElementById('portalPassword').value,
                    status: 'SIGNED',
                    signedDateTime: new Date().toLocaleString(),
                    // JOB-SPECIFIC CONTRACT LINKING
                    jobId: currentFreelancerData.primaryJob || 'legacy-job',
                    jobRole: currentFreelancerData.role || 'Contractor',
                    jobDescription: currentFreelancerData.projectStart ? `Project starting ${currentFreelancerData.projectStart}` : 'Contractor position',
                    deviceInfo: {
                        userAgent: navigator.userAgent.substring(0, 200),
                        timestamp: new Date().toISOString(),
                        url: window.location.href
                    }
                };

                // Update freelancer data status to "signed" (not fully processed until admin uploads)
                // Note: This will be temporary until admin uploads the signed PDF
                try {
                    // Mark as signed in local tracking
                    const signedTrackingData = {
                        [signatureData.freelancerEmail]: {
                            contractId: contractId,
                            signedDate: signatureData.date,
                            signedTimestamp: signatureData.timestamp,
                            status: 'signed'
                        }
                    };
                    
                    const existingTracking = JSON.parse(localStorage.getItem('contractSigningTracking') || '{}');
                    Object.assign(existingTracking, signedTrackingData);
                    localStorage.setItem('contractSigningTracking', JSON.stringify(existingTracking));
                    
                    console.log('📋 Contract signing tracked for admin upload workflow');
                } catch (trackingError) {
                    console.warn('⚠️ Could not update signing tracking:', trackingError);
                }
                
                console.log('✅ Signed contract data prepared:', signedContractData);
                
                // ==================== AUTOMATIC PDF UPLOAD ====================
                try {
                    console.log('📄 Starting automatic PDF generation and upload...');
                    
                    // Add a small delay before PDF upload to ensure GitHub API is ready
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Upload PDF to GitHub FIRST
                    const uploadedContract = await uploadPDFToGitHub(signedContractData);
                    
                    // Update contract status to uploaded
                    signedContractData.status = 'UPLOADED';
                    signedContractData.uploadedContract = uploadedContract;
                    
                    console.log('✅ PDF automatically uploaded to GitHub:', uploadedContract.githubUrl);
                    
                    // WAIT 5 seconds before updating JSON files to avoid conflicts
                    console.log('⏳ Waiting 5 seconds before updating JSON files...');
                    await new Promise(resolve => setTimeout(resolve, 5000));
                    
                    // Update success message to reflect instant availability
                    setTimeout(() => {
                        const signedMessage = document.getElementById('signed-message');
                        if (signedMessage) {
                            const uploadStatus = document.createElement('div');
                            uploadStatus.style.cssText = 'margin-top: 15px; padding: 10px; background: #e8f5e8; border: 1px solid #4caf50; border-radius: 5px; color: #2e7d32;';
                            uploadStatus.innerHTML = '🚀 <strong>Contract signed and uploaded!</strong><br>Your PDF is now available for download in your freelancer portal.';
                            signedMessage.appendChild(uploadStatus);
                        }
                    }, 1000);
                    
                } catch (uploadError) {
                    console.warn('⚠️ PDF upload failed (contract still signed):', uploadError);
                    
                    // Show partial success message
                    setTimeout(() => {
                        const signedMessage = document.getElementById('signed-message');
                        if (signedMessage) {
                            const uploadStatus = document.createElement('div');
                            uploadStatus.style.cssText = 'margin-top: 15px; padding: 10px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 5px; color: #856404;';
                            uploadStatus.innerHTML = '⚠️ <strong>Contract signed successfully!</strong><br>PDF upload failed, but your contract is saved. Admin will process it manually.';
                            signedMessage.appendChild(uploadStatus);
                        }
                    }, 1000);
                }
                
                // Save to localStorage (immediate backup)
                let existingContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
                existingContracts.push(signedContractData);
                localStorage.setItem('signedContracts', JSON.stringify(existingContracts));
                
                // Securely store password for admin access
                let adminPasswords = JSON.parse(localStorage.getItem('adminPortalPasswords') || '{}');
                adminPasswords[signedContractData.freelancerEmail] = {
                    password: signedContractData.portalPassword,
                    contractId: signedContractData.contractId,
                    timestamp: new Date().toISOString(),
                    freelancerName: signedContractData.freelancerName
                };
                localStorage.setItem('adminPortalPasswords', JSON.stringify(adminPasswords));
                console.log('📱 Contract and password saved to local storage');
                
                // Update freelancers.json with the new password
                await updateFreelancersJsonWithPassword(signedContractData);
                
                // WAIT 3 seconds between JSON updates to avoid conflicts
                console.log('⏳ Waiting 3 seconds before updating uploaded-contracts.json...');
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Update uploaded-contracts.json with the new contract
                await updateUploadedContractsJson(signedContractData);
                
                // Generate PDF content for email attachment
                const pdfContent = generatePDFContent(signedContractData);
                
                // Send emails (user confirmation + admin notification)
                console.log('📧 Sending emails...');
                try {
                    // Try to send user confirmation email (optional)
                    try {
                        await sendUserConfirmationEmail(signedContractData);
                        console.log('✅ User confirmation email sent');
                    } catch (userEmailError) {
                        console.warn('⚠️ User confirmation email failed (this is OK if template not set up yet):', userEmailError);
                        // Don't fail the whole process for user email
                    }
                    
                    // Send admin notification (required)
                    await sendAdminNotificationEmail(signedContractData, pdfContent);
                    console.log('✅ Admin notification email sent');
                    
                    // Show success message
                        setTimeout(() => {
                            const signedMessage = document.getElementById('signed-message');
                            if (signedMessage) {
                                const syncStatus = document.createElement('div');
                                syncStatus.style.cssText = 'margin-top: 15px; padding: 10px; background: #e8f5e8; border: 1px solid #4caf50; border-radius: 5px; color: #2e7d32;';
                            syncStatus.innerHTML = '✅ <strong>Contract signed successfully!</strong><br>You will receive a confirmation email shortly. Your signed contract has been sent to admin.';
                                signedMessage.appendChild(syncStatus);
                            }
                        }, 1000);
                        
                } catch (emailError) {
                    console.warn('⚠️ Email sending failed:', emailError);
                    
                        // Show partial success message
                        setTimeout(() => {
                            const signedMessage = document.getElementById('signed-message');
                            if (signedMessage) {
                                const syncStatus = document.createElement('div');
                                syncStatus.style.cssText = 'margin-top: 15px; padding: 10px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 5px; color: #856404;';
                            syncStatus.innerHTML = '⚠️ <strong>Contract signed and saved locally</strong><br>Email notification failed, but your contract is saved. Please contact admin.';
                                signedMessage.appendChild(syncStatus);
                            }
                        }, 1000);
                    }
                
                // Legacy notification for compatibility
                localStorage.setItem('contractSignedNotification', JSON.stringify({
                    timestamp: new Date().toISOString(),
                    contractId: contractId,
                    action: 'NEW_CONTRACT_SIGNED',
                    emailSent: true
                }));
                
            } catch (error) {
                console.error('❌ Error saving signed contract data:', error);
                alert('⚠️ Contract was signed but there was an issue saving the data. Please contact support with your contract ID and timestamp.');
            }
        }
        
        // Update freelancers.json with password when contract is signed
        async function updateFreelancersJsonWithPassword(contractData) {
            try {
                console.log('🔄 Updating freelancers.json with password on GitHub...');
                
                // Add a small delay to ensure GitHub API is ready
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Load current freelancers.json with retry logic
                let response;
                let retryCount = 0;
                const maxRetries = 3;
                
                while (retryCount < maxRetries) {
                    try {
                        response = await fetch('/api/freelancers');
                        if (response.ok) break;
                        retryCount++;
                        if (retryCount < maxRetries) {
                            console.log(`⚠️ Retry ${retryCount} loading freelancers.json...`);
                            await new Promise(resolve => setTimeout(resolve, 2000));
                        }
                    } catch (fetchError) {
                        retryCount++;
                        if (retryCount < maxRetries) {
                            console.log(`⚠️ Fetch error, retry ${retryCount}...`);
                            await new Promise(resolve => setTimeout(resolve, 2000));
                        }
                    }
                }
                
                if (!response || !response.ok) {
                    throw new Error('Could not load freelancers.json after retries');
                }
                
                const freelancersData = await response.json();
                const approvedFreelancers = freelancersData.approvedFreelancers || {};
                
                console.log('🔍 Available freelancers in JSON:', Object.keys(approvedFreelancers));
                console.log('🔍 Looking for email:', contractData.freelancerEmail);
                
                // Find the freelancer by email (case-insensitive)
                const freelancerKey = Object.keys(approvedFreelancers).find(key => 
                    approvedFreelancers[key].email.toLowerCase() === contractData.freelancerEmail.toLowerCase()
                );
                
                if (freelancerKey) {
                    console.log('✅ Found freelancer in JSON:', freelancerKey);
                    
                    // Update the freelancer's password and contract status
                    approvedFreelancers[freelancerKey].password = contractData.portalPassword;
                    approvedFreelancers[freelancerKey].contractStatus = 'signed';
                    approvedFreelancers[freelancerKey].contractSignedDate = contractData.signedDateTime;
                    approvedFreelancers[freelancerKey].contractId = contractData.contractId;
                    
                    // Update the JSON structure
                    const updatedFreelancersData = {
                        ...freelancersData,
                        approvedFreelancers: approvedFreelancers,
                        lastUpdated: new Date().toISOString().split('T')[0],
                        totalFreelancers: Object.keys(approvedFreelancers).length
                    };
                    
                    // Update freelancers.json on GitHub directly
                    await updateGitHubFile('freelancers.json', updatedFreelancersData, `Update freelancers.json - Contract signed by ${contractData.freelancerName} - ${new Date().toLocaleString()}`);
                    
                    console.log('✅ Freelancers.json updated on GitHub with password and contract status');
                    
                    // Show success notification
                    setTimeout(() => {
                        const signedMessage = document.getElementById('signed-message');
                        if (signedMessage) {
                            const updateStatus = document.createElement('div');
                            updateStatus.style.cssText = 'margin-top: 10px; padding: 8px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; color: #155724; font-size: 0.9rem;';
                            updateStatus.innerHTML = '✅ <strong>Password updated on GitHub!</strong> Your portal access is now active.';
                            signedMessage.appendChild(updateStatus);
                        }
                    }, 2000);
                    
                } else {
                    console.warn('⚠️ Freelancer not found in freelancers.json:', contractData.freelancerEmail);
                    console.warn('⚠️ Available emails:', Object.values(approvedFreelancers).map(f => f.email));
                    
                    // Show error notification
                    setTimeout(() => {
                        const signedMessage = document.getElementById('signed-message');
                        if (signedMessage) {
                            const updateStatus = document.createElement('div');
                            updateStatus.style.cssText = 'margin-top: 10px; padding: 8px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; font-size: 0.9rem;';
                            updateStatus.innerHTML = '⚠️ <strong>Warning:</strong> Could not update password automatically. Please contact admin.';
                            signedMessage.appendChild(updateStatus);
                        }
                    }, 2000);
                }
                
            } catch (error) {
                console.error('❌ Error updating freelancers.json on GitHub:', error);
                
                // Show error notification
                setTimeout(() => {
                    const signedMessage = document.getElementById('signed-message');
                    if (signedMessage) {
                        const updateStatus = document.createElement('div');
                        updateStatus.style.cssText = 'margin-top: 10px; padding: 8px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; font-size: 0.9rem;';
                        updateStatus.innerHTML = '❌ <strong>Error:</strong> Could not update password on GitHub. Please contact admin.';
                        signedMessage.appendChild(updateStatus);
                    }
                }, 2000);
                
                // Don't fail the contract signing process for this
            }
        }
        
        // Update uploaded-contracts.json with new contract
        async function updateUploadedContractsJson(contractData) {
            try {
                console.log('🔄 Updating uploaded-contracts.json with new contract...');
                
                // Load current uploaded-contracts.json
                const response = await fetch('uploaded-contracts.json');
                let uploadedContractsData = { contracts: [], exportDate: new Date().toISOString(), totalContracts: 0 };
                
                if (response.ok) {
                    uploadedContractsData = await response.json();
                }
                
                // Create new contract entry
                const newContract = {
                    contractId: contractData.contractId,
                    freelancerName: contractData.freelancerName,
                    freelancerEmail: contractData.freelancerEmail,
                    role: contractData.role,
                    rate: contractData.rate,
                    location: contractData.location,
                    fileName: `${contractData.contractId}.pdf`,
                    fileSize: 0, // Will be updated when file is actually uploaded
                    uploadDate: new Date().toISOString(),
                    status: 'uploaded',
                    githubUrl: `https://raw.githubusercontent.com/cochranfilms/cochran-job-listings/main/contracts/${contractData.contractId}.pdf`,
                    notes: 'Automatically uploaded via contract signing',
                    contractDate: contractData.effectiveDate,
                    signedDate: contractData.signatureDate
                };
                
                // Add to contracts array
                uploadedContractsData.contracts.push(newContract);
                uploadedContractsData.totalContracts = uploadedContractsData.contracts.length;
                uploadedContractsData.exportDate = new Date().toISOString();
                
                // Update uploaded-contracts.json on GitHub
                await updateGitHubFile('uploaded-contracts.json', uploadedContractsData, `Add signed contract: ${contractData.contractId} - ${contractData.freelancerName}`);
                
                console.log('✅ Uploaded-contracts.json updated on GitHub');
                
                // Show success notification
                setTimeout(() => {
                    const signedMessage = document.getElementById('signed-message');
                    if (signedMessage) {
                        const updateStatus = document.createElement('div');
                        updateStatus.style.cssText = 'margin-top: 10px; padding: 8px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; color: #155724; font-size: 0.9rem;';
                        updateStatus.innerHTML = '✅ <strong>Contract added to portal!</strong> Your contract is now available for download.';
                        signedMessage.appendChild(updateStatus);
                    }
                }, 3000);
                
            } catch (error) {
                console.error('❌ Error updating uploaded-contracts.json:', error);
                
                // Show error notification
                setTimeout(() => {
                    const signedMessage = document.getElementById('signed-message');
                    if (signedMessage) {
                        const updateStatus = document.createElement('div');
                        updateStatus.style.cssText = 'margin-top: 10px; padding: 8px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; color: #721c24; font-size: 0.9rem;';
                        updateStatus.innerHTML = '⚠️ <strong>Warning:</strong> Could not update contract list automatically. Please contact admin.';
                        signedMessage.appendChild(updateStatus);
                    }
                }, 3000);
                
                // Don't fail the contract signing process for this
            }
        }
        
        // Send user confirmation email
        async function sendUserConfirmationEmail(contractData) {
            if (typeof emailjs === 'undefined') {
                throw new Error('EmailJS not available');
            }
            
            const userEmailParams = {
                to_email: contractData.freelancerEmail,  // Match the template variable name
                freelancer_name: contractData.freelancerName,
                contract_id: contractData.contractId,
                role: contractData.role,
                project_start: contractData.projectStart,
                rate: contractData.rate,
                location: contractData.location,
                signed_date: new Date(contractData.signedTimestamp).toLocaleDateString()
            };
            
            console.log('📧 Sending user confirmation email with template:', EMAILJS_CONFIG.userTemplateId);
            console.log('📧 User email params:', userEmailParams);
            
            return emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.userTemplateId, userEmailParams);
        }
        
        // Send admin notification email with PDF content
        async function sendAdminNotificationEmail(contractData, pdfContent) {
            if (typeof emailjs === 'undefined') {
                throw new Error('EmailJS not available');
            }
            
            const adminEmailParams = {
                // Email destination
                to_email: 'info@cochranfilms.com',
                
                // Contract basic info
                freelancer_name: contractData.freelancerName,
                freelancer_email: contractData.freelancerEmail,
                contract_id: contractData.contractId,
                role: contractData.role,
                location: contractData.location,
                rate: contractData.rate,
                signed_timestamp: new Date(contractData.signedTimestamp).toLocaleString(),
                portal_password_reference: `Password set for ${contractData.freelancerEmail} - Check admin dashboard for secure access`,
                
                // PDF content for manual upload
                signed_contract_content: pdfContent
            };
            
            console.log('📧 Sending admin notification email with template:', EMAILJS_CONFIG.templateId);
            console.log('📧 Admin email params (truncated):', {
                ...adminEmailParams,
                signed_contract_content: '[TRUNCATED - ' + pdfContent.length + ' characters]'
            });
            
            return emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.templateId, adminEmailParams);
        }
        
        // Generate PDF content 
        function generatePDFContent(contractData) {
            return `
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎬 COCHRAN FILMS - SIGNED FREELANCE AGREEMENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Contract ID: ${contractData.contractId}
Signing Date: ${new Date(contractData.signedTimestamp).toLocaleString()}
Status: DIGITALLY SIGNED & LEGALLY BINDING

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 CONTRACTOR DETAILS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Freelancer: ${contractData.freelancerName}
Email: ${contractData.freelancerEmail}
Role: ${contractData.role}
Location: ${contractData.location}
Project Start: ${contractData.projectStart}
Rate: ${contractData.rate}
Effective Date: ${contractData.effectiveDate}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✍️ DIGITAL SIGNATURES
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

COCHRAN FILMS REPRESENTATIVE:
Name: Cody Cochran
Title: Founder, Cochran Films
Signature: Cody Cochran
Date: ${contractData.effectiveDate}

CONTRACTOR:
Name: ${contractData.freelancerName}
Digital Signature: ${contractData.signature}
Date: ${contractData.signatureDate}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔐 PORTAL ACCESS INFORMATION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Portal Email: ${contractData.freelancerEmail}
Portal Password: [SECURE - Check admin dashboard]
Portal URL: https://collaborate.cochranfilms.com/user-portal.html

Note: Password has been securely stored. Add to freelancers.json for portal access activation.
Timestamp: ${new Date(contractData.signedTimestamp).toLocaleString()}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📜 CONTRACT TERMS & CONDITIONS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

CONTRACTOR RESPONSIBILITIES:
• Arrive at the project location on time
• Professionally manage their assigned role and responsibilities
• Complete the job to professional standards
• Use personal equipment unless otherwise arranged
• Maintain a respectful demeanor with staff and clients
• Wear company-branded gear provided (no charge)
• Wear all black regardless of branded gear provided

BTS CONTENT & OWNERSHIP:
The Contractor may freely take and share BTS content. Cochran Films may 
repost with credit. Content ownership remains with the Contractor.

PAYMENT TERMS:
Payment of ${contractData.rate} will be made no later than 24 hours after 
the event by the agreed method (Zelle, PayPal, etc.).

INDEPENDENT CONTRACTOR:
The Contractor is not an employee. No taxes or benefits will be withheld. 
Contractor handles all personal tax obligations and transportation.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ CONTRACT STATUS: FULLY EXECUTED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Both parties have digitally signed this agreement. This contract is 
legally binding and fully executed as of ${new Date(contractData.signedTimestamp).toLocaleString()}.

Digital verification hash: ${contractData.contractId}
            `.trim();
        }

        // Add enter key support for input fields only
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('freelancerName');
            const emailInput = document.getElementById('freelancerEmail');
            
            function handleEnterKey(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    event.stopPropagation();
                    event.stopImmediatePropagation();
                    // Small delay to prevent any race conditions
                    setTimeout(() => {
                        performAccessCheck();
                    }, 10);
                    return false;
                }
            }
            
            function handleInputChange(event) {
                // Only clear loading states occasionally, not on every keystroke
                // This prevents interference with normal typing
                clearTimeout(window.inputDebounceTimer);
                window.inputDebounceTimer = setTimeout(() => {
                    forceClearLoadingStates();
                }, 500); // Only run after user stops typing for 500ms
            }
            
            if (nameInput) {
                nameInput.addEventListener('keypress', handleEnterKey);
                // Only add input listener for debounced cleanup, not keyup
                nameInput.addEventListener('input', handleInputChange);
            }
            if (emailInput) {
                emailInput.addEventListener('keypress', handleEnterKey);
                // Only add input listener for debounced cleanup, not keyup
                emailInput.addEventListener('input', handleInputChange);
            }
        });




    </script>
</body>
</html> 

