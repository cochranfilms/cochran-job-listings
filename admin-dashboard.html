<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Cochran Films</title>
    
    <!-- Favicon to prevent 404 error -->
    <link rel="icon" href="https://static.wixstatic.com/media/aeef42_570164eee75f4394a4fc1cf9c62ceae0~mv2.png" type="image/png">
    
    <!-- Schema.org structured data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Cochran Films",
      "url": "https://cochranfilms.com",
      "logo": "https://static.wixstatic.com/media/aeef42_570164eee75f4394a4fc1cf9c62ceae0~mv2.png",
      "description": "Professional film and photography services with automated creator management system",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Douglasville",
        "addressRegion": "GA",
        "addressCountry": "US"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "email": "info@cochranfilms.com"
      },
      "sameAs": [
        "https://collaborate.cochranfilms.com"
      ]
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Cochran Films Admin Dashboard",
      "description": "Central management system for creator contracts, job listings, and automated workflows",
      "url": "https://collaborate.cochranfilms.com/admin-dashboard.html",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Creator Management",
        "Contract Automation",
        "Job Listings",
        "Payment Processing",
        "Email Notifications",
        "GitHub Integration"
      ]
    }
    </script>
    
    <!-- Content Security Policy - Allow Google APIs, EmailJS, and GitHub API -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://apis.google.com https://accounts.google.com https://ssl.gstatic.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' data: https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://apis.google.com https://accounts.google.com https://www.googleapis.com https://api.emailjs.com https://api.github.com; frame-src https://accounts.google.com;"
    
    <!-- Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- EmailJS for automated job acceptance emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <script>
        // Simple admin dashboard configuration
        let uploadedContracts = [];
        let contractsAnalytics = {};
        let performanceReviews = {};
        let projectStatus = {};
        let freelancers = [];
        let jobs = [];

        // EmailJS Configuration for Job Acceptance
        const EMAILJS_CONFIG = {
            publicKey: 'p4pF3OWvh-DXtae4c',
            serviceId: 'service_t11yvru',
            jobAcceptanceTemplateId: 'template_job_acceptance' // ‚ö†Ô∏è This template ID doesn't exist - create it in EmailJS dashboard
        };

        // Global GitHub configuration
        let GITHUB_CONFIG = {
            token: null,
            owner: 'cochranfilms',
            repo: 'cochran-job-listings',
            repoOwner: 'cochranfilms',
            repoName: 'cochran-job-listings',
            branch: 'main'
        };
        
        // Load GitHub configuration from external file
        async function loadGitHubConfig() {
            try {
                // First try to load the public config
                const response = await fetch('config/github-config-public.json');
                if (response.ok) {
                    const config = await response.json();
                    GITHUB_CONFIG = {
                        token: null, // Token needs to be set via admin dashboard
                        owner: config.repoOwner || 'cochranfilms',
                        repo: config.repoName || 'cochran-job-listings',
                        repoOwner: config.repoOwner || 'cochranfilms',
                        repoName: config.repoName || 'cochran-job-listings',
                        branch: config.branch || 'main'
                    };
                    console.log('‚úÖ GitHub configuration loaded successfully');
                    return true;
                } else {
                    console.warn('‚ö†Ô∏è Could not load GitHub config file, using fallback');
                    return false;
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Error loading GitHub config:', error);
                return false;
            }
        }
        
        // GitHub token management is now handled securely by the server
        // No client-side token handling needed - all API calls go through secure server endpoints

        // Initialize EmailJS and GitHub config
        document.addEventListener('DOMContentLoaded', async function() {
            if (typeof emailjs !== 'undefined') {
                emailjs.init(EMAILJS_CONFIG.publicKey);
                console.log('‚úÖ EmailJS initialized for job acceptance emails');
            } else {
                console.warn('‚ö†Ô∏è EmailJS library not loaded');
            }
            
            // Load GitHub configuration
            await loadGitHubConfig();
            
            // Clear any old local contract data from localStorage
            localStorage.removeItem('uploadedContracts');
            localStorage.removeItem('signedContracts');
            console.log('üßπ Cleared old local contract data from localStorage');
        });

        // Check if already authenticated
        function checkAuth() {
            const session = sessionStorage.getItem('adminDashboardAuthenticated');
            if (session === 'true') {
                isAuthenticated = true;
                showAdminInterface();
            } else {
                showLoginScreen();
            }
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminInterface').style.display = 'none';
        }

        // Show admin interface
        async function showAdminInterface() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminInterface').style.display = 'block';
            
            await loadJobs();
            await loadFreelancers();
            await loadUploadedContracts();
            await loadProjectStatus();
            await loadPerformanceReviews();
        }

        // Handle login
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple authentication
            if (username === 'admin' && password === 'Deannajack3#') {
                sessionStorage.setItem('adminDashboardAuthenticated', 'true');
                isAuthenticated = true;
                showAdminInterface();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        // Initialize login form handler
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            // Listen for payment method updates from user portal
            window.addEventListener('message', function(event) {
                if (event.data.type === 'paymentMethodUpdated') {
                    console.log('üîÑ Payment method updated by user:', event.data.email, event.data.paymentMethod);
                    // Refresh freelancer data to show updated payment methods
                    loadFreelancers();
                }
            });
        });

        // Logout
        function logout() {
            sessionStorage.removeItem('adminDashboardAuthenticated');
            isAuthenticated = false;
            showLoginScreen();
        }

        // Tab switching
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const btns = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            btns.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // ==================== CONTRACTS UPLOAD FUNCTIONALITY ====================

        // Manual upload functionality removed - contracts are now automatically uploaded via contract signing

        // Manual upload functionality removed - contracts are now automatically uploaded via contract signing

        // Manual upload functions removed - contracts are now automatically uploaded via contract signing

        // Load uploaded contracts
        async function loadUploadedContracts() {
            console.log('üîÑ Loading uploaded contracts...');
            
            try {
                const response = await fetch('/api/uploaded-contracts');
                if (response.ok) {
                    const data = await response.json();
                    uploadedContracts = data.contracts || [];
                    console.log('‚úÖ Loaded', uploadedContracts.length, 'uploaded contracts from API');
                } else {
                    console.warn('‚ö†Ô∏è Could not load uploaded contracts from API, showing empty state');
                    uploadedContracts = [];
                }
            } catch (error) {
                console.error('‚ùå Error loading uploaded contracts:', error);
                uploadedContracts = [];
            }
            
            displayUploadedContracts();
            updateContractAnalytics();
            
            console.log('‚úÖ Loaded', uploadedContracts.length, 'uploaded contracts');
        }

        // Display uploaded contracts
        function displayUploadedContracts() {
            const container = document.getElementById('uploadedContractsList');
            const countElement = document.getElementById('contractCount');
            
            if (uploadedContracts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                        <h3 style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">üìã No Contracts Uploaded Yet</h3>
                        <p>Upload signed contract PDFs using the form above</p>
                    </div>
                `;
                if (countElement) countElement.textContent = '';
                return;
            }
            
            if (countElement) countElement.textContent = `(${uploadedContracts.length} contract${uploadedContracts.length !== 1 ? 's' : ''})`;
            
            const contractsHTML = uploadedContracts.map((contract, index) => `
                <div class="item-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>${contract.freelancerName}</h3>
                        <div style="text-align: right; font-size: 0.8rem; color: rgba(255,255,255,0.6);">
                            <div>üìÅ ${contract.fileName}</div>
                            <div>üì§ ${new Date(contract.uploadDate).toLocaleDateString()}</div>
                        </div>
                    </div>
                    
                    <div class="item-meta">
                        <span>üìß ${contract.freelancerEmail}</span>
                        <span>üéØ ${contract.role}</span>
                        <span>üí∞ ${contract.rate}</span>
                        <span>üìç ${contract.location}</span>
                        ${contract.contractDate ? `<span>üìÖ ${contract.contractDate}</span>` : ''}
                    </div>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                            <div><strong>Contract ID:</strong><br>${contract.contractId}</div>
                            <div><strong>File Size:</strong><br>${(contract.fileSize / 1024).toFixed(1)} KB</div>
                        </div>
                        ${contract.notes ? `<div style="margin-top: 0.5rem;"><strong>Notes:</strong><br>${contract.notes}</div>` : ''}
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-small" onclick="downloadUploadedContract(${index})">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                        <button class="btn btn-small" onclick="viewUploadedContractDetails(${index})">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteUploadedContract(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = contractsHTML;
        }

        // Download uploaded contract
        function downloadUploadedContract(index) {
            const contract = uploadedContracts[index];
            if (!contract || !contract.fileData) {
                showNotification('‚ùå Contract file not found.', 'error');
                return;
            }
            
            const link = document.createElement('a');
            link.href = contract.fileData;
            link.download = contract.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('üìÑ Downloaded contract:', contract.fileName);
        }

        // View uploaded contract details
        function viewUploadedContractDetails(index) {
            const contract = uploadedContracts[index];
            
            const details = `
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üé¨ COCHRAN FILMS - CONTRACT DETAILS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìã BASIC INFO:
Contract ID: ${contract.contractId}
Freelancer: ${contract.freelancerName}
Email: ${contract.freelancerEmail}
Role: ${contract.role}
Rate: ${contract.rate}
Location: ${contract.location}
Contract Date: ${contract.contractDate || 'Not specified'}

üìÅ FILE INFO:
File Name: ${contract.fileName}
File Size: ${(contract.fileSize / 1024).toFixed(1)} KB
Upload Date: ${new Date(contract.uploadDate).toLocaleString()}
Status: ${contract.status}

${contract.notes ? `üìù NOTES:\n${contract.notes}\n\n` : ''}‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
            `.trim();
            
            showNotification(details, 'info');
        }

        // Delete uploaded contract
        async function deleteUploadedContract(index) {
            const contract = uploadedContracts[index];
            if (confirm(`Are you sure you want to delete the contract for ${contract.freelancerName}?\n\nContract ID: ${contract.contractId}\n\nThis action cannot be undone.`)) {
                uploadedContracts.splice(index, 1);
                
                // Automatically update GitHub
                await updateUploadedContractsOnGitHub();
                
                displayUploadedContracts();
                updateContractAnalytics();
            }
        }

        // Export contract list
        function exportContractList() {
            if (uploadedContracts.length === 0) {
                showNotification('No contracts to export.', 'warning');
                return;
            }
            
            const exportData = {
                exportDate: new Date().toISOString(),
                totalContracts: uploadedContracts.length,
                contracts: uploadedContracts.map(contract => ({
                    ...contract,
                    fileData: undefined // Remove file data from export
                }))
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `cochran-films-contracts-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            console.log('üì¶ Contract list exported');
        }

        // Export uploaded contracts for user portal access
        function exportUploadedContractsForPortal() {
            if (uploadedContracts.length === 0) {
                showNotification('No uploaded contracts to export.', 'warning');
                return;
            }
            
            const exportData = {
                lastUpdated: new Date().toISOString(),
                totalContracts: uploadedContracts.length,
                uploadedContracts: uploadedContracts
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `uploaded-contracts.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            console.log('üì¶ Uploaded contracts exported for user portal');
            showNotification('‚úÖ Uploaded contracts exported as uploaded-contracts.json\n\nUpload this file to your server so users can access their signed contracts!', 'success');
        }

        // Update contract analytics
        function updateContractAnalytics() {
            const analytics = {
                total: uploadedContracts.length,
                thisMonth: uploadedContracts.filter(c => {
                    const uploadDate = new Date(c.uploadDate);
                    const now = new Date();
                    return uploadDate.getMonth() === now.getMonth() && uploadDate.getFullYear() === now.getFullYear();
                }).length,
                roles: {},
                totalFileSize: uploadedContracts.reduce((sum, c) => sum + (c.fileSize || 0), 0)
            };
            
            // Count roles
            uploadedContracts.forEach(contract => {
                const role = contract.role || 'Unknown';
                analytics.roles[role] = (analytics.roles[role] || 0) + 1;
            });
            
            const container = document.getElementById('contractAnalytics');
            container.innerHTML = `
                <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.3);">
                    <h4 style="color: #FFB200; margin-bottom: 0.5rem;">üìä Total Contracts</h4>
                    <div style="font-size: 2rem; font-weight: bold; color: #FFB200;">${analytics.total}</div>
                </div>
                
                <div style="background: rgba(34,197,94,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(34,197,94,0.3);">
                    <h4 style="color: #22c55e; margin-bottom: 0.5rem;">üìÖ This Month</h4>
                    <div style="font-size: 2rem; font-weight: bold; color: #22c55e;">${analytics.thisMonth}</div>
                </div>
                
                <div style="background: rgba(59,130,246,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(59,130,246,0.3);">
                    <h4 style="color: #3b82f6; margin-bottom: 0.5rem;">üíæ Total Size</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">${(analytics.totalFileSize / 1024 / 1024).toFixed(1)} MB</div>
                </div>
                
                <div style="background: rgba(168,85,247,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(168,85,247,0.3);">
                    <h4 style="color: #a855f7; margin-bottom: 0.5rem;">üéØ Top Role</h4>
                    <div style="font-size: 1.2rem; font-weight: bold; color: #a855f7;">
                        ${Object.keys(analytics.roles).length > 0 ? 
                            Object.entries(analytics.roles).sort((a, b) => b[1] - a[1])[0][0] : 
                            'No roles yet'
                        }
                    </div>
                </div>
            `;
        }

        // Update freelancer contract status when contract is uploaded
        function updateFreelancerContractStatus(email, contractId, contractDate) {
            try {
                // Find and update the freelancer in the local array
                const freelancerIndex = freelancers.findIndex(f => f.email.toLowerCase() === email.toLowerCase());
                if (freelancerIndex >= 0) {
                    freelancers[freelancerIndex].contractStatus = 'uploaded';
                    freelancers[freelancerIndex].contractId = contractId;
                    freelancers[freelancerIndex].contractUploadedDate = contractDate;
                    freelancers[freelancerIndex].contractSignedDate = contractDate; // Assume signed same day for now
                    
                    // Save updated freelancers array
                    localStorage.setItem('freelancers', JSON.stringify(freelancers));
                    
                    console.log('‚úÖ Updated freelancer contract status:', freelancers[freelancerIndex]);
                    
                    // Refresh freelancer list display
                    displayFreelancers();
                    
                    // Show notification to export updated data
                    setTimeout(() => {
                        if (confirm('üìã Freelancer contract status updated!\n\nWould you like to export the updated freelancers.json file now?\n\nThis will ensure the user portal reflects the signed contract status.')) {
                            exportContractData();
                        }
                    }, 1000);
                } else {
                    console.warn('‚ö†Ô∏è Freelancer not found in local array for email:', email);
                    showNotification(`‚ö†Ô∏è Note: Freelancer ${email} not found in local database.\n\nConsider adding them to the freelancer list first, then re-uploading the contract.`, 'warning');
                }
            } catch (error) {
                console.error('‚ùå Error updating freelancer contract status:', error);
            }
        }

        // ==================== JOBS MANAGEMENT FUNCTIONALITY ====================
        
        let editingJobIndex = -1;

        // Load jobs from jobs-data.json and localStorage
        async function loadJobs() {
            console.log('üîÑ Loading jobs...');
            
            // First try to load from jobs API
            try {
                const response = await fetch('/api/jobs-data');
                if (response.ok) {
                    const data = await response.json();
                    jobs = data.jobs || [];
                    console.log('üìñ Loaded', jobs.length, 'jobs from API');
                } else {
                    // Fallback to localStorage
                    jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
                    console.log('üìù Loaded', jobs.length, 'jobs from localStorage');
                }
            } catch (error) {
                // Fallback to localStorage
                jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
                console.log('üìù Loaded', jobs.length, 'jobs from localStorage (fallback)');
            }
            
            displayJobs();
            console.log('‚úÖ Total jobs loaded:', jobs.length);
        }

        // Display jobs
        function displayJobs() {
            const container = document.getElementById('jobsList');
            
            if (jobs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                        <h3 style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">üìã No Jobs Created Yet</h3>
                        <p>Create your first job listing using the form above</p>
                    </div>
                `;
                return;
            }
            
            const jobsHTML = jobs.map((job, index) => `
                <div class="item-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>${job.title}</h3>
                        <span style="background: ${job.status === 'Active' ? '#22c55e' : '#6b7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">${job.status}</span>
                    </div>
                    
                    <div class="item-meta">
                        <span>üìÖ ${job.date || 'No date set'}</span>
                        <span>üìç ${job.location || 'No location'}</span>
                        <span>üí∞ ${job.pay || 'No pay listed'}</span>
                    </div>
                    
                    <div class="item-description">
                        ${job.description || 'No description provided'}
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-small" onclick="editJob(${index})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteJob(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = jobsHTML;
        }

        // Job form submission
        document.addEventListener('DOMContentLoaded', function() {
            const jobForm = document.getElementById('jobForm');
            if (jobForm) {
                jobForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveJob();
                });
            }
        });

        // Save job
        async function saveJob() {
            const formData = new FormData(document.getElementById('jobForm'));
            const jobData = {
                title: formData.get('title'),
                date: formData.get('date'),
                location: formData.get('location'),
                pay: formData.get('pay'),
                description: formData.get('description'),
                status: formData.get('status')
            };

            if (!jobData.title.trim()) {
                showNotification('Job title is required', 'error');
                return;
            }

            if (editingJobIndex >= 0) {
                jobs[editingJobIndex] = jobData;
                editingJobIndex = -1;
            } else {
                jobs.push(jobData);
            }

            // Update localStorage with current jobs
            localStorage.setItem('jobs', JSON.stringify(jobs));
            
            // Automatically update GitHub with merged data
            await updateJobsOnGitHub();
            
            displayJobs();
            clearJobForm();
            showNotification('Job saved successfully and updated on GitHub!', 'success');
        }

        // Edit job
        function editJob(index) {
            const job = jobs[index];
            document.getElementById('jobTitle').value = job.title;
            document.getElementById('jobDate').value = job.date;
            document.getElementById('jobLocation').value = job.location;
            document.getElementById('jobPay').value = job.pay;
            document.getElementById('jobDescription').value = job.description;
            document.getElementById('jobStatus').value = job.status;
            editingJobIndex = index;
        }

        // Delete job
        async function deleteJob(index) {
            const job = jobs[index];
            if (confirm(`Are you sure you want to delete "${job.title}"?`)) {
                jobs.splice(index, 1);
                localStorage.setItem('jobs', JSON.stringify(jobs));
                
                // Update GitHub
                await updateJobsOnGitHub();
                
                displayJobs();
                showNotification('Job deleted successfully and updated on GitHub!', 'success');
            }
        }

        // Clear job form
        function clearJobForm() {
            document.getElementById('jobForm').reset();
            document.getElementById('jobLocation').value = 'Atlanta Area';
            editingJobIndex = -1;
        }

        // Export job data
        function exportJobData() {
            const exportData = {
                jobs: jobs,
                exportDate: new Date().toISOString()
            };
            document.getElementById('exportJobData').textContent = JSON.stringify(exportData, null, 2);
            document.getElementById('downloadJobBtn').style.display = 'inline-block';
        }

        // Download job JSON
        function downloadJobJSON() {
            const exportData = {
                jobs: jobs,
                exportDate: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `jobs-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // ==================== FREELANCER MANAGEMENT FUNCTIONALITY ====================
        
        let editingFreelancerIndex = -1;

        // Load freelancers from freelancers.json and localStorage
        async function loadFreelancers() {
            console.log('üîÑ Loading freelancers...');
            
            // First, try to load from freelancers API
            try {
                const response = await fetch('/api/freelancers');
                if (response.ok) {
                    const jsonData = await response.json();
                    const approvedFreelancers = jsonData.approvedFreelancers || {};
                    
                    // Convert the object format to array format for the admin dashboard
                    freelancers = Object.entries(approvedFreelancers).map(([name, data]) => ({
                        name: name,
                        email: data.email,
                        password: data.password,
                        role: data.role,
                        location: data.location,
                        projectStart: data.projectStart,
                        rate: data.rate,
                        approvedDate: data.approvedDate,
                        contractStatus: data.contractStatus || 'pending',
                        contractSignedDate: data.contractSignedDate || null,
                        contractUploadedDate: data.contractUploadedDate || null,
                        contractId: data.contractId || null,
                        jobs: data.jobs || [],
                        primaryJob: data.primaryJob || null,
                        paymentMethod: data.paymentMethod || null
                    }));
                    
                    console.log('üìñ Loaded', freelancers.length, 'freelancers from API');
                    
                    // Update localStorage to sync with GitHub data
                    localStorage.setItem('freelancers', JSON.stringify(freelancers));
                    
                } else {
                    console.warn('‚ö†Ô∏è Could not load freelancers.json, trying localStorage');
                    freelancers = JSON.parse(localStorage.getItem('freelancers') || '[]');
                    console.log('üìù Loaded', freelancers.length, 'freelancers from localStorage');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Error loading freelancers.json:', error);
                freelancers = JSON.parse(localStorage.getItem('freelancers') || '[]');
                console.log('üìù Loaded', freelancers.length, 'freelancers from localStorage (fallback)');
            }
            

            
            displayFreelancers();
            console.log('‚úÖ Total freelancers loaded:', freelancers.length);
            
            // Load and populate dropdown options
            await loadDropdownOptions();
            
            // Populate freelancer dropdowns
            populateFreelancerDropdowns();
            
            // Show payment method summary
            displayPaymentMethodSummary();
            
            // Check for performance review alerts
            checkPerformanceReviewAlerts();
            
            // Show status in the interface
            const statusElement = document.getElementById('freelancerStatus');
            if (statusElement) {
                statusElement.textContent = `Loaded ${freelancers.length} freelancers from ${freelancers.length > 0 ? 'freelancers.json' : 'localStorage'}`;
            }
        }
        


        // Populate freelancer dropdowns
        function populateFreelancerDropdowns() {
            // Populate contract upload freelancer dropdown
            const uploadFreelancerSelect = document.getElementById('uploadFreelancerName');
            if (uploadFreelancerSelect) {
                uploadFreelancerSelect.innerHTML = '<option value="">Select a freelancer...</option>';
                freelancers.forEach(freelancer => {
                    const option = document.createElement('option');
                    option.value = freelancer.name;
                    option.textContent = freelancer.name;
                    uploadFreelancerSelect.appendChild(option);
                });
            }
            
            // Populate job assignment freelancer dropdown
            const jobAssignmentSelect = document.getElementById('jobAssignmentFreelancer');
            if (jobAssignmentSelect) {
                jobAssignmentSelect.innerHTML = '<option value="">Choose a freelancer...</option>';
                freelancers.forEach(freelancer => {
                    const option = document.createElement('option');
                    option.value = freelancer.name;
                    option.textContent = freelancer.name;
                    jobAssignmentSelect.appendChild(option);
                });
            }
            
            console.log('üë• Populated freelancer dropdowns with', freelancers.length, 'options');
        }

        // Load dropdown options from API or use defaults
        async function loadDropdownOptions() {
            try {
                const response = await fetch('/api/dropdown-options');
                if (response.ok) {
                    window.dropdownOptions = await response.json();
                    console.log('üìã Loaded dropdown options from API:', window.dropdownOptions);
                } else {
                    // Initialize with default options if API fails
                    window.dropdownOptions = {
                        roles: ['Backdrop Photographer', 'Editor', 'Videographer', 'Photographer', 'Full Stack Designer', 'Video Editor', 'Corporate Videographer'],
                        locations: ['6695 Church Street, Douglasville, GA 30134', 'Sandy Springs, GA', 'Douglasville, GA', 'Atlanta, GA', 'Atlanta Area'],
                        rates: ['$400.00 USD (Flat)', '$450.00 USD (Flat)', '$500.00 USD (Flat)', '$750.00 USD (Flat)', '$900.00 USD (Flat)', '$150/day', '$200/day'],
                        projectTypes: ['Photography', 'Video', 'Editor Project', 'Corporate Video', 'Event Coverage', 'Product Photography', 'Real Estate', 'Wedding', 'Commercial'],
                        paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                        projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                        paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                    };
                    console.log('üìã Initialized default dropdown options (API failed):', window.dropdownOptions);
                }
            } catch (error) {
                console.error('‚ùå Error loading dropdown options from API:', error);
                // Initialize with default options
                window.dropdownOptions = {
                    roles: ['Backdrop Photographer', 'Editor', 'Videographer', 'Photographer', 'Full Stack Designer', 'Video Editor', 'Corporate Videographer'],
                    locations: ['6695 Church Street, Douglasville, GA 30134', 'Sandy Springs, GA', 'Douglasville, GA', 'Atlanta, GA', 'Atlanta Area'],
                    rates: ['$400.00 USD (Flat)', '$450.00 USD (Flat)', '$500.00 USD (Flat)', '$750.00 USD (Flat)', '$900.00 USD (Flat)', '$150/day', '$200/day'],
                    projectTypes: ['Photography', 'Video', 'Editor Project', 'Corporate Video', 'Event Coverage', 'Product Photography', 'Real Estate', 'Wedding', 'Commercial'],
                    paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                    projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                    paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                };
                console.log('üìã Initialized default dropdown options (error):', window.dropdownOptions);
            }
            
            // Populate the management interface
            populateDropdownManagementInterface();
            
            // Populate job assignment dropdowns
            populateJobAssignmentDropdowns();
        }
        
        // Populate dropdown options from JSON data (legacy function)
        function populateDropdownOptions() {
            // Get unique roles from freelancers.json
            const roles = new Set();
            freelancers.forEach(freelancer => {
                if (freelancer.role) roles.add(freelancer.role);
            });
            
            // Get unique locations from freelancers.json
            const locations = new Set();
            freelancers.forEach(freelancer => {
                if (freelancer.location) locations.add(freelancer.location);
            });
            
            // Get unique rates from freelancers.json
            const rates = new Set();
            freelancers.forEach(freelancer => {
                if (freelancer.rate) rates.add(freelancer.rate);
            });
            
            // Get job titles from jobs-data.json
            const jobTitles = jobs.map(job => job.title);
            
            // Get project types from jobs-data.json (extract from descriptions)
            const projectTypes = new Set();
            jobs.forEach(job => {
                if (job.description) {
                    // Extract project type from job description or title
                    const type = job.title.includes('Photographer') ? 'Photography' :
                               job.title.includes('Editor') ? 'Editor Project' :
                               job.title.includes('Videographer') ? 'Video' :
                               'General';
                    projectTypes.add(type);
                }
            });
            
            // Merge with existing options
            if (window.dropdownOptions) {
                window.dropdownOptions.roles = [...new Set([...window.dropdownOptions.roles, ...Array.from(roles)])];
                window.dropdownOptions.locations = [...new Set([...window.dropdownOptions.locations, ...Array.from(locations)])];
                window.dropdownOptions.rates = [...new Set([...window.dropdownOptions.rates, ...Array.from(rates)])];
                window.dropdownOptions.projectTypes = [...new Set([...window.dropdownOptions.projectTypes, ...Array.from(projectTypes)])];
            } else {
                window.dropdownOptions = {
                    roles: Array.from(roles),
                    locations: Array.from(locations),
                    rates: Array.from(rates),
                    jobTitles: jobTitles,
                    projectTypes: Array.from(projectTypes),
                    paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                    projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                    paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                };
            }
            
            console.log('üìã Populated dropdown options:', window.dropdownOptions);
        }

        // Add dropdown option
        function addDropdownOption(category, inputId) {
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            
            if (!value) {
                showNotification('Please enter a value to add.', 'error');
                return;
            }
            
            if (!window.dropdownOptions[category]) {
                window.dropdownOptions[category] = [];
            }
            
            if (window.dropdownOptions[category].includes(value)) {
                showNotification('This option already exists.', 'warning');
                return;
            }
            
            window.dropdownOptions[category].push(value);
            input.value = '';
            
            // Update the management interface
            populateDropdownManagementInterface();
            
            // Update job assignment dropdowns
            populateJobAssignmentDropdowns();
            
            console.log(`‚úÖ Added ${value} to ${category}`);
        }
        
        // Remove dropdown option
        function removeDropdownOption(category, value) {
            if (window.dropdownOptions[category]) {
                window.dropdownOptions[category] = window.dropdownOptions[category].filter(item => item !== value);
                populateDropdownManagementInterface();
                populateJobAssignmentDropdowns();
                console.log(`‚úÖ Removed ${value} from ${category}`);
            }
        }
        
        // Populate dropdown management interface
        function populateDropdownManagementInterface() {
            const categories = ['roles', 'locations', 'rates', 'projectTypes'];
            
            categories.forEach(category => {
                const container = document.getElementById(`${category}List`);
                if (container && window.dropdownOptions[category]) {
                    container.innerHTML = window.dropdownOptions[category].map(item => `
                        <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">
                            <span style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">${item}</span>
                            <button onclick="removeDropdownOption('${category}', '${item}')" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `).join('');
                }
            });
        }
        
        // Populate all dropdowns from dropdown options
        function populateJobAssignmentDropdowns() {
            if (!window.dropdownOptions) return;
            
            // Populate role dropdowns
            const roleSelects = ['jobRole', 'freelancerRole'];
            roleSelects.forEach(selectId => {
                const roleSelect = document.getElementById(selectId);
                if (roleSelect) {
                    roleSelect.innerHTML = '<option value="">Select a role...</option>';
                    window.dropdownOptions.roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role;
                        option.textContent = role;
                        roleSelect.appendChild(option);
                    });
                }
            });
            
            // Populate location dropdowns
            const locationSelects = ['assignmentJobLocation', 'freelancerLocation', 'jobLocation'];
            locationSelects.forEach(selectId => {
                const locationSelect = document.getElementById(selectId);
                if (locationSelect) {
                    locationSelect.innerHTML = '<option value="">Select a location...</option>';
                    window.dropdownOptions.locations.forEach(location => {
                        const option = document.createElement('option');
                        option.value = location;
                        option.textContent = location;
                        locationSelect.appendChild(option);
                    });
                }
            });
            
            // Populate rate dropdowns
            const rateSelects = ['assignmentJobRate', 'freelancerRate', 'jobPay'];
            rateSelects.forEach(selectId => {
                const rateSelect = document.getElementById(selectId);
                if (rateSelect) {
                    rateSelect.innerHTML = '<option value="">Select a rate...</option>';
                    window.dropdownOptions.rates.forEach(rate => {
                        const option = document.createElement('option');
                        option.value = rate;
                        option.textContent = rate;
                        rateSelect.appendChild(option);
                    });
                }
            });
            
            // Populate project type dropdown
            const projectTypeSelect = document.getElementById('assignmentJobProjectType');
            if (projectTypeSelect) {
                projectTypeSelect.innerHTML = '<option value="">Select a project type...</option>';
                window.dropdownOptions.projectTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    projectTypeSelect.appendChild(option);
                });
            }
        }
        
        // Save dropdown options to GitHub API
        async function saveDropdownOptions() {
            if (!window.dropdownOptions) {
                showNotification('‚ùå No dropdown options to save.', 'error');
                return;
            }
            
            try {
                console.log('üîÑ Saving dropdown options to GitHub via server...');
                
                // Get current SHA for the file
                const shaResponse = await fetch('/api/github/info');
                if (!shaResponse.ok) {
                    throw new Error('Failed to get GitHub info');
                }
                
                const shaData = await shaResponse.json();
                const currentSha = shaData.sha;
                
                console.log('üîç Retrieved current SHA:', currentSha);
                
                // Update the file on GitHub
                const updateResponse = await fetch('/api/github/file/dropdown-options.json', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update dropdown options via admin dashboard',
                        content: btoa(JSON.stringify(window.dropdownOptions, null, 2)),
                        sha: currentSha
                    })
                });
                
                if (updateResponse.ok) {
                    console.log('‚úÖ Successfully saved dropdown options to GitHub');
                    showNotification('‚úÖ Dropdown options saved successfully to GitHub!', 'success');
                } else {
                    const errorData = await updateResponse.json();
                    throw new Error(`GitHub API error: ${errorData.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå Error saving dropdown options:', error);
                showNotification(`‚ùå Failed to save dropdown options: ${error.message}`, 'error');
            }
        }
        
        // Display payment method summary
        function displayPaymentMethodSummary() {
            const paymentMethods = {};
            let totalUsers = 0;
            let usersWithPaymentMethod = 0;
            
            freelancers.forEach(freelancer => {
                totalUsers++;
                if (freelancer.paymentMethod) {
                    usersWithPaymentMethod++;
                    paymentMethods[freelancer.paymentMethod] = (paymentMethods[freelancer.paymentMethod] || 0) + 1;
                }
            });
            
            // Create summary HTML
            const summaryHTML = `
                <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                    <h3 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-credit-card"></i> Payment Method Summary
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #FFB200;">${usersWithPaymentMethod}</div>
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">Users with Payment Method</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #ff6b6b;">${totalUsers - usersWithPaymentMethod}</div>
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">Users Pending Selection</div>
                        </div>
                    </div>
                    ${Object.keys(paymentMethods).length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Payment Method Breakdown:</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                ${Object.entries(paymentMethods).map(([method, count]) => `
                                    <span style="background: rgba(255,178,0,0.3); color: #FFB200; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">
                                        ${method.toUpperCase()}: ${count}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Insert summary at the top of the freelancers list
            const container = document.getElementById('contractsList');
            if (container && container.children.length > 0) {
                container.insertAdjacentHTML('afterbegin', summaryHTML);
            }
        }

        // Check for performance review alerts
        function checkPerformanceReviewAlerts() {
            const pendingReviews = freelancers.filter(freelancer => shouldShowPerformanceReview(freelancer));
            
            if (pendingReviews.length > 0) {
                const alertContainer = document.createElement('div');
                alertContainer.id = 'performanceReviewAlert';
                alertContainer.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #f59e0b, #d97706);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 12px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 1000;
                    max-width: 300px;
                    border: 1px solid rgba(255,255,255,0.2);
                `;
                
                alertContainer.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                        <h4 style="margin: 0; color: white;"><i class="fas fa-star"></i> Performance Reviews Due</h4>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">√ó</button>
                    </div>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">
                        ${pendingReviews.length} freelancer${pendingReviews.length > 1 ? 's' : ''} need${pendingReviews.length > 1 ? '' : 's'} performance review.
                    </p>
                    <div style="margin-top: 0.5rem;">
                        <button onclick="showPerformanceReviewList()" 
                                style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">
                            View All
                        </button>
                    </div>
                `;
                
                document.body.appendChild(alertContainer);
                
                // Auto-remove after 10 seconds
                setTimeout(() => {
                    const alert = document.getElementById('performanceReviewAlert');
                    if (alert) alert.remove();
                }, 10000);
            }
        }

        // Show performance review list
        function showPerformanceReviewList() {
            const pendingReviews = freelancers.filter(freelancer => shouldShowPerformanceReview(freelancer));
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-star"></i> Performance Reviews Due</h2>
                        <button onclick="closeModal(this)" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">
                            The following freelancers have completed paid projects and need performance reviews:
                        </p>
                        ${pendingReviews.map(freelancer => `
                            <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="color: #FFB200; margin: 0 0 0.5rem 0;">${freelancer.name}</h4>
                                        <p style="color: rgba(255,255,255,0.8); margin: 0; font-size: 0.9rem;">${freelancer.email}</p>
                                    </div>
                                    <button onclick="showPerformanceReviewModal('${freelancer.name}'); closeModal(this);" 
                                            style="background: #FFB200; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                        Review Now
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,178,0,0.2);">
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> Performance reviews help improve collaboration and future opportunities.
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Get performance review status badge
        function getPerformanceReviewStatus(freelancer) {
            const existingReview = performanceReviews[freelancer.email];
            
            if (existingReview) {
                const statusColor = existingReview.status === 'completed' ? '#22c55e' : 
                                  existingReview.status === 'pending' ? '#f59e0b' : '#ef4444';
                return `<span style="background: ${statusColor}; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">${existingReview.status.toUpperCase()}</span>`;
            } else {
                return `<span style="background: rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">NO REVIEW</span>`;
            }
        }

        // Get performance review summary
        function getPerformanceReviewSummary(freelancer) {
            const existingReview = performanceReviews[freelancer.email];
            
            if (existingReview) {
                const reviewDate = existingReview.reviewDate ? new Date(existingReview.reviewDate).toLocaleDateString() : 'N/A';
                const overallRating = existingReview.overallRating || 'N/A';
                const comments = existingReview.comments ? existingReview.comments.substring(0, 100) + (existingReview.comments.length > 100 ? '...' : '') : 'No comments';
                
                return `
                    <div style="margin-bottom: 0.5rem;">
                        <strong>Date:</strong> ${reviewDate} | <strong>Rating:</strong> ${overallRating}/5
                    </div>
                    <div style="font-style: italic; color: rgba(255,255,255,0.7);">
                        "${comments}"
                    </div>
                `;
            } else {
                // Check if they have completed paid projects
                const hasCompletedProjects = projectStatus[freelancer.name] && 
                    Object.values(projectStatus[freelancer.name].jobs || {}).some(job => 
                        job.projectStatus === 'completed' && job.paymentStatus === 'paid'
                    );
                
                if (hasCompletedProjects) {
                    return `<span style="color: #f59e0b; font-weight: bold;">‚ö†Ô∏è Performance review needed - completed paid projects</span>`;
                } else {
                    return `<span style="color: rgba(255,255,255,0.6);">No completed paid projects yet</span>`;
                }
            }
        }

        // Get performance review button
        function getPerformanceReviewButton(freelancer) {
            const existingReview = performanceReviews[freelancer.email];
            
            if (existingReview) {
                return `
                    <div style="margin-top: 0.5rem;">
                        <button onclick="showPerformanceReviewModal('${freelancer.name}')" 
                                style="background: #FFB200; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.8rem;">
                            <i class="fas fa-edit"></i> Edit Review
                        </button>
                        <button onclick="viewPerformanceReviewDetails('${freelancer.name}')" 
                                style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem; margin-left: 0.5rem;">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </div>
                `;
            } else {
                // Check if they have completed paid projects
                const hasCompletedProjects = projectStatus[freelancer.name] && 
                    Object.values(projectStatus[freelancer.name].jobs || {}).some(job => 
                        job.projectStatus === 'completed' && job.paymentStatus === 'paid'
                    );
                
                if (hasCompletedProjects) {
                    return `
                        <div style="margin-top: 0.5rem;">
                            <button onclick="showPerformanceReviewModal('${freelancer.name}')" 
                                    style="background: #f59e0b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.8rem;">
                                <i class="fas fa-star"></i> Create Review
                            </button>
                        </div>
                    `;
                } else {
                    return `
                        <div style="margin-top: 0.5rem;">
                            <span style="color: rgba(255,255,255,0.5); font-size: 0.8rem; font-style: italic;">
                                Review available after project completion and payment
                            </span>
                        </div>
                    `;
                }
            }
        }

        // View performance review details
        function viewPerformanceReviewDetails(freelancerName) {
            const freelancer = freelancers.find(f => f.name === freelancerName);
            if (!freelancer) {
                showNotification('Freelancer not found', 'error');
                return;
            }

            const existingReview = performanceReviews[freelancer.email];
            if (!existingReview) {
                showNotification('No performance review found', 'warning');
                return;
            }

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const reviewDate = existingReview.reviewDate ? new Date(existingReview.reviewDate).toLocaleDateString() : 'N/A';
            const overallRating = existingReview.overallRating || 'N/A';
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-star"></i> Performance Review Details</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Review Information</h4>
                            <div style="color: rgba(255,255,255,0.9);">
                                <div><strong>Freelancer:</strong> ${freelancer.name}</div>
                                <div><strong>Email:</strong> ${freelancer.email}</div>
                                <div><strong>Review Date:</strong> ${reviewDate}</div>
                                <div><strong>Overall Rating:</strong> ${overallRating}/5</div>
                                <div><strong>Status:</strong> ${existingReview.status || 'completed'}</div>
                                <div><strong>Reviewed By:</strong> ${existingReview.reviewedBy || 'admin'}</div>
                            </div>
                        </div>
                        
                        ${existingReview.comments ? `
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Comments</h4>
                            <p style="color: rgba(255,255,255,0.9); line-height: 1.6;">${existingReview.comments}</p>
                        </div>
                        ` : ''}
                        
                        ${existingReview.adminNotes ? `
                        <div style="background: rgba(255,0,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,0,0,0.3);">
                            <h4 style="color: #ff6b6b; margin-bottom: 0.5rem;">Admin Notes (Internal)</h4>
                            <p style="color: rgba(255,255,255,0.9); line-height: 1.6;">${existingReview.adminNotes}</p>
                        </div>
                        ` : ''}
                        
                        ${existingReview.categories ? `
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Category Ratings</h4>
                            ${Object.entries(existingReview.categories).map(([category, rating]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: rgba(255,255,255,0.9);">${category}:</span>
                                    <span style="color: #FFB200; font-weight: bold;">${rating}/5</span>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button onclick="showPerformanceReviewModal('${freelancer.name}'); this.closest('div[style*=\"position: fixed\"]').remove();" 
                                style="background: #FFB200; color: #000; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-edit"></i> Edit Review
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Download freelancer contract
        function downloadFreelancerContract(freelancerName) {
            const freelancer = freelancers.find(f => f.name === freelancerName);
            if (!freelancer) {
                showNotification('Freelancer not found', 'error');
                return;
            }

            // Check if contract exists in uploaded contracts
            const userContract = uploadedContracts.find(contract => 
                contract.freelancerName === freelancerName || 
                contract.freelancerEmail === freelancer.email
            );

            if (userContract && userContract.contractUrl) {
                // If we have a contract URL, download it
                const link = document.createElement('a');
                link.href = userContract.contractUrl;
                link.download = `${freelancerName.replace(/\s+/g, '_')}_Contract.pdf`;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                console.log('‚úÖ Contract downloaded for:', freelancerName);
            } else {
                // Check if contract exists in the contracts directory using contract ID format
                const contractId = freelancer.contractId;
                if (contractId) {
                    const contractFileName = `${contractId}.pdf`;
                    const contractUrl = `contracts/${contractFileName}`;
                    
                    // Try to download from contracts directory
                    const link = document.createElement('a');
                    link.href = contractUrl;
                    link.download = contractFileName;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Show status message
                    showUpdateStatus(`üìÑ Downloading contract ${contractId} for ${freelancerName}`, 'info');
                    console.log('üìÑ Contract download attempted for:', freelancerName, 'with ID:', contractId);
                } else {
                    // No contract ID found, show error
                    showUpdateStatus(`‚ùå No contract ID found for ${freelancerName}`, 'error');
                    console.log('‚ùå No contract ID found for:', freelancerName);
                }
            }
        }

        // Check if performance review should be shown for a freelancer
        function shouldShowPerformanceReview(freelancer) {
            // Check if freelancer has completed projects with paid status
            if (projectStatus[freelancer.name] && projectStatus[freelancer.name].jobs) {
                const completedJobs = Object.values(projectStatus[freelancer.name].jobs).filter(job => 
                    job.projectStatus === 'completed' && job.paymentStatus === 'paid'
                );
                
                // Show if there are completed paid jobs and no performance review exists
                if (completedJobs.length > 0) {
                    const existingReview = performanceReviews[freelancer.email];
                    return !existingReview || existingReview.status === 'pending';
                }
            }
            return false;
        }

        // Display freelancers
        function displayFreelancers() {
            const container = document.getElementById('contractsList');
            
            if (freelancers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                        <h3 style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">üë• No Freelancers Added Yet</h3>
                        <p>Add freelancers using the form above to manage contracts</p>
                    </div>
                `;
                return;
            }
            
            const freelancersHTML = freelancers.map((freelancer, index) => `
                <div class="item-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>${freelancer.name}</h3>
                                                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <span style="background: ${freelancer.contractStatus === 'uploaded' ? '#22c55e' : freelancer.contractStatus === 'signed' ? '#f59e0b' : '#6b7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                    ${freelancer.contractStatus === 'uploaded' ? 'Contract Complete' : freelancer.contractStatus === 'signed' ? 'Contract Signed' : 'Pending Approval'}
                                </span>
                                <span style="background: ${freelancer.password ? '#22c55e' : '#f59e0b'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                    ${freelancer.password ? 'üîê Password Set' : '‚è≥ Pending Password'}
                                </span>
                                <button onclick="showProjectStatusManager('${freelancer.name}')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                    üìä Project Status
                                </button>
                                <button onclick="showJobAssignmentModal('${freelancer.name}')" style="background: #22c55e; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                    üéØ Assign Jobs
                                </button>
                                <button onclick="downloadFreelancerContract('${freelancer.name}')" style="background: #8b5cf6; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                    üìÑ Download Contract
                                </button>
                                ${shouldShowPerformanceReview(freelancer) ? `
                                <button onclick="showPerformanceReviewModal('${freelancer.name}')" style="background: #f59e0b; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                    ‚≠ê Performance Review
                                </button>
                                ` : ''}
                            ${!freelancer.approvedDate ? `
                                <button onclick="approveFreelancer(${index})" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                    ‚úÖ Approve
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="item-meta">
                        <span>üìß ${freelancer.email}</span>
                        <span>üéØ ${freelancer.role}</span>
                        <span>üí∞ ${freelancer.rate}</span>
                        <span>üìç ${freelancer.location}</span>
                    </div>
                    
                    <!-- Payment Method Section -->
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong style="color: #FFB200;">üí≥ Payment Method</strong>
                            ${freelancer.paymentMethod ? 
                                `<span style="background: rgba(255,178,0,0.3); color: #FFB200; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">${freelancer.paymentMethod.toUpperCase()}</span>` : 
                                `<span style="background: rgba(255,0,0,0.2); color: #ff6b6b; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">NOT SET</span>`
                            }
                        </div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">
                            ${freelancer.paymentMethod ? 
                                `User has selected <strong>${freelancer.paymentMethod.toUpperCase()}</strong> as their preferred payment method.` : 
                                `User has not yet selected a payment method. They can do this in their portal.`
                            }
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                            <div><strong>Project Start:</strong><br>${freelancer.projectStart}</div>
                            <div><strong>Approved Date:</strong><br>${freelancer.approvedDate || 'Not approved yet'}</div>
                        </div>
                        ${freelancer.jobs && freelancer.jobs.length > 0 ? `
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,178,0,0.3);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <strong style="color: #22c55e;">üéØ Assigned Jobs (${freelancer.jobs.length})</strong>
                                    ${freelancer.primaryJob ? `<span style="background: #22c55e; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Primary Job</span>` : ''}
                                </div>
                                <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">
                                    ${freelancer.jobs.slice(0, 2).map(job => `
                                        <div style="margin-bottom: 0.25rem;">‚Ä¢ ${job.role || 'No role'} - ${job.status || 'No status'} (${job.id})</div>
                                    `).join('')}
                                    ${freelancer.jobs.length > 2 ? `<div style="font-style: italic; color: rgba(255,255,255,0.6);">... and ${freelancer.jobs.length - 2} more</div>` : ''}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Performance Review Section -->
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong style="color: #FFB200;">‚≠ê Performance Review</strong>
                            ${getPerformanceReviewStatus(freelancer)}
                        </div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">
                            ${getPerformanceReviewSummary(freelancer)}
                        </div>
                        ${getPerformanceReviewButton(freelancer)}
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-small" onclick="editFreelancer(${index})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteFreelancer(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = freelancersHTML;
            
            // Update job assignment dropdown
            populateJobAssignmentDropdown();
            
            // Check for updated freelancers.json data and show export button
            const updatedData = localStorage.getItem('updatedFreelancersJson');
            const exportUpdatedBtn = document.getElementById('exportUpdatedBtn');
            if (updatedData && exportUpdatedBtn) {
                exportUpdatedBtn.style.display = 'inline-block';
                console.log('üîÑ Updated freelancers.json data available for export');
            }
        }

        // Contract form submission
        document.addEventListener('DOMContentLoaded', function() {
            const contractForm = document.getElementById('contractForm');
            if (contractForm) {
                contractForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveFreelancer();
                });
            }
        });

        // Save freelancer
        async function saveFreelancer() {
            const freelancerData = {
                name: document.getElementById('freelancerName').value,
                email: document.getElementById('freelancerEmail').value,
                password: null, // Password will be set by freelancer during contract signing
                role: document.getElementById('freelancerRole').value,
                location: document.getElementById('freelancerLocation').value,
                projectStart: document.getElementById('projectStart').value,
                rate: document.getElementById('freelancerRate').value,
                approvedDate: document.getElementById('approvedDate').value,
                contractStatus: 'pending',
                contractSignedDate: null,
                contractUploadedDate: null,
                contractId: null,
                passwordSet: false // Track if password has been set
            };

            if (!freelancerData.name.trim() || !freelancerData.email.trim() || !freelancerData.role.trim()) {
                showNotification('Name, email, and role are required', 'error');
                return;
            }

            if (editingFreelancerIndex >= 0) {
                // Preserve existing contract status and additional data when editing
                const existingFreelancer = freelancers[editingFreelancerIndex];
                freelancerData.contractStatus = existingFreelancer.contractStatus || 'pending';
                freelancerData.contractSignedDate = existingFreelancer.contractSignedDate || null;
                freelancerData.contractUploadedDate = existingFreelancer.contractUploadedDate || null;
                freelancerData.contractId = existingFreelancer.contractId || null;
                freelancerData.jobs = existingFreelancer.jobs || [];
                freelancerData.primaryJob = existingFreelancer.primaryJob || null;
                freelancerData.contractUrl = existingFreelancer.contractUrl || "contract.html";
                
                freelancers[editingFreelancerIndex] = freelancerData;
                editingFreelancerIndex = -1;
                showNotification('Freelancer updated successfully!', 'success');
            } else {
                // Set default values for new freelancers
                freelancerData.contractUrl = "contract.html";
                
                // Automatically create a primary job from the freelancer details
                const primaryJobId = 'job-' + freelancerData.name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now();
                const primaryJob = {
                    id: primaryJobId,
                    role: freelancerData.role,
                    location: freelancerData.location,
                    projectStart: freelancerData.projectStart,
                    rate: freelancerData.rate,
                    status: 'upcoming',
                    projectType: freelancerData.role + ' Project',
                    description: `Primary assignment for ${freelancerData.name}`
                };
                
                freelancerData.jobs = [primaryJob];
                freelancerData.primaryJob = primaryJobId;
                
                freelancers.push(freelancerData);
                
                // Send job acceptance email for new freelancers
                sendJobAcceptanceEmail(freelancerData);
            }

            localStorage.setItem('freelancers', JSON.stringify(freelancers));
            
            // Automatically update GitHub
            await updateFreelancersOnGitHub();
            
            displayFreelancers();
            clearContractForm();
        }

        // Send job acceptance email
        async function sendJobAcceptanceEmail(freelancerData) {
            try {
                // Generate contract ID for tracking
                const contractId = 'CF-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
                
                // Prepare email parameters
                const emailParams = {
                    to_email: freelancerData.email,
                    freelancer_name: freelancerData.name || 'Freelancer',
                    role: freelancerData.role || 'Contractor',
                    location: freelancerData.location || 'Atlanta Area',
                    rate: freelancerData.rate || 'Rate to be determined',
                    project_start: freelancerData.projectStart || 'TBD',
                    contract_id: contractId
                };

                console.log('üìß Sending job acceptance email to:', freelancerData.email);

                // Send email using EmailJS
                if (typeof emailjs !== 'undefined') {
                    await emailjs.send(
                        EMAILJS_CONFIG.serviceId, 
                        EMAILJS_CONFIG.jobAcceptanceTemplateId, 
                        emailParams
                    );
                    
                    console.log('‚úÖ Job acceptance email sent successfully');
                    
                    // Show success message
                    setTimeout(() => {
                        showNotification(`üéâ Freelancer approved and email sent!\n\nüìß Email sent to: ${freelancerData.email}\nüìÑ Contract ID: ${contractId}\n\n‚úÖ The freelancer will receive the job acceptance email with contract signing instructions.`, 'success');
                    }, 1000);
                    
                } else {
                    console.warn('‚ö†Ô∏è EmailJS not available, skipping email send');
                    showNotification('‚úÖ Freelancer saved successfully!\n\n‚ö†Ô∏è EmailJS not configured - please set up EmailJS to send automatic job acceptance emails.', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Error sending job acceptance email:', error);
                showNotification('‚úÖ Freelancer saved successfully!\n\n‚ö†Ô∏è Email sending failed. Please check EmailJS configuration.', 'warning');
            }
        }

        // Approve existing freelancer (for freelancers already in the system)
        function approveFreelancer(index) {
            const freelancer = freelancers[index];
            
            if (confirm(`Are you sure you want to approve ${freelancer.name}?\n\nThis will send them a job acceptance email with contract signing instructions.`)) {
                // Update approval date if not set
                if (!freelancer.approvedDate) {
                    freelancer.approvedDate = new Date().toISOString().split('T')[0];
                }
                
                // Send job acceptance email
                sendJobAcceptanceEmail(freelancer);
                
                // Save updated freelancer data
                localStorage.setItem('freelancers', JSON.stringify(freelancers));
                displayFreelancers();
            }
        }

        // Edit freelancer
        function editFreelancer(index) {
            const freelancer = freelancers[index];
            document.getElementById('freelancerName').value = freelancer.name;
            document.getElementById('freelancerEmail').value = freelancer.email;
            document.getElementById('freelancerPassword').value = freelancer.password || 'Password will be set during contract signing';
            document.getElementById('freelancerRole').value = freelancer.role;
            document.getElementById('freelancerLocation').value = freelancer.location;
            document.getElementById('projectStart').value = freelancer.projectStart;
            document.getElementById('freelancerRate').value = freelancer.rate;
            document.getElementById('approvedDate').value = freelancer.approvedDate;
            editingFreelancerIndex = index;
        }

        // Delete freelancer
        async function deleteFreelancer(index) {
            const freelancer = freelancers[index];
            if (confirm(`Are you sure you want to delete "${freelancer.name}"?`)) {
                try {
                    // Remove freelancer from freelancers array
                    freelancers.splice(index, 1);
                    localStorage.setItem('freelancers', JSON.stringify(freelancers));
                    
                    // Update freelancers.json on GitHub
                    await updateFreelancersOnGitHub();
                    
                    displayFreelancers();
                    showNotification('Freelancer deleted successfully and freelancers.json updated on GitHub!', 'success');
                } catch (error) {
                    console.error('‚ùå Error deleting freelancer:', error);
                    showNotification(`Error deleting freelancer: ${error.message}. The freelancer was removed locally but the GitHub update failed.`, 'error');
                    displayFreelancers(); // Still update the display
                }
            }
        }

        // Manual refresh function
        async function refreshFreelancers() {
            console.log('üîÑ Manually refreshing freelancers...');
            
            // Clear any cached data
            localStorage.removeItem('freelancers');
            
            // Clear browser cache for freelancers.json
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        const cache = await caches.open(cacheName);
                        await cache.delete('freelancers.json');
                    }
                    console.log('üóëÔ∏è Cleared browser cache for freelancers.json');
                } catch (error) {
                    console.warn('‚ö†Ô∏è Could not clear cache:', error);
                }
            }
            
            await loadFreelancers();
        }

        // Clear contract form
        function clearContractForm() {
            document.getElementById('contractForm').reset();
            document.getElementById('freelancerLocation').value = 'Atlanta Area';
            document.getElementById('projectStart').value = 'TBD';
            document.getElementById('contractUrl').value = 'contract.html';
            document.getElementById('freelancerPassword').value = '';
            editingFreelancerIndex = -1;
        }





        // ==================== JOB ASSIGNMENT FUNCTIONALITY ====================

        // Populate freelancer dropdown for job assignment
        function populateJobAssignmentDropdown() {
            const select = document.getElementById('jobAssignmentFreelancer');
            if (!select) return;
            
            select.innerHTML = '<option value="">Choose a freelancer...</option>';
            freelancers.forEach((freelancer, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = freelancer.name;
                select.appendChild(option);
            });
        }

        // Handle freelancer selection for job assignment
        function handleFreelancerSelection() {
            const select = document.getElementById('jobAssignmentFreelancer');
            const jobInfo = document.getElementById('freelancerJobInfo');
            const currentJobsList = document.getElementById('currentJobsList');
            
            if (!select || !jobInfo || !currentJobsList) return;
            
            const selectedIndex = select.value;
            if (selectedIndex === '') {
                jobInfo.style.display = 'none';
                return;
            }
            
            const freelancer = freelancers[selectedIndex];
            jobInfo.style.display = 'block';
            
            if (freelancer.jobs && freelancer.jobs.length > 0) {
                const jobsHTML = freelancer.jobs.map((job, jobIndex) => `
                    <div style="background: rgba(0,0,0,0.3); padding: 0.75rem; border-radius: 6px; margin-bottom: 0.5rem; border: 1px solid rgba(255,178,0,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong style="color: #FFB200;">${job.id}</strong>
                            ${job.id === freelancer.primaryJob ? '<span style="background: #22c55e; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Primary</span>' : ''}
                        </div>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                            <div>üéØ ${job.role || 'No role'}</div>
                            <div>üìç ${job.location || 'No location'}</div>
                            <div>üí∞ ${job.rate || 'No rate'}</div>
                            <div>üìÖ ${job.projectStart || 'No date'}</div>
                            <div>üìä ${job.status || 'No status'}</div>
                        </div>
                        <button onclick="removeJobFromFreelancer(${selectedIndex}, ${jobIndex})" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; margin-top: 0.5rem;">Remove</button>
                    </div>
                `).join('');
                currentJobsList.innerHTML = jobsHTML;
            } else {
                currentJobsList.innerHTML = '<p style="color: rgba(255,255,255,0.6); font-style: italic;">No jobs assigned yet</p>';
            }
        }

        // Add job to freelancer
        function addJobToFreelancer() {
            const freelancerIndex = document.getElementById('jobAssignmentFreelancer').value;
            if (freelancerIndex === '') {
                showNotification('Please select a freelancer first.', 'warning');
                return;
            }
            
            // Format the project start date for better display
            const projectStartInput = document.getElementById('assignmentJobProjectStart').value;
            let formattedProjectStart = projectStartInput;
            if (projectStartInput) {
                try {
                    const date = new Date(projectStartInput);
                    formattedProjectStart = date.toLocaleString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    // If date parsing fails, use the original value
                    formattedProjectStart = projectStartInput;
                }
            }
            
            const jobData = {
                id: document.getElementById('jobId').value,
                role: document.getElementById('jobRole').value,
                location: document.getElementById('assignmentJobLocation').value,
                projectStart: formattedProjectStart,
                rate: document.getElementById('assignmentJobRate').value,
                status: document.getElementById('assignmentJobStatus').value,
                projectType: document.getElementById('assignmentJobProjectType').value,
                description: document.getElementById('assignmentJobDescription').value
            };
            
            if (!jobData.id.trim()) {
                showNotification('Job ID is required.', 'error');
                return;
            }
            
            const freelancer = freelancers[freelancerIndex];
            if (!freelancer.jobs) {
                freelancer.jobs = [];
            }
            
            // Check if job ID already exists
            const existingJobIndex = freelancer.jobs.findIndex(job => job.id === jobData.id);
            if (existingJobIndex >= 0) {
                if (confirm('A job with this ID already exists. Do you want to replace it?')) {
                    freelancer.jobs[existingJobIndex] = jobData;
                } else {
                    return;
                }
            } else {
                freelancer.jobs.push(jobData);
            }
            
            // Set as primary job if checkbox is checked
            if (document.getElementById('primaryJobCheckbox').checked) {
                freelancer.primaryJob = jobData.id;
            }
            
            // Save to localStorage
            localStorage.setItem('freelancers', JSON.stringify(freelancers));
            
            // Refresh displays
            displayFreelancers();
            handleFreelancerSelection();
            
            // Clear form
            document.getElementById('jobAssignmentForm').reset();
            
            showNotification(`‚úÖ Job "${jobData.id}" added to ${freelancer.name}!`, 'success');
        }

        // Remove job from freelancer
        function removeJobFromFreelancer(freelancerIndex, jobIndex) {
            const freelancer = freelancers[freelancerIndex];
            const job = freelancer.jobs[jobIndex];
            
            if (confirm(`Are you sure you want to remove job "${job.id}" from ${freelancer.name}?`)) {
                freelancer.jobs.splice(jobIndex, 1);
                
                // If this was the primary job, clear it
                if (freelancer.primaryJob === job.id) {
                    freelancer.primaryJob = null;
                }
                
                // Save to localStorage
                localStorage.setItem('freelancers', JSON.stringify(freelancers));
                
                // Refresh displays
                displayFreelancers();
                handleFreelancerSelection();
                
                showNotification(`‚úÖ Job "${job.id}" removed from ${freelancer.name}!`, 'success');
            }
        }

        // Initialize job assignment functionality
        document.addEventListener('DOMContentLoaded', function() {
            const jobAssignmentForm = document.getElementById('jobAssignmentForm');
            const freelancerSelect = document.getElementById('jobAssignmentFreelancer');
            
            if (jobAssignmentForm) {
                jobAssignmentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    addJobToFreelancer();
                });
            }
            
            if (freelancerSelect) {
                freelancerSelect.addEventListener('change', handleFreelancerSelection);
            }
        });



        // ==================== QUICK IMPORT FROM EMAIL ====================

        // Parse email data and auto-fill form
        function parseEmailData() {
            const emailText = document.getElementById('quickImportData').value;
            if (!emailText.trim()) {
                showNotification('Please paste the contract data from your email first.', 'warning');
                return;
            }

            // Try to extract contract information using regex patterns
            const extractData = (text) => {
                const patterns = {
                    freelancer_name: /(?:Freelancer|Name):\s*([^\n\r]+)/i,
                    freelancer_email: /(?:Email):\s*([^\n\r\s]+)/i,
                    role: /(?:Role):\s*([^\n\r]+)/i,
                    location: /(?:Location):\s*([^\n\r]+)/i,
                    rate: /(?:Rate):\s*([^\n\r]+)/i,
                    contract_id: /(?:Contract ID):\s*([^\n\r]+)/i,
                    signed_date: /(?:Signed):\s*([^\n\r]+)/i
                };

                const extracted = {};
                for (const [key, pattern] of Object.entries(patterns)) {
                    const match = text.match(pattern);
                    if (match) {
                        extracted[key] = match[1].trim();
                    }
                }
                return extracted;
            };

            const data = extractData(emailText);
            
            // Auto-fill the upload form fields
            if (data.freelancer_name) {
                document.getElementById('uploadFreelancerName').value = data.freelancer_name;
            }
            if (data.freelancer_email) {
                document.getElementById('uploadFreelancerEmail').value = data.freelancer_email;
            }
            if (data.role) {
                document.getElementById('uploadRole').value = data.role;
            }
            if (data.location) {
                document.getElementById('uploadLocation').value = data.location;
            }
            if (data.rate) {
                document.getElementById('uploadRate').value = data.rate;
            }
            if (data.signed_date) {
                // Try to parse and format the date
                try {
                    const date = new Date(data.signed_date);
                    if (!isNaN(date.getTime())) {
                        document.getElementById('uploadDate').value = date.toISOString().split('T')[0];
                    }
                } catch (e) {
                    // If date parsing fails, just use today's date
                    document.getElementById('uploadDate').value = new Date().toISOString().split('T')[0];
                }
            }
            
            // Add contract ID to notes if available
            if (data.contract_id) {
                const notesField = document.getElementById('uploadNotes');
                notesField.value = `Contract ID: ${data.contract_id}\n${notesField.value}`.trim();
            }

            // Clear the import text area
            document.getElementById('quickImportData').value = '';
            
            // Show success message
            const filledFields = Object.values(data).filter(v => v).length;
            if (filledFields > 0) {
                showNotification(`‚úÖ Auto-filled ${filledFields} fields! Now upload your PDF file.`, 'success');
                
                // Scroll to the form
                document.getElementById('contractDetailsForm').style.display = 'block';
                document.getElementById('contractDetailsForm').scrollIntoView({ behavior: 'smooth' });
            } else {
                showNotification('‚ùå Could not extract contract data. Please check the format and try again.', 'error');
            }
        }

        // ==================== GITHUB API INTEGRATION ====================

        // Update JSON file on GitHub via server API
        async function updateGitHubFile(filename, content, commitMessage, retryCount = 0) {
            try {
                console.log(`üîÑ Updating ${filename} on GitHub via server... (attempt ${retryCount + 1})`);
                
                // First, get the current file to retrieve its SHA (required for updates)
                let currentSha = null;
                try {
                    console.log(`üîç Getting current SHA for ${filename}...`);
                    const getResponse = await fetch(`/api/github/file/${filename}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (getResponse.ok) {
                        const currentFile = await getResponse.json();
                        currentSha = currentFile.sha;
                        console.log(`‚úÖ Retrieved current SHA: ${currentSha.substring(0, 7)}`);
                    } else if (getResponse.status === 404) {
                        console.log(`üìÑ File ${filename} doesn't exist yet, creating new file`);
                        // File doesn't exist, so we don't need SHA for creation
                    } else {
                        console.warn(`‚ö†Ô∏è Could not get current SHA for ${filename}, status: ${getResponse.status}`);
                    }
                } catch (shaError) {
                    console.warn(`‚ö†Ô∏è Error getting SHA for ${filename}:`, shaError);
                    // Continue without SHA - might be a new file
                }
                
                // Now update the file
                const requestBody = {
                    content: content,
                    message: commitMessage
                };
                
                // Include SHA if we have it (for existing files)
                if (currentSha) {
                    requestBody.sha = currentSha;
                    console.log(`üîó Including SHA in update request`);
                }
                
                const response = await fetch(`/api/github/file/${filename}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log(`‚úÖ File updated successfully:`, result.commit.sha);
                    return result;
                } else {
                    const error = await response.json();
                    throw new Error(`Server API error: ${error.error}`);
                }
            } catch (error) {
                console.error(`‚ùå Error updating ${filename}:`, error);
                
                // Retry logic for token/network issues
                if (retryCount < 2 && (error.message.includes('token') || error.message.includes('network') || error.message.includes('500'))) {
                    console.log(`üîÑ Retrying in 2 seconds... (attempt ${retryCount + 1})`);
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    return updateGitHubFile(filename, content, commitMessage, retryCount + 1);
                }
                
                throw error;
            }
        }

        // Update freelancers.json on GitHub
        async function updateFreelancersOnGitHub() {
            try {
                const exportData = {
                    approvedFreelancers: freelancers.reduce((acc, freelancer) => {
                        acc[freelancer.name] = {
                            email: freelancer.email,
                            password: freelancer.password,
                            contractUrl: freelancer.contractUrl || "contract.html",
                            role: freelancer.role,
                            location: freelancer.location,
                            projectStart: freelancer.projectStart,
                            rate: freelancer.rate,
                            approvedDate: freelancer.approvedDate,
                            contractStatus: freelancer.contractStatus || 'pending',
                            contractSignedDate: freelancer.contractSignedDate,
                            contractUploadedDate: freelancer.contractUploadedDate,
                            contractId: freelancer.contractId,
                            jobs: freelancer.jobs || [],
                            primaryJob: freelancer.primaryJob
                        };
                        return acc;
                    }, {}),
                    lastUpdated: new Date().toISOString().split('T')[0],
                    totalFreelancers: freelancers.length
                };
                
                await updateGitHubFile('freelancers.json', JSON.stringify(exportData, null, 2), `Update freelancers.json - ${new Date().toLocaleString()}`);
                console.log('‚úÖ Freelancers.json updated on GitHub');
                
                // Show success message
                showUpdateStatus('‚úÖ freelancers.json updated on GitHub successfully!', 'success');
                
            } catch (error) {
                console.error('‚ùå Error updating freelancers.json:', error);
                showUpdateStatus(`‚ùå Error updating freelancers.json: ${error.message}`, 'error');
            }
        }

        // Update jobs-data.json on GitHub
        async function updateJobsOnGitHub() {
            try {
                console.log('üìä Jobs in admin dashboard:', jobs.length);
                console.log('üìä Jobs to upload:', jobs.map(j => j.title));

                // Use ONLY the jobs from admin dashboard (no merging with existing)
                const exportData = {
                    jobs: jobs,
                    lastUpdated: new Date().toISOString().split('T')[0],
                    totalJobs: jobs.length
                };
                
                await updateGitHubFile('jobs-data.json', JSON.stringify(exportData, null, 2), `Update jobs-data.json - ${new Date().toLocaleString()}`);
                console.log('‚úÖ jobs-data.json updated on GitHub with', jobs.length, 'total jobs');
                
                // Show success message
                showUpdateStatus(`‚úÖ jobs-data.json updated on GitHub successfully! (${jobs.length} total jobs)`, 'success');
                
            } catch (error) {
                console.error('‚ùå Error updating jobs-data.json:', error);
                showUpdateStatus(`‚ùå Error updating jobs-data.json: ${error.message}`, 'error');
            }
        }
        


        // Show update status message
        function showUpdateStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                background: ${type === 'success' ? 'linear-gradient(135deg, #22c55e, #16a34a)' : 'linear-gradient(135deg, #ef4444, #dc2626)'};
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            statusDiv.textContent = message;
            
            document.body.appendChild(statusDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        }



        // Show token manager modal
        function showTokenManager() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 500px;
                    width: 100%;
                    position: relative;
                ">
                    <button onclick="this.closest('div[style*=\'position: fixed\']').remove()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">√ó</button>
                    
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">üîê GitHub Token Management</h3>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Current Token Status:</label>
                        <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px; font-family: monospace; font-size: 0.9rem;">
                            ${getGitHubToken() ? '‚úÖ Token is set' : '‚ùå No token found'}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">New GitHub Token:</label>
                        <input type="password" id="newGitHubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" 
                               style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        <small style="color: #666; font-size: 0.8rem;">
                            Get your token from <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings</a>
                        </small>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button onclick="updateGitHubToken()" style="
                            background: linear-gradient(135deg, #22c55e, #16a34a);
                            color: white;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Update Token</button>
                        
                        <button onclick="clearGitHubToken()" style="
                            background: linear-gradient(135deg, #ef4444, #dc2626);
                            color: white;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Clear Token</button>
                    </div>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px;">
                        <strong>üîí Security Note:</strong>
                        <ul style="margin: 0.5rem 0 0 1rem; padding: 0;">
                            <li>Tokens are stored securely in your browser's localStorage</li>
                            <li>Never share your token or commit it to repositories</li>
                            <li>Rotate your token regularly for security</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Update GitHub token
        function updateGitHubToken() {
            const newToken = document.getElementById('newGitHubToken').value.trim();
            if (!newToken) {
                showNotification('Please enter a valid GitHub token', 'error');
                return;
            }
            
            setGitHubToken(newToken);
            showNotification('‚úÖ GitHub token updated successfully!', 'success');
            
            // Close modal
            document.querySelector('div[style*="position: fixed"]').remove();
        }

        // Clear GitHub token
        function clearGitHubToken() {
            if (confirm('Are you sure you want to clear the GitHub token? This will disable automatic updates.')) {
                localStorage.removeItem('github_token');
                showNotification('‚úÖ GitHub token cleared successfully!', 'success');
                
                // Close modal
                document.querySelector('div[style*="position: fixed"]').remove();
            }
        }

        // Update uploaded-contracts.json on GitHub
        async function updateUploadedContractsOnGitHub() {
            try {
                const exportData = {
                    exportDate: new Date().toISOString(),
                    totalContracts: uploadedContracts.length,
                    contracts: uploadedContracts.map(contract => ({
                        contractId: contract.contractId,
                        freelancerName: contract.freelancerName,
                        freelancerEmail: contract.freelancerEmail,
                        role: contract.role,
                        rate: contract.rate,
                        location: contract.location,
                        contractDate: contract.contractDate,
                        notes: contract.notes,
                        fileName: contract.fileName,
                        fileSize: contract.fileSize,
                        uploadDate: contract.uploadDate,
                        uploadTimestamp: contract.uploadTimestamp,
                        status: contract.status
                    }))
                };
                
                await updateGitHubFile('uploaded-contracts.json', exportData, `Update uploaded-contracts.json - ${new Date().toLocaleString()}`);
                console.log('‚úÖ uploaded-contracts.json updated on GitHub');
                
                // Show success message
                showUpdateStatus('‚úÖ uploaded-contracts.json updated on GitHub successfully!', 'success');
                
            } catch (error) {
                console.error('‚ùå Error updating uploaded-contracts.json:', error);
                showUpdateStatus(`‚ùå Error updating uploaded-contracts.json: ${error.message}`, 'error');
            }
        }

        // ==================== PROJECT STATUS MANAGEMENT ====================
        
        // Load performance reviews from JSON file
        async function loadPerformanceReviews() {
            try {
                const response = await fetch('performance.json');
                if (response.ok) {
                    const jsonData = await response.json();
                    performanceReviews = jsonData.performanceReviews || {};
                    console.log('‚úÖ Performance reviews loaded from JSON file:', Object.keys(performanceReviews).length, 'reviews');
                } else {
                    console.warn('‚ö†Ô∏è Could not load performance.json, using empty object');
                    performanceReviews = {};
                }
            } catch (error) {
                console.error('‚ùå Error loading performance reviews:', error);
                performanceReviews = {};
            }
        }

        // Update performance reviews on GitHub
        async function updatePerformanceReviewsOnGitHub() {
            try {
                const exportData = {
                    performanceReviews: performanceReviews,
                    reviewOptions: {
                        rating: [1, 2, 3, 4, 5],
                        categories: ["Professionalism", "Quality", "Communication", "Reliability", "Overall Performance"],
                        status: ["pending", "completed", "overdue"]
                    },
                    lastUpdated: new Date().toISOString().split('T')[0],
                    totalReviews: Object.keys(performanceReviews).length
                };
                
                await updateGitHubFile('performance.json', JSON.stringify(exportData, null, 2), `Update performance.json - ${new Date().toLocaleString()}`);
                console.log('‚úÖ performance.json updated on GitHub');
                
                // Show success message
                showUpdateStatus('‚úÖ performance.json updated on GitHub successfully!', 'success');
                
            } catch (error) {
                console.error('‚ùå Error updating performance.json:', error);
                showUpdateStatus(`‚ùå Error updating performance.json: ${error.message}`, 'error');
            }
        }

        // Load project status from JSON file
        async function loadProjectStatus() {
            try {
                const response = await fetch('project-status.json');
                if (response.ok) {
                    const jsonData = await response.json();
                    projectStatus = jsonData.projectStatus || {};
                    console.log('‚úÖ Project status loaded from JSON file:', Object.keys(projectStatus).length, 'freelancers');
                } else {
                    console.warn('‚ö†Ô∏è Could not load project-status.json, using empty object');
                    projectStatus = {};
                }
            } catch (error) {
                console.error('‚ùå Error loading project status:', error);
                projectStatus = {};
            }
        }
        
        // Update project status on GitHub
        async function updateProjectStatusOnGitHub() {
            try {
                const exportData = {
                    projectStatus: projectStatus,
                    statusOptions: {
                        projectStatus: ["upcoming", "in-progress", "completed", "cancelled"],
                        paymentStatus: ["pending", "processing", "paid", "overdue"]
                    },
                    lastUpdated: new Date().toISOString().split('T')[0],
                    totalProjects: Object.keys(projectStatus).length
                };
                
                await updateGitHubFile('project-status.json', JSON.stringify(exportData, null, 2), `Update project-status.json - ${new Date().toLocaleString()}`);
                console.log('‚úÖ project-status.json updated on GitHub');
                
                // Show success message
                showUpdateStatus('‚úÖ project-status.json updated on GitHub successfully!', 'success');
                
            } catch (error) {
                console.error('‚ùå Error updating project-status.json:', error);
                showUpdateStatus(`‚ùå Error updating project-status.json: ${error.message}`, 'error');
            }
        }
        
        // Update project status for a specific job
        function updateProjectStatus(freelancerName, jobId, newStatus, paymentStatus = null) {
            if (!projectStatus[freelancerName]) {
                projectStatus[freelancerName] = { jobs: {} };
            }
            
            if (!projectStatus[freelancerName].jobs[jobId]) {
                // Create job entry if it doesn't exist
                const freelancer = freelancers.find(f => f.name === freelancerName);
                if (freelancer) {
                    // First try to find job in freelancer's jobs array
                    let job = freelancer.jobs.find(j => j.id === jobId);
                    
                    // If not found in jobs array, create a job from freelancer's primary data
                    if (!job && freelancer.primaryJob) {
                        job = {
                            id: freelancer.primaryJob,
                            role: freelancer.role,
                            location: freelancer.location,
                            projectStart: freelancer.projectStart,
                            rate: freelancer.rate,
                            projectType: freelancer.role + ' Project',
                            description: `Primary assignment for ${freelancerName}`
                        };
                    }
                    
                    // If still no job, create a default job entry
                    if (!job) {
                        job = {
                            id: `job-${freelancerName.toLowerCase().replace(/\s+/g, '-')}-${Date.now()}`,
                            role: freelancer.role,
                            location: freelancer.location,
                            projectStart: freelancer.projectStart,
                            rate: freelancer.rate,
                            projectType: freelancer.role + ' Project',
                            description: `Primary assignment for ${freelancerName}`
                        };
                    }
                    
                    projectStatus[freelancerName].jobs[jobId] = {
                        id: job.id,
                        role: job.role,
                        location: job.location,
                        projectStart: job.projectStart,
                        rate: job.rate,
                        projectStatus: newStatus,
                        paymentStatus: paymentStatus || 'pending',
                        completionDate: newStatus === 'completed' ? new Date().toISOString().split('T')[0] : null,
                        paymentDate: paymentStatus === 'paid' ? new Date().toISOString().split('T')[0] : null,
                        projectType: job.projectType || 'General',
                        description: job.description || ''
                    };
                }
            } else {
                // Update existing job
                projectStatus[freelancerName].jobs[jobId].projectStatus = newStatus;
                if (paymentStatus) {
                    projectStatus[freelancerName].jobs[jobId].paymentStatus = paymentStatus;
                }
                
                if (newStatus === 'completed') {
                    projectStatus[freelancerName].jobs[jobId].completionDate = new Date().toISOString().split('T')[0];
                }
                
                if (paymentStatus === 'paid') {
                    projectStatus[freelancerName].jobs[jobId].paymentDate = new Date().toISOString().split('T')[0];
                }
            }
            
            // Update GitHub
            updateProjectStatusOnGitHub();
            
            console.log(`‚úÖ Updated project status for ${freelancerName} - ${jobId}: ${newStatus}`);
        }

        // ==================== JOB ASSIGNMENT & PAYMENT MANAGEMENT ====================
        
        // Show performance review modal
        function showPerformanceReviewModal(freelancerName) {
            const freelancer = freelancers.find(f => f.name === freelancerName);
            if (!freelancer) {
                showNotification('Freelancer not found', 'error');
                return;
            }

            const existingReview = performanceReviews[freelancer.email];
            const reviewDate = new Date().toISOString().split('T')[0];
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-star"></i> Performance Review for ${freelancer.name}</h2>
                        <button onclick="closeModal(this)" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">√ó</button>
                    </div>
                    
                    ${existingReview ? `
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Existing Review</h4>
                        <div style="color: rgba(255,255,255,0.9);">
                            <div><strong>Date:</strong> ${existingReview.reviewDate || reviewDate}</div>
                            <div><strong>Overall Rating:</strong> ${existingReview.overallRating || 'N/A'}/5</div>
                            <div><strong>Status:</strong> ${existingReview.status || 'completed'}</div>
                            ${existingReview.comments ? `<div><strong>Comments:</strong> ${existingReview.comments}</div>` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    <form id="performanceReviewForm">
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Category Ratings</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                ${['Professionalism', 'Quality', 'Communication', 'Reliability', 'Overall Performance'].map(category => `
                                    <div>
                                        <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">${category}:</label>
                                        <select name="${category.toLowerCase().replace(' ', '_')}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                            <option value="">Select rating</option>
                                            <option value="1" ${existingReview?.categories?.[category] === 1 ? 'selected' : ''}>1 - Poor</option>
                                            <option value="2" ${existingReview?.categories?.[category] === 2 ? 'selected' : ''}>2 - Below Average</option>
                                            <option value="3" ${existingReview?.categories?.[category] === 3 ? 'selected' : ''}>3 - Average</option>
                                            <option value="4" ${existingReview?.categories?.[category] === 4 ? 'selected' : ''}>4 - Good</option>
                                            <option value="5" ${existingReview?.categories?.[category] === 5 ? 'selected' : ''}>5 - Excellent</option>
                                        </select>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Overall Rating</h3>
                            <select name="overall_rating" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                <option value="">Select overall rating</option>
                                <option value="1" ${existingReview?.overallRating === 1 ? 'selected' : ''}>1 - Poor</option>
                                <option value="2" ${existingReview?.overallRating === 2 ? 'selected' : ''}>2 - Below Average</option>
                                <option value="3" ${existingReview?.overallRating === 3 ? 'selected' : ''}>3 - Average</option>
                                <option value="4" ${existingReview?.overallRating === 4 ? 'selected' : ''}>4 - Good</option>
                                <option value="5" ${existingReview?.overallRating === 5 ? 'selected' : ''}>5 - Excellent</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Comments</h3>
                            <textarea name="comments" rows="4" placeholder="Provide detailed feedback about the freelancer's performance..." style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; resize: vertical;">${existingReview?.comments || ''}</textarea>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Admin Notes (Internal)</h3>
                            <textarea name="admin_notes" rows="3" placeholder="Internal notes for admin reference (not visible to freelancer)..." style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; resize: vertical;">${existingReview?.adminNotes || ''}</textarea>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Status</h3>
                            <select name="status" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                <option value="completed" ${existingReview?.status === 'completed' ? 'selected' : ''}>Completed</option>
                                <option value="pending" ${existingReview?.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="overdue" ${existingReview?.status === 'overdue' ? 'selected' : ''}>Overdue</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" onclick="closeModal(this)" 
                                    style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                Cancel
                            </button>
                            <button type="submit" 
                                    style="background: #FFB200; color: #000; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ${existingReview ? 'Update Review' : 'Save Review'}
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            const form = modal.querySelector('#performanceReviewForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                savePerformanceReview(freelancer.email, form);
            });
        }

        // Save performance review
        function savePerformanceReview(userEmail, form) {
            const formData = new FormData(form);
            const categories = {};
            
            // Collect category ratings
            ['professionalism', 'quality', 'communication', 'reliability', 'overall_performance'].forEach(category => {
                const value = formData.get(category);
                if (value) {
                    const categoryName = category.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    categories[categoryName] = parseInt(value);
                }
            });
            
            const reviewData = {
                userEmail: userEmail,
                reviewDate: new Date().toISOString().split('T')[0],
                overallRating: parseInt(formData.get('overall_rating')) || 0,
                categories: categories,
                comments: formData.get('comments') || '',
                adminNotes: formData.get('admin_notes') || '',
                status: formData.get('status') || 'completed',
                reviewedBy: 'admin',
                lastUpdated: new Date().toISOString()
            };
            
            // Save to performance reviews
            performanceReviews[userEmail] = reviewData;
            
            // Update GitHub
            updatePerformanceReviewsOnGitHub();
            
            // Close modal
            closeModal(form);
            
            // Refresh display
            displayFreelancers();
            
            // Show notification
            notifyJSONUpdate('performance.json', 'created', `for ${userEmail}`);
            
            console.log('‚úÖ Performance review saved for:', userEmail);
        }

        // Show job assignment modal
        function showJobAssignmentModal(freelancerName) {
            const freelancer = freelancers.find(f => f.name === freelancerName);
            if (!freelancer) {
                showNotification('Freelancer not found', 'error');
                return;
            }

            // Get available jobs from jobs-data.json
            const availableJobs = jobs.filter(job => !freelancer.jobs.some(userJob => userJob.id === job.id));
            
            let jobsHTML = '';
            if (availableJobs.length > 0) {
                jobsHTML = availableJobs.map(job => `
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.2);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">${job.title}</h4>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 0.5rem;">${job.location}</p>
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">${job.eventDate}</p>
                        <button onclick="assignJobToUser('${freelancerName}', '${job.id}')" 
                                style="background: #22c55e; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Assign Job
                        </button>
                    </div>
                `).join('');
            } else {
                jobsHTML = '<p style="color: rgba(255,255,255,0.7);">No available jobs to assign.</p>';
            }

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-briefcase"></i> Assign Jobs to ${freelancerName}</h2>
                        <button onclick="closeModal(this)" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">Available Jobs:</h3>
                        ${jobsHTML}
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">Payment Method Setup:</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Payment Method:</label>
                                <select id="paymentMethod_${freelancerName}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                    <option value="">Select payment method</option>
                                    <option value="cash" ${freelancer.paymentMethod === 'cash' ? 'selected' : ''}>Cash</option>
                                    <option value="check" ${freelancer.paymentMethod === 'check' ? 'selected' : ''}>Check</option>
                                    <option value="zelle" ${freelancer.paymentMethod === 'zelle' ? 'selected' : ''}>Zelle</option>
                                    <option value="paypal" ${freelancer.paymentMethod === 'paypal' ? 'selected' : ''}>PayPal</option>
                                    <option value="invoice" ${freelancer.paymentMethod === 'invoice' ? 'selected' : ''}>Invoice Request</option>
                                </select>
                            </div>
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Payment Status:</label>
                                <select id="paymentStatus_${freelancerName}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                    <option value="pending">Pending</option>
                                    <option value="processing">Processing</option>
                                    <option value="paid">Paid</option>
                                    <option value="overdue">Overdue</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="updatePaymentSettings('${freelancerName}')" 
                                style="background: #FFB200; color: #000; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-save"></i> Update Payment Settings
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Assign job to user
        function assignJobToUser(freelancerName, jobId) {
            const freelancer = freelancers.find(f => f.name === freelancerName);
            const job = jobs.find(j => j.id === jobId);
            
            if (!freelancer || !job) {
                showNotification('Freelancer or job not found', 'error');
                return;
            }

            // Add job to freelancer's jobs array
            if (!freelancer.jobs) {
                freelancer.jobs = [];
            }
            
            const newJob = {
                id: job.id,
                role: job.title,
                location: job.location,
                projectStart: job.eventDate,
                rate: job.rate || '$TBD',
                projectType: job.title,
                description: job.description || `Assigned job: ${job.title}`,
                status: 'upcoming'
            };
            
            freelancer.jobs.push(newJob);
            
            // Update project status
            if (!projectStatus[freelancerName]) {
                projectStatus[freelancerName] = { jobs: {} };
            }
            
            projectStatus[freelancerName].jobs[jobId] = {
                id: job.id,
                role: job.title,
                location: job.location,
                projectStart: job.eventDate,
                rate: job.rate || '$TBD',
                projectStatus: 'upcoming',
                paymentStatus: 'pending',
                projectType: job.title,
                description: job.description || `Assigned job: ${job.title}`
            };
            
            // Update GitHub
            updateFreelancersOnGitHub();
            updateProjectStatusOnGitHub();
            
            showNotification(`‚úÖ Job "${job.title}" assigned to ${freelancerName} successfully!`, 'success');
            
            // Close modal
            document.querySelector('div[style*="position: fixed"]').remove();
        }

        // Update payment settings
        function updatePaymentSettings(freelancerName) {
            const freelancer = freelancers.find(f => f.name === freelancerName);
            if (!freelancer) {
                showNotification('Freelancer not found', 'error');
                return;
            }
            
            const paymentMethod = document.getElementById(`paymentMethod_${freelancerName}`).value;
            const paymentStatus = document.getElementById(`paymentStatus_${freelancerName}`).value;
            
            if (!paymentMethod) {
                showNotification('Please select a payment method', 'warning');
                return;
            }
            
            // Update freelancer's payment settings
            freelancer.paymentMethod = paymentMethod;
            freelancer.paymentStatus = paymentStatus;
            
            // Update all jobs for this freelancer
            if (projectStatus[freelancerName] && projectStatus[freelancerName].jobs) {
                Object.values(projectStatus[freelancerName].jobs).forEach(job => {
                    job.paymentStatus = paymentStatus;
                    job.paymentMethod = paymentMethod;
                });
            }
            
            // Update GitHub
            updateFreelancersOnGitHub();
            updateProjectStatusOnGitHub();
            
            showNotification(`‚úÖ Payment settings updated for ${freelancerName}!\nMethod: ${paymentMethod}\nStatus: ${paymentStatus}`, 'success');
        }
        
        // Show project status manager modal
        function showProjectStatusManager(freelancerName) {
            const freelancer = freelancers.find(f => f.name === freelancerName);
            if (!freelancer) {
                showNotification('Freelancer not found', 'error');
                return;
            }
            
            const userProjects = projectStatus[freelancerName] || { jobs: {} };
            let jobs = Object.values(userProjects.jobs);
            
            // If no jobs in project status, create a default job from freelancer data
            if (jobs.length === 0) {
                const defaultJobId = freelancer.primaryJob || `job-${freelancerName.toLowerCase().replace(/\s+/g, '-')}-default`;
                const defaultJob = {
                    id: defaultJobId,
                    role: freelancer.role,
                    location: freelancer.location,
                    projectStart: freelancer.projectStart,
                    rate: freelancer.rate,
                    projectStatus: 'upcoming',
                    paymentStatus: 'pending',
                    projectType: freelancer.role + ' Project',
                    description: `Primary assignment for ${freelancerName}`
                };
                
                // Add to project status
                if (!projectStatus[freelancerName]) {
                    projectStatus[freelancerName] = { jobs: {} };
                }
                projectStatus[freelancerName].jobs[defaultJobId] = defaultJob;
                jobs = [defaultJob];
                
                console.log(`üìã Created default job for ${freelancerName}:`, defaultJob);
            }
            
            let jobsHTML = '';
            if (jobs.length > 0) {
                jobsHTML = jobs.map(job => `
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.2);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">${job.role}</h4>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">${job.description || 'No description'}</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Project Status:</label>
                                <select id="projectStatus_${job.id}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                    <option value="upcoming" ${job.projectStatus === 'upcoming' ? 'selected' : ''}>Upcoming</option>
                                    <option value="in-progress" ${job.projectStatus === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                    <option value="completed" ${job.projectStatus === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="cancelled" ${job.projectStatus === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                </select>
                            </div>
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Payment Status:</label>
                                <select id="paymentStatus_${job.id}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                    <option value="pending" ${job.paymentStatus === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="processing" ${job.paymentStatus === 'processing' ? 'selected' : ''}>Processing</option>
                                    <option value="paid" ${job.paymentStatus === 'paid' ? 'selected' : ''}>Paid</option>
                                    <option value="overdue" ${job.paymentStatus === 'overdue' ? 'selected' : ''}>Overdue</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="updateJobStatus('${freelancerName}', '${job.id}')" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                            Update Status
                        </button>
                    </div>
                `).join('');
            } else {
                jobsHTML = '<p style="color: rgba(255,255,255,0.6); font-style: italic;">No jobs found for this freelancer.</p>';
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #1a1a1a;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                ">
                    <button onclick="this.closest('div[style*=\'position: fixed\']').remove()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                            ">√ó</button>
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">üìä Project Status Manager</h3>
                    <h4 style="color: white; margin-bottom: 1rem;">${freelancerName}</h4>
                    ${jobsHTML}
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Update job status from modal
        function updateJobStatus(freelancerName, jobId) {
            const projectStatusSelect = document.getElementById(`projectStatus_${jobId}`);
            const paymentStatusSelect = document.getElementById(`paymentStatus_${jobId}`);
            
            if (!projectStatusSelect || !paymentStatusSelect) {
                showNotification('Status elements not found', 'error');
                return;
            }
            
            const newProjectStatus = projectStatusSelect.value;
            const newPaymentStatus = paymentStatusSelect.value;
            
            updateProjectStatus(freelancerName, jobId, newProjectStatus, newPaymentStatus);
            
            // Close modal
            document.querySelector('div[style*="position: fixed"]').remove();
            
            showNotification(`‚úÖ Updated project status for ${freelancerName} - ${jobId}\nProject: ${newProjectStatus}\nPayment: ${newPaymentStatus}`, 'success');
        }
        
        // ==================== AUTOMATIC JSON GENERATION ====================
        
        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication status
            const session = sessionStorage.getItem('adminDashboardAuthenticated');
            if (session === 'true') {
                isAuthenticated = true;
                showAdminInterface();
            }
        });

        // ==================== PROFESSIONAL NOTIFICATION SYSTEM ====================
        
        // Enhanced notification system to replace all alert() calls
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            const icon = getNotificationIcon(type);
            const colors = getNotificationColors(type);
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                background: ${colors.background};
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                border: 1px solid ${colors.border};
                max-width: 400px;
                min-width: 300px;
                backdrop-filter: blur(10px);
                transform: translateX(100%);
                transition: transform 0.3s ease-out;
                font-family: 'Poppins', sans-serif;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <div style="font-size: 1.2rem; margin-top: 2px;">${icon}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">
                            ${type.toUpperCase()}
                        </div>
                        <div style="font-size: 0.95rem; line-height: 1.4;">
                            ${message}
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="
                                background: rgba(255,255,255,0.2);
                                color: white;
                                border: none;
                                padding: 4px;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 24px;
                                height: 24px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 14px;
                                margin-left: 8px;
                                transition: background 0.2s;
                            "
                            onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                            onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        √ó
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Auto-remove after duration
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, duration);
        }
        
        function getNotificationIcon(type) {
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è',
                loading: 'üîÑ',
                contract: 'üìÑ',
                payment: 'üí∞',
                performance: '‚≠ê',
                github: 'üêô',
                email: 'üìß',
                job: 'üéØ',
                freelancer: 'üë§'
            };
            return icons[type] || icons.info;
        }
        
        function getNotificationColors(type) {
            const colors = {
                success: {
                    background: 'linear-gradient(135deg, #22c55e, #16a34a)',
                    border: 'rgba(34, 197, 94, 0.3)'
                },
                error: {
                    background: 'linear-gradient(135deg, #ef4444, #dc2626)',
                    border: 'rgba(239, 68, 68, 0.3)'
                },
                warning: {
                    background: 'linear-gradient(135deg, #f59e0b, #d97706)',
                    border: 'rgba(245, 158, 11, 0.3)'
                },
                info: {
                    background: 'linear-gradient(135deg, #3b82f6, #2563eb)',
                    border: 'rgba(59, 130, 246, 0.3)'
                },
                loading: {
                    background: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                    border: 'rgba(139, 92, 246, 0.3)'
                },
                contract: {
                    background: 'linear-gradient(135deg, #06b6d4, #0891b2)',
                    border: 'rgba(6, 182, 212, 0.3)'
                },
                payment: {
                    background: 'linear-gradient(135deg, #10b981, #059669)',
                    border: 'rgba(16, 185, 129, 0.3)'
                },
                performance: {
                    background: 'linear-gradient(135deg, #f59e0b, #d97706)',
                    border: 'rgba(245, 158, 11, 0.3)'
                },
                github: {
                    background: 'linear-gradient(135deg, #333, #24292e)',
                    border: 'rgba(51, 51, 51, 0.3)'
                },
                email: {
                    background: 'linear-gradient(135deg, #ec4899, #db2777)',
                    border: 'rgba(236, 72, 153, 0.3)'
                },
                job: {
                    background: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                    border: 'rgba(139, 92, 246, 0.3)'
                },
                freelancer: {
                    background: 'linear-gradient(135deg, #06b6d4, #0891b2)',
                    border: 'rgba(6, 182, 212, 0.3)'
                }
            };
            return colors[type] || colors.info;
        }
        
        // Enhanced showUpdateStatus function (backward compatibility)
        function showUpdateStatus(message, type) {
            showNotification(message, type);
        }
        
        // Replace all alert() calls with professional notifications
        function showAlert(message, type = 'info') {
            showNotification(message, type);
        }

        // ==================== MODAL MANAGEMENT ====================
        
        // Universal modal close function
        function closeModal(button) {
            const modal = button.closest('div[style*="position: fixed"]');
            if (modal) {
                modal.remove();
            }
        }
        
        // Enhanced notification for JSON updates
        function notifyJSONUpdate(fileName, action, details = '') {
            const messages = {
                'freelancers.json': {
                    'updated': `‚úÖ Freelancer data updated successfully!`,
                    'payment': `üí∞ Payment status updated for freelancer`,
                    'performance': `‚≠ê Performance review saved successfully!`
                },
                'jobs-data.json': {
                    'updated': `üéØ Job data updated successfully!`,
                    'assigned': `‚úÖ Job assigned to freelancer successfully!`
                },
                'project-status.json': {
                    'updated': `üìä Project status updated successfully!`,
                    'payment': `üí∞ Payment status updated for project`
                },
                'performance.json': {
                    'updated': `‚≠ê Performance review data updated successfully!`,
                    'created': `‚≠ê New performance review created!`
                },
                'uploaded-contracts.json': {
                    'updated': `üìÑ Contract data updated successfully!`,
                    'uploaded': `üìÑ New contract uploaded successfully!`
                }
            };
            
            const fileMessages = messages[fileName] || {};
            const message = fileMessages[action] || `‚úÖ ${fileName} updated successfully!`;
            
            showNotification(`${message} ${details}`, 'success');
        }
    </script>
    
    <style>
        :root {
            --primary: #FFB200;
            --primary-dark: #FF9000;
            --gold: #FFD700;
            --black: #000000;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray-medium: #6c757d;
            --gray-dark: #343a40;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Login Screen Styles */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            position: relative;
            overflow: hidden;
        }
        
        .login-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(255,178,0,0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .login-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 3rem;
            border-radius: 16px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.5),
                0 0 0 1px rgba(255,178,0,0.2);
            text-align: center;
            max-width: 450px;
            width: 100%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .login-logo {
            width: 140px;
            height: auto;
            margin-bottom: 2rem;
            filter: 
                drop-shadow(0 0 3px #FFB200)
                drop-shadow(0 0 6px #FFB200)
                drop-shadow(2px 2px 0px #000000);
            animation: logoGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes logoGlow {
            0% {
                filter: 
                    drop-shadow(0 0 3px #FFB200)
                    drop-shadow(0 0 6px #FFB200)
                    drop-shadow(2px 2px 0px #000000);
            }
            100% {
                filter: 
                    drop-shadow(0 0 5px #FFB200)
                    drop-shadow(0 0 8px #FFB200)
                    drop-shadow(2px 2px 0px #000000);
            }
        }
        
        .login-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .login-subtitle {
            color: rgba(255,255,255,0.8);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .login-form {
            text-align: left;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #FFB200;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-group input {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            font-size: 1rem;
            color: #fff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .form-group input:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.6);
            border-color: #FFB200;
            box-shadow: 0 0 0 2px rgba(255, 178, 0, 0.2);
        }
        
        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFB200;
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .login-btn:hover::before {
            transform: scaleX(1);
        }
        
        .login-btn:hover {
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        /* Main Admin Interface Styles */
        .admin-interface {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            position: relative;
        }
        
        .admin-interface::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(255,178,0,0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2rem;
            border-radius: 16px;
            margin: 2rem;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .header h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .header p {
            color: rgba(255,255,255,0.8);
            font-size: 1.1rem;
        }
        
        .logout-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: #FFB200;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem 2rem;
            margin: 0 2rem;
            border-radius: 16px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .tab-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: rgba(255, 178, 0, 0.1);
            border: 1px solid rgba(255, 178, 0, 0.3);
            color: #FFB200;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tab-btn:hover {
            background: rgba(255, 178, 0, 0.2);
            border-color: #FFB200;
        }
        
        .tab-btn.active {
            background: #FFB200;
            color: #000;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            margin: 2rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Common Form Styles */
        .form-section {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .form-section h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: #FFB200;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .workflow-info {
            background: rgba(255,178,0,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,178,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .workflow-info p {
            color: rgba(255,255,255,0.9);
            margin-bottom: 1rem;
        }
        
        .workflow-info ol {
            color: rgba(255,255,255,0.8);
            padding-left: 1.5rem;
        }
        
        .workflow-info li {
            margin-bottom: 0.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #FFB200;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
        }
        
        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.6);
            border-color: #FFB200;
            box-shadow: 0 0 0 2px rgba(255, 178, 0, 0.2);
        }
        
        textarea {
            height: 100px;
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            margin-right: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFB200;
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn:hover::before {
            transform: scaleX(1);
        }
        
        .btn:hover {
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        /* List Styles */
        .list-section {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .list-section h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: #FFB200;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .item-card {
            border: 1px solid rgba(255,178,0,0.3);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .item-card:hover {
            border-color: #FFB200;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255,178,0,0.2);
        }
        
        .item-card h3 {
            margin: 0 0 0.5rem 0;
            color: #FFB200;
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
        }
        
        .item-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            flex-wrap: wrap;
        }
        
        .item-description {
            margin: 1rem 0;
            line-height: 1.6;
            color: rgba(255,255,255,0.9);
        }
        
        .actions {
            margin-top: 1rem;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        /* Upload section styles removed - manual upload functionality no longer needed */
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .login-container {
                margin: 1rem;
                padding: 2rem;
            }
            
            .header, .tab-navigation, .tab-content {
                margin: 1rem;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                justify-content: center;
            }
            
            .item-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }
        }

        /* Export Section Styles */
        .export-section {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }

        .export-section h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: #FFB200;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }

        .export-section pre {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: #fff;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <img src="https://static.wixstatic.com/media/aeef42_d31420a75a164d2cb4508bdd7d99ca88~mv2.png" alt="Cochran Films" class="login-logo">
            <h1 class="login-title">‚öôÔ∏è Admin Dashboard</h1>
            <p class="login-subtitle">Manage jobs and contracts from one central location</p>
            
            <div id="errorMessage" class="error-message">
                Incorrect password. Please try again.
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" value="admin" readonly style="background: rgba(255,255,255,0.1);">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn">üîê Login</button>
            </form>
        </div>
    </div>

    <!-- Main Admin Interface -->
    <div id="adminInterface" class="admin-interface">
        <div class="header">
            <a href="#" class="logout-btn" onclick="logout()">üö™ Logout</a>
            <h1>‚öôÔ∏è Admin Dashboard</h1>
            <p>Cochran Films - Central Management System</p>
            <div style="margin-top: 1rem;">
                <a href="https://collaborate.cochranfilms.com" style="color: #FFB200; text-decoration: none; font-weight: 600; margin-right: 1rem;">üìã Job Listings</a>
                <a href="contract.html" style="color: #FFB200; text-decoration: none; font-weight: 600; margin-right: 1rem;">üîê Contract Access</a>
                <a href="user-portal.html" style="color: #FFB200; text-decoration: none; font-weight: 600;">üë§ User Portal</a>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('jobs')">
                    <span>üìã</span> Job Listings
                </button>
                <button class="tab-btn" onclick="switchTab('contracts')">
                    <span>üë•</span> Creator Management
                </button>

            </div>
        </div>

        <!-- Jobs Tab -->
        <div id="jobs-tab" class="tab-content active">
            <div class="form-section">
                <h2>üìã How Job Management Works</h2>
                <div class="workflow-info">
                    <p><strong>Workflow:</strong></p>
                    <ol>
                        <li><strong>Add/Edit Jobs</strong> ‚Üí Use this admin panel to create job listings</li>
                        <li><strong>Export JSON</strong> ‚Üí Download the updated jobs-data.json file</li>
                        <li><strong>Update Website</strong> ‚Üí Replace the jobs-data.json file on your server</li>
                        <li><strong>Google Sheet</strong> ‚Üí Handles all applicant submissions automatically</li>
                    </ol>
                    <p><strong>Note:</strong> The Google Sheet handles applicant data separately - this admin panel only manages job listings.</p>
                </div>
                
                <h2>Add/Edit Job</h2>
                <form id="jobForm">
                    <div class="form-group">
                        <label for="jobTitle">Job Title *</label>
                        <input type="text" id="jobTitle" name="title" placeholder="Enter job title" required>
                    </div>
                    <div class="form-group">
                        <label for="jobDate">Event Date</label>
                        <input type="datetime-local" id="jobDate" name="date">
                    </div>
                    <div class="form-group">
                        <label for="jobLocation">Location</label>
                        <select id="jobLocation" name="location" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a location...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jobPay">Pay Rate</label>
                        <select id="jobPay" name="pay" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a rate...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jobDescription">Description</label>
                        <textarea id="jobDescription" name="description" placeholder="Describe the role, requirements, and responsibilities..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="jobStatus">Status</label>
                        <select id="jobStatus" name="status">
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Save Job</button>
                    <button type="button" class="btn" onclick="clearJobForm()">Clear Form</button>
                </form>
            </div>

            <div class="list-section">
                <h2>Current Jobs</h2>
                <div id="jobsList"></div>
            </div>

            <div class="export-section">
                <h2>Export Job Data</h2>
                <p>Export your job listings to update <code>jobs-data.json</code>:</p>
                <button class="btn" onclick="exportJobData()">Generate JSON</button>
                <button class="btn" onclick="downloadJobJSON()" id="downloadJobBtn" style="display: none;">Download jobs-data.json</button>
                <pre id="exportJobData"></pre>
            </div>
        </div>

        <!-- Contracts Tab -->
        <div id="contracts-tab" class="tab-content">
            <div class="form-section">
                <h2>üë• How Creator Management Works</h2>
                <div class="workflow-info">
                    <p><strong>üöÄ Fully Automated Creator Management:</strong></p>
                    <ol>
                        <li><strong>Add Creators</strong> ‚Üí Use dropdown selectors for all fields (roles, locations, rates, dates)</li>
                        <li><strong>Auto-Job Creation</strong> ‚Üí Primary job automatically created from creator details</li>
                        <li><strong>Auto-Approval</strong> ‚Üí When you save a new creator, they automatically receive a job acceptance email</li>
                        <li><strong>Manual Approval</strong> ‚Üí For existing creators, click the "‚úÖ Approve" button to send job acceptance email</li>
                        <li><strong>Additional Jobs</strong> ‚Üí Assign extra jobs to creators using managed dropdown options</li>
                        <li><strong>Contract Signing</strong> ‚Üí Creators sign contracts directly on contract.html and set their own password</li>
                        <li><strong>Automatic Updates</strong> ‚Üí Password and contract status automatically update in freelancers.json</li>
                        <li><strong>Email Notifications</strong> ‚Üí You get instant email alerts when contracts are signed</li>
                        <li><strong>Real-time Dashboard</strong> ‚Üí See password status and contract progress in real-time</li>
                        <li><strong>Managed Options</strong> ‚Üí All dropdown options are managed through the dropdown management system</li>
                    </ol>
                    <p><strong>üìß Email Setup:</strong> Configure EmailJS credentials in contract.html to receive signing notifications.</p>
                    <p><strong>üéØ Benefits:</strong> No password conflicts! Creators set their own passwords during contract signing, and everything updates automatically with managed dropdown options.</p>
                </div>
                
                <h2>Add/Edit Creator</h2>
                <form id="contractForm">
                    <div class="form-group">
                        <label for="freelancerName">Full Name *</label>
                        <input type="text" id="freelancerName" name="name" placeholder="Enter creator's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="freelancerEmail">Email Address *</label>
                        <input type="email" id="freelancerEmail" name="email" placeholder="Enter creator's email address" required>
                    </div>
                    <div class="form-group">
                        <label for="freelancerPassword" style="color: rgba(255,255,255,0.6);">Portal Password</label>
                        <input type="text" id="freelancerPassword" name="password" placeholder="Password will be set by creator during contract signing" readonly style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6);">
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            üîÑ Password will be set automatically when creator signs their contract
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="contractUrl">Contract URL *</label>
                        <input type="text" id="contractUrl" name="contractUrl" placeholder="contract.html" value="contract.html" readonly style="background: rgba(255,255,255,0.1);">
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            üìù All creators use the same contract.html portal. No individual files needed!
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="freelancerRole">Role *</label>
                        <select id="freelancerRole" name="role" required style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a role...</option>
                            <option value="Backdrop Photographer">Backdrop Photographer</option>
                            <option value="Editor">Editor</option>
                            <option value="Videographer">Videographer</option>
                            <option value="Photographer">Photographer</option>
                            <option value="Full Stack Designer">Full Stack Designer</option>
                            <option value="Video Editor">Video Editor</option>
                            <option value="Corporate Videographer">Corporate Videographer</option>
                        </select>
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            üí° Based on existing roles in your system
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="freelancerLocation">Project Location</label>
                        <select id="freelancerLocation" name="location" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a location...</option>
                            <option value="6695 Church Street, Douglasville, GA 30134">6695 Church Street, Douglasville, GA 30134</option>
                            <option value="Sandy Springs, GA">Sandy Springs, GA</option>
                            <option value="Douglasville, GA">Douglasville, GA</option>
                            <option value="Atlanta, GA">Atlanta, GA</option>
                            <option value="Atlanta Area">Atlanta Area</option>
                        </select>
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            üìç Based on existing locations in your system
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="projectStart">Project Start Date & Time</label>
                        <input type="datetime-local" id="projectStart" name="projectStart" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            üìÖ Select date and time for project start
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="freelancerRate">Rate *</label>
                        <select id="freelancerRate" name="rate" required style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a rate...</option>
                            <option value="$400.00 USD (Flat)">$400.00 USD (Flat)</option>
                            <option value="$900.00 USD (Flat)">$900.00 USD (Flat)</option>
                            <option value="$300 + Tip">$300 + Tip</option>
                            <option value="$450.00 USD (Flat)">$450.00 USD (Flat)</option>
                            <option value="$750.00 USD (Flat)">$750.00 USD (Flat)</option>
                            <option value="$500.00 USD (Flat)">$500.00 USD (Flat)</option>
                        </select>
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            üí∞ Based on existing rates in your system
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="approvedDate">Approved Date</label>
                        <input type="date" id="approvedDate" name="approvedDate" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                    </div>
                    <button type="submit" class="btn">Save Freelancer</button>
                    <button type="button" class="btn" onclick="clearContractForm()">Clear Form</button>
                </form>
            </div>

            <div class="list-section">
                <h2>Current Creators</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <p style="color: rgba(255,255,255,0.7); margin: 0;">Manage your creator contracts and assignments</p>
                        <p id="freelancerStatus" style="color: #22c55e; margin: 0.25rem 0 0 0; font-size: 0.9rem;">Loading creators...</p>
                    </div>
                    <button class="btn" onclick="refreshFreelancers()" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white;">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
                <div id="contractsList"></div>
            </div>

            <!-- Job Assignment Section -->
            <div class="form-section">
                <h2>üéØ Assign Additional Jobs to Creators</h2>
                <div class="workflow-info">
                    <p><strong>Additional Job Assignment:</strong> Assign extra jobs to creators using managed dropdown options. The primary job is automatically created from the creator details when you save them.</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">Select Creator</h3>
                        <select id="jobAssignmentFreelancer" style="margin-bottom: 1rem;">
                            <option value="">Choose a creator...</option>
                        </select>
                        
                        <div id="freelancerJobInfo" style="display: none; background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(255,178,0,0.3); margin-bottom: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Current Jobs:</h4>
                            <div id="currentJobsList"></div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="color: #22c55e; margin-bottom: 1rem;">Add New Job</h3>
                        <form id="jobAssignmentForm">
                            <div class="form-group">
                                <label for="jobId">Job ID *</label>
                                <input type="text" id="jobId" placeholder="e.g., job-001" required>
                            </div>
                            <div class="form-group">
                                <label for="jobRole">Role</label>
                                <select id="jobRole" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a role...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobLocation">Location</label>
                                <select id="assignmentJobLocation" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a location...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobProjectStart">Project Start</label>
                                <input type="datetime-local" id="assignmentJobProjectStart" placeholder="Select date and time">
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobRate">Rate</label>
                                <select id="assignmentJobRate" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a rate...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobStatus">Status</label>
                                <select id="assignmentJobStatus">
                                    <option value="upcoming">Upcoming</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobProjectType">Project Type</label>
                                <select id="assignmentJobProjectType" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a project type...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobDescription">Description</label>
                                <textarea id="assignmentJobDescription" placeholder="Describe the job requirements..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="primaryJobCheckbox">
                                    <input type="checkbox" id="primaryJobCheckbox" style="width: auto; margin-right: 0.5rem;">
                                    Set as Primary Job
                                </label>
                            </div>
                            <button type="submit" class="btn">Add Job</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="export-section">
                <h2>GitHub Integration</h2>
                <p>Manage your GitHub token for automatic updates:</p>
                <button class="btn" onclick="showTokenManager()" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
                    <i class="fas fa-key"></i> Manage GitHub Token
                </button>
            </div>

            <!-- Dropdown Options Management Section -->
            <div class="form-section">
                <h2>‚öôÔ∏è Manage Dropdown Options</h2>
                <div class="workflow-info">
                    <p><strong>Dropdown Management:</strong> Add and manage options for dropdown selectors throughout the admin dashboard. These options are automatically loaded from dropdown-options.json and saved to GitHub for persistence across sessions.</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <!-- Roles Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">üéØ Roles</h3>
                        <div class="form-group">
                            <input type="text" id="newRole" placeholder="Add new role (e.g., Videographer)" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('roles', 'newRole')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Role
                            </button>
                        </div>
                        <div id="rolesList" style="margin-top: 1rem;">
                            <!-- Roles will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Locations Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">üìç Locations</h3>
                        <div class="form-group">
                            <input type="text" id="newLocation" placeholder="Add new location (e.g., Atlanta, GA)" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('locations', 'newLocation')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Location
                            </button>
                        </div>
                        <div id="locationsList" style="margin-top: 1rem;">
                            <!-- Locations will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Rates Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">üí∞ Rates</h3>
                        <div class="form-group">
                            <input type="text" id="newRate" placeholder="Add new rate (e.g., $500.00 USD (Flat))" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('rates', 'newRate')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Rate
                            </button>
                        </div>
                        <div id="ratesList" style="margin-top: 1rem;">
                            <!-- Rates will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Project Types Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">üé¨ Project Types</h3>
                        <div class="form-group">
                            <input type="text" id="newProjectType" placeholder="Add new project type (e.g., Corporate Video)" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('projectTypes', 'newProjectType')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Project Type
                            </button>
                        </div>
                        <div id="projectTypesList" style="margin-top: 1rem;">
                            <!-- Project types will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; text-align: center;">
                    <button class="btn" onclick="saveDropdownOptions()" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white;">
                        <i class="fas fa-save"></i> Save All Dropdown Options
                    </button>
                    <button class="btn" onclick="loadDropdownOptions()" style="background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; margin-left: 1rem;">
                        <i class="fas fa-sync"></i> Refresh Options
                    </button>
                </div>
            </div>

            <div class="export-section">
                <h2>üìß Email Notification Setup</h2>
                <p>To receive email notifications when contracts are signed, configure EmailJS in contract.html:</p>
                <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2); margin-bottom: 2rem;">
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">Setup Instructions:</h3>
                    <ol style="color: rgba(255,255,255,0.9); line-height: 1.6;">
                        <li><strong>Sign up for EmailJS:</strong> Go to <a href="https://www.emailjs.com/" target="_blank" style="color: #FFB200;">emailjs.com</a> and create a free account</li>
                        <li><strong>Create Email Service:</strong> Connect your email provider (Gmail, Outlook, etc.)</li>
                        <li><strong>Create Email Template:</strong> Design your contract signing notification email</li>
                        <li><strong>Get Credentials:</strong> Copy your Public Key, Service ID, and Template ID</li>
                        <li><strong>Update contract.html:</strong> Replace the placeholder values in EMAILJS_CONFIG</li>
                    </ol>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,178,0,0.1); border-radius: 8px; border: 1px solid rgba(255,178,0,0.3);">
                        <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 0.9rem;">
                            üí° <strong>Template Variables Available:</strong><br>
                            freelancer_name, freelancer_email, role, location, project_start, rate, signature_date, signed_timestamp, effective_date
                        </p>
                    </div>
                </div>
                
                <div style="background: rgba(34, 197, 94, 0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(34, 197, 94, 0.3);">
                    <h3 style="color: #22c55e; margin-bottom: 0.5rem;">üöÄ Automated Workflow Benefits:</h3>
                    <ul style="color: rgba(255,255,255,0.9); margin: 0;">
                        <li>‚úÖ No more individual HTML file generation</li>
                        <li>‚úÖ Automatic email notifications when contracts are signed</li>
                        <li>‚úÖ Digital signature validation and verification</li>
                        <li>‚úÖ Instant signed PDF downloads for creators</li>
                        <li>‚úÖ Single contract.html portal handles everything</li>
                        <li>‚úÖ Managed dropdown options for consistent data entry</li>
                        <li>‚úÖ Persistent storage via GitHub API</li>
                    </ul>
                </div>
            </div>
        </div>




</body>
</html>

