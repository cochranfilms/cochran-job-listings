<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Cochran Films</title>
    
    <!-- Favicon -->
    <link rel="icon" href="https://static.wixstatic.com/media/aeef42_570164eee75f4394a4fc1cf9c62ceae0~mv2.png" type="image/png">
    
    <!-- Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- JSZip for contract file generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- Secure Bank Storage -->
    <script src="secure-bank-storage.js"></script>
    <script src="admin-bank-viewer.js"></script>
    
    <style>
        :root {
            --primary: #FFB200;
            --primary-dark: #FF9000;
            --gold: #FFD700;
            --black: #000000;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray-medium: #6c757d;
            --gray-dark: #343a40;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            position: relative;
        }
        
        .login-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 3rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 450px;
            width: 100%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.3);
        }
        
        .login-logo {
            width: 140px;
            height: auto;
            margin-bottom: 2rem;
            filter: drop-shadow(0 0 3px #FFB200);
        }
        
        .login-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 1rem;
        }
        
        .login-subtitle {
            color: rgba(255,255,255,0.8);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #FFB200;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-group input {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            font-size: 1rem;
            color: #fff;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #FFB200;
            box-shadow: 0 0 0 2px rgba(255, 178, 0, 0.2);
        }
        
        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }
        
        /* Dashboard Layout */
        .dashboard {
            display: none;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .dashboard-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
        }
        
        .dashboard-header h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 0.5rem;
        }
        
        .dashboard-header p {
            color: rgba(255,255,255,0.8);
            font-size: 1.1rem;
        }
        
        .logout-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: #FFB200;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(255,178,0,0.2);
        }
        
        .stat-icon {
            font-size: 3rem;
            color: #FFB200;
            margin-bottom: 1rem;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: rgba(255,255,255,0.8);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }
        
        .content-card {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            overflow: hidden;
        }
        
        .card-header {
            background: rgba(255,178,0,0.1);
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255,178,0,0.3);
        }
        
        .card-header h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: #FFB200;
            margin: 0;
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        /* Form Styles */
        .form-section {
            margin-bottom: 2rem;
        }
        
        .form-section h3 {
            color: #FFB200;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #FFB200;
            box-shadow: 0 0 0 2px rgba(255, 178, 0, 0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            margin-right: 1rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        .btn-secondary {
            background: rgba(255,178,0,0.2);
            color: #FFB200;
            border: 1px solid rgba(255,178,0,0.5);
        }
        
        /* List Styles */
        .item-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .item-card {
            border: 1px solid rgba(255,178,0,0.3);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }
        
        .item-card:hover {
            border-color: #FFB200;
            transform: translateY(-2px);
        }
        
        .item-card h4 {
            color: #FFB200;
            margin-bottom: 0.5rem;
        }
        
        .item-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            flex-wrap: wrap;
        }
        
        .item-actions {
            margin-top: 1rem;
        }
        
        .item-description {
            margin: 1rem 0;
            line-height: 1.6;
            color: rgba(255,255,255,0.9);
            font-size: 0.9rem;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .dashboard {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .login-container {
                margin: 1rem;
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <img src="Logo.png" alt="Cochran Films" class="login-logo">
            <h1 class="login-title">‚öôÔ∏è Admin Dashboard</h1>
            <p class="login-subtitle">Manage jobs and contracts from one central location</p>
            
            <div id="errorMessage" class="error-message">
                Incorrect password. Please try again.
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="login-btn">üîê Login</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="dashboard-header">
            <a href="#" class="logout-btn" onclick="logout()">üö™ Logout</a>
            <h1>‚öôÔ∏è Admin Dashboard</h1>
            <p>Cochran Films - Central Management System</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-number" id="totalCreators">0</div>
                <div class="stat-label">Total Creators</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìã</div>
                <div class="stat-number" id="activeJobs">0</div>
                <div class="stat-label">Active Jobs</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìÑ</div>
                <div class="stat-number" id="pendingReviews">0</div>
                <div class="stat-label">Pending Reviews</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-number" id="totalContracts">0</div>
                <div class="stat-label">Signed Contracts</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Unified User & Contract Management -->
            <div class="content-card">
                <div class="card-header">
                    <h2>üë• User & Contract Management</h2>
                </div>
                <div class="card-content">
                    <div class="form-section">
                        <h3>Add New User</h3>
                        <form id="contractForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <input type="text" id="freelancerName" placeholder="Full Name" required>
                                <input type="email" id="freelancerEmail" placeholder="Email Address" required>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <select id="freelancerRole" required>
                                    <option value="">Select Role...</option>
                                    <!-- Populated with roles from dropdown-options.json -->
                                </select>
                                <select id="freelancerLocation" required>
                                    <option value="">Select Location...</option>
                                    <!-- Populated with locations from dropdown-options.json -->
                                </select>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <select id="freelancerRate" required>
                                    <option value="">Select Rate...</option>
                                    <!-- Populated with rates from dropdown-options.json -->
                                </select>
                                <input type="date" id="approvedDate" placeholder="Approved Date">
                            </div>
                            <input type="url" id="contractUrl" placeholder="Contract URL" required>
                            <button type="submit" class="btn">Save User</button>
                            <button type="button" class="btn btn-secondary" onclick="clearContractForm()">Clear</button>
                        </form>
                    </div>
                    
                    <div class="form-section">
                        <h3>Quick Actions</h3>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn" onclick="generateAllContracts()">üìÑ Generate All Contracts</button>
                            <button class="btn btn-secondary" onclick="exportUsersData()">üìä Export Users</button>
                            <button class="btn btn-secondary" onclick="downloadUsersJSON()" id="downloadUsersBtn" style="display: none;">üì• Download Users</button>
                            <button class="btn btn-secondary" onclick="downloadContractFiles()" id="downloadContractsBtn" style="display: none;">üì• Download Contracts</button>
                        </div>
                        <div id="contractGenerationStatus"></div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Current Users & Contracts</h3>
                        <div class="item-list" id="usersList">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dropdown Management -->
            <div class="content-card">
                <div class="card-header">
                    <h2>‚öôÔ∏è Dropdown Management</h2>
                </div>
                <div class="card-content">
                    <div class="form-section">
                        <h3>Manage Dropdown Options</h3>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">
                            Add or remove options for roles, locations, rates, and project types used throughout the system.
                        </p>
                        
                        <!-- Roles Management -->
                        <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">üé≠ Roles</h4>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="text" id="newRole" placeholder="Add new role" style="flex: 1;">
                                <button onclick="addDropdownOption('roles', 'newRole')" style="background: #22c55e; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="rolesList" style="max-height: 150px; overflow-y: auto;"></div>
                        </div>
                        
                        <!-- Locations Management -->
                        <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">üìç Locations</h4>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="text" id="newLocation" placeholder="Add new location" style="flex: 1;">
                                <button onclick="addDropdownOption('locations', 'newLocation')" style="background: #22c55e; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="locationsList" style="max-height: 150px; overflow-y: auto;"></div>
                        </div>
                        
                        <!-- Rates Management -->
                        <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">üí∞ Rates</h4>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="text" id="newRate" placeholder="Add new rate" style="flex: 1;">
                                <button onclick="addDropdownOption('rates', 'newRate')" style="background: #22c55e; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="ratesList" style="max-height: 150px; overflow-y: auto;"></div>
                        </div>
                        
                        <!-- Project Types Management -->
                        <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">üé¨ Project Types</h4>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <input type="text" id="newProjectType" placeholder="Add new project type" style="flex: 1;">
                                <button onclick="addDropdownOption('projectTypes', 'newProjectType')" style="background: #22c55e; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            <div id="projectTypesList" style="max-height: 150px; overflow-y: auto;"></div>
                        </div>
                        
                        <!-- Save Button -->
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button onclick="saveDropdownOptions()" style="background: linear-gradient(135deg, #FFB200, #FF8C00); color: #1a1a1a; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1rem;">
                                <i class="fas fa-save"></i> Save All Changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Job Management -->
            <div class="content-card">
                <div class="card-header">
                    <h2>üìã Job Management</h2>
                </div>
                <div class="card-content">
                    <div class="form-section">
                        <h3>Add New Job</h3>
                        <form id="jobForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <input type="text" id="jobTitle" placeholder="Job Title" required>
                                <input type="date" id="jobDate" placeholder="Event Date">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <input type="text" id="jobLocation" placeholder="Location" value="Atlanta Area">
                                <input type="text" id="jobPay" placeholder="Pay Rate">
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <select id="jobType">
                                    <option value="Photography">Photography</option>
                                    <option value="Videography">Videography</option>
                                    <option value="Event Coverage">Event Coverage</option>
                                    <option value="Portrait Session">Portrait Session</option>
                                    <option value="Commercial">Commercial</option>
                                    <option value="Wedding">Wedding</option>
                                    <option value="Other">Other</option>
                                </select>
                                <select id="jobStatus">
                                    <option value="Active">Active</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                            <textarea id="jobDescription" placeholder="Job Description" rows="3"></textarea>
                            <div class="form-actions">
                                <button type="submit" class="btn">‚ûï Add Job</button>
                                <button type="button" class="btn btn-secondary" onclick="clearJobForm()">üîÑ Clear</button>
                                <button type="button" class="btn btn-secondary" onclick="assignJobsToUsers()">üéØ Assign to Users</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="form-section">
                        <h3>Job Management Tools</h3>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn" onclick="exportJobData()">üìä Export Jobs</button>
                            <button class="btn btn-secondary" onclick="downloadJobJSON()" id="downloadJobBtn" style="display: none;">üì• Download Jobs</button>
                            <button class="btn btn-secondary" onclick="showJobStats()">üìà Job Statistics</button>
                            <button class="btn btn-secondary" onclick="bulkJobActions()">‚ö° Bulk Actions</button>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3>Current Jobs</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                <select id="jobFilter" onchange="filterJobs()" style="width: auto; margin: 0;">
                                    <option value="all">All Jobs</option>
                                    <option value="Active">Active</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                                <button class="btn btn-small" onclick="refreshJobs()">üîÑ Refresh</button>
                            </div>
                        </div>
                        <div class="item-list" id="jobsList">
                            <!-- Jobs will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration (secure)
        const firebaseConfig = {
            apiKey: 'AIzaSyCkL31Phi7FxYCeB5zgHeYTb2iY2sTJJdw',
            authDomain: 'cochran-films.firebaseapp.com',
            projectId: 'cochran-films',
            storageBucket: 'cochran-films.appspot.com',
            messagingSenderId: '566448458094',
            appId: '1:566448458094:web:default'
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Admin role management
        const ADMIN_EMAILS = [
            'info@cochranfilms.com',
            'admin@cochranfilms.com',
            'cody@cochranfilms.com'
        ];

        // Check if user has admin privileges
        function isAdminUser(email) {
            return ADMIN_EMAILS.includes(email.toLowerCase());
        }

        // Create Firebase account for new user
        async function createFirebaseAccount(email, password) {
            try {
                // Create user in Firebase Authentication
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                console.log('‚úÖ Firebase account created for:', email);
                
                // Sign out the admin user after creating the account
                await auth.signOut();
                
                return { success: true, uid: userCredential.user.uid };
            } catch (error) {
                console.error('‚ùå Error creating Firebase account:', error);
                
                // Handle specific errors
                let errorMessage = 'Failed to create account.';
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Email already exists in Firebase.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email format.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password is too weak.';
                        break;
                }
                
                return { success: false, error: errorMessage };
            }
        }

        // Create Firebase accounts for existing users
        async function createFirebaseAccountsForExistingUsers() {
            try {
                await loadUsers();
                
                let createdCount = 0;
                let errorCount = 0;
                
                for (const [userName, userData] of Object.entries(window.users || {})) {
                    const email = userData.profile?.email;
                    const password = userData.profile?.password;
                    
                    if (email && password) {
                        console.log(`üîÑ Creating Firebase account for: ${email}`);
                        
                        const result = await createFirebaseAccount(email, password);
                        
                        if (result.success) {
                            createdCount++;
                            showNotification(`‚úÖ Created Firebase account for ${email}`, 'success');
                        } else {
                            errorCount++;
                            showNotification(`‚ùå Failed to create account for ${email}: ${result.error}`, 'error');
                        }
                        
                        // Small delay to avoid rate limiting
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
                
                showNotification(`üéâ Firebase account creation complete! Created: ${createdCount}, Errors: ${errorCount}`, 'success');
                
            } catch (error) {
                console.error('‚ùå Error creating Firebase accounts:', error);
                showNotification('‚ùå Error creating Firebase accounts. Please try again.', 'error');
            }
                }
        
        // Session management - Make these global
        window.isAuthenticated = false;
        window.jobs = [];
        window.users = {};

        // Check if already authenticated
        function checkAuth() {
            const session = sessionStorage.getItem('adminDashboardAuthenticated');
            if (session === 'true') {
                isAuthenticated = true;
                showDashboard();
            } else {
                showLoginScreen();
            }
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            loadData();
            updateStats();
        }

        // Handle login with Firebase
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Signing in...';
            submitBtn.disabled = true;
            
            try {
                // Firebase authentication
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                
                // Check if user has admin privileges
                if (isAdminUser(userCredential.user.email)) {
                    sessionStorage.setItem('adminDashboardAuthenticated', 'true');
                    sessionStorage.setItem('adminUser', JSON.stringify({
                        email: userCredential.user.email,
                        uid: userCredential.user.uid
                    }));
                    isAuthenticated = true;
                    showDashboard();
                    document.getElementById('errorMessage').style.display = 'none';
                    document.getElementById('password').value = '';
                } else {
                    // For non-admin users, show access denied
                    document.getElementById('errorMessage').textContent = 'Access denied. Admin privileges required.';
                    document.getElementById('errorMessage').style.display = 'block';
                    document.getElementById('password').value = '';
                }
                
            } catch (error) {
                console.error('Login error:', error);
                
                // Handle specific Firebase errors
                let errorMessage = 'Login failed. Please try again.';
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'User not found. Please check your email.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password. Please try again.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email format.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Please try again later.';
                        break;
                }
                
                document.getElementById('errorMessage').textContent = errorMessage;
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('password').value = '';
            } finally {
                // Reset button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Logout with Firebase
        async function logout() {
            try {
                // Sign out from Firebase
                await auth.signOut();
                console.log('‚úÖ Successfully signed out from Firebase');
            } catch (error) {
                console.error('‚ùå Error signing out from Firebase:', error);
            }
            
            isAuthenticated = false;
            sessionStorage.removeItem('adminDashboardAuthenticated');
            sessionStorage.removeItem('adminUser');
            showLoginScreen();
        }

        // Load data
        async function loadData() {
            await loadJobs();
            await loadUsers();
            updateStats();
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalCreators').textContent = Object.keys(window.users).length;
            document.getElementById('activeJobs').textContent = window.jobs.filter(job => job.status === 'Active').length;
            
            // Count pending reviews (users who haven't been reviewed yet)
            const pendingReviews = Object.keys(window.users).filter(userName => {
                const user = window.users[userName];
                // Consider a user as needing review if they have a contract but no review data
                return user.contract?.contractStatus === 'signed' && !user.performanceReview;
            }).length;
            
            document.getElementById('pendingReviews').textContent = pendingReviews;
            document.getElementById('totalContracts').textContent = Object.keys(window.users).length;
        }

        // Load existing jobs
        async function loadJobs() {
            try {
                const response = await fetch('/api/jobs-data');
                if (response.ok) {
                    const data = await response.json();
                    window.jobs = data.jobs || [];
                }
            } catch (error) {
                console.log('No existing jobs file found, starting fresh');
                window.jobs = [];
            }
            displayJobs();
        }

        // Display jobs
        function displayJobs() {
            const jobsList = document.getElementById('jobsList');
            jobsList.innerHTML = '';

            window.jobs.forEach((job, index) => {
                const statusColors = {
                    'Active': '#22c55e',
                    'Pending': '#f59e0b',
                    'Completed': '#3b82f6',
                    'Cancelled': '#ef4444'
                };
                
                const jobDiv = document.createElement('div');
                jobDiv.className = 'item-card';
                jobDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <h4 style="margin: 0;">${job.title || 'Untitled Job'}</h4>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <span class="job-status" style="background: ${statusColors[job.status] || '#6b7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                ${job.status || 'Active'}
                            </span>
                            ${job.type ? `
                                <span style="background: rgba(255, 178, 0, 0.2); color: #FFB200; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                    ${job.type}
                                </span>
                            ` : ''}
                        </div>
                    </div>
                    <div class="item-meta">
                        <span>üìÖ ${job.date || 'TBD'}</span>
                        <span>üìç ${job.location || 'Location TBD'}</span>
                        <span>üí∞ ${job.pay || 'Pay TBD'}</span>
                        ${job.type ? `<span>üéØ ${job.type}</span>` : ''}
                    </div>
                    <div class="item-description">
                        ${job.description || 'No description provided'}
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small" onclick="editJob(${index})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small" onclick="duplicateJob(${index})">üìã Duplicate</button>
                        <button class="btn btn-small btn-danger" onclick="deleteJob(${index})">üóëÔ∏è Delete</button>
                    </div>
                `;
                jobsList.appendChild(jobDiv);
            });
        }

        // Add/Edit job
        document.getElementById('jobForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const job = {
                title: formData.get('title'),
                date: formData.get('date'),
                location: formData.get('location'),
                pay: formData.get('pay'),
                type: formData.get('type'),
                description: formData.get('description'),
                status: formData.get('status')
            };

            const editIndex = e.target.dataset.editIndex;
            if (editIndex !== undefined) {
                window.jobs[editIndex] = job;
                delete e.target.dataset.editIndex;
            } else {
                window.jobs.push(job);
            }

            displayJobs();
            updateStats();
            clearJobForm();
        });

        // Edit job
        function editJob(index) {
            const job = window.jobs[index];
            document.getElementById('jobTitle').value = job.title || '';
            document.getElementById('jobDate').value = job.date || '';
            document.getElementById('jobLocation').value = job.location || '';
            document.getElementById('jobPay').value = job.pay || '';
            document.getElementById('jobType').value = job.type || 'Photography';
            document.getElementById('jobDescription').value = job.description || '';
            document.getElementById('jobStatus').value = job.status || 'Active';
            
            document.getElementById('jobForm').dataset.editIndex = index;
        }

        // Duplicate job
        function duplicateJob(index) {
            const originalJob = window.jobs[index];
            const newJob = {
                ...originalJob,
                title: `${originalJob.title} (Copy)`,
                status: 'Active'
            };
            
            window.jobs.push(newJob);
            displayJobs();
            updateStats();
            showNotification('Job duplicated successfully', 'success');
        }

        // Delete job
        function deleteJob(index) {
            if (confirm('Are you sure you want to delete this job?')) {
                window.jobs.splice(index, 1);
                displayJobs();
                updateStats();
            }
        }

        // Clear job form
        function clearJobForm() {
            document.getElementById('jobForm').reset();
            document.getElementById('jobLocation').value = 'Atlanta Area';
            delete document.getElementById('jobForm').dataset.editIndex;
        }

        // Filter jobs by status
        function filterJobs() {
            const filterValue = document.getElementById('jobFilter').value;
            const jobCards = document.querySelectorAll('#jobsList .item-card');
            
            jobCards.forEach(card => {
                const statusElement = card.querySelector('.job-status');
                if (statusElement) {
                    const status = statusElement.textContent.trim();
                    if (filterValue === 'all' || status === filterValue) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }

        // Refresh jobs list
        function refreshJobs() {
            displayJobs();
            showNotification('Jobs list refreshed', 'success');
        }

        // Show job statistics
        function showJobStats() {
            const stats = {
                total: window.jobs.length,
                active: window.jobs.filter(job => job.status === 'Active').length,
                pending: window.jobs.filter(job => job.status === 'Pending').length,
                completed: window.jobs.filter(job => job.status === 'Completed').length,
                cancelled: window.jobs.filter(job => job.status === 'Cancelled').length
            };
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; border: 1px solid #FFB200; border-radius: 16px; padding: 2rem; max-width: 500px; width: 90%; color: white;">
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">üìà Job Statistics</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div style="background: rgba(255, 178, 0, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; color: #FFB200;">${stats.total}</div>
                            <div>Total Jobs</div>
                        </div>
                        <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; color: #22c55e;">${stats.active}</div>
                            <div>Active Jobs</div>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; color: #f59e0b;">${stats.pending}</div>
                            <div>Pending Jobs</div>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2rem; color: #3b82f6;">${stats.completed}</div>
                            <div>Completed Jobs</div>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn">Close</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Bulk job actions
        function bulkJobActions() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; border: 1px solid #FFB200; border-radius: 16px; padding: 2rem; max-width: 500px; width: 90%; color: white;">
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">‚ö° Bulk Job Actions</h3>
                    <div style="margin-bottom: 1rem;">
                        <p>Select jobs and perform bulk actions:</p>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem;">
                            <button class="btn btn-small" onclick="bulkUpdateStatus('Active')">‚úÖ Mark Active</button>
                            <button class="btn btn-small" onclick="bulkUpdateStatus('Completed')">‚úÖ Mark Completed</button>
                            <button class="btn btn-small" onclick="bulkUpdateStatus('Cancelled')">‚ùå Mark Cancelled</button>
                            <button class="btn btn-small btn-danger" onclick="bulkDeleteJobs()">üóëÔ∏è Delete Selected</button>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="btn btn-secondary">Close</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Bulk update job status
        function bulkUpdateStatus(newStatus) {
            const selectedJobs = window.jobs.filter((job, index) => {
                const checkbox = document.querySelector(`#job-${index}`);
                return checkbox && checkbox.checked;
            });
            
            if (selectedJobs.length === 0) {
                showNotification('Please select jobs to update', 'warning');
                return;
            }
            
            selectedJobs.forEach(job => {
                job.status = newStatus;
            });
            
            displayJobs();
            updateStats();
            showNotification(`${selectedJobs.length} jobs updated to ${newStatus}`, 'success');
        }

        // Bulk delete jobs
        function bulkDeleteJobs() {
            const selectedJobs = window.jobs.filter((job, index) => {
                const checkbox = document.querySelector(`#job-${index}`);
                return checkbox && checkbox.checked;
            });
            
            if (selectedJobs.length === 0) {
                showNotification('Please select jobs to delete', 'warning');
                return;
            }
            
            if (confirm(`Are you sure you want to delete ${selectedJobs.length} jobs?`)) {
                window.jobs = window.jobs.filter((job, index) => {
                    const checkbox = document.querySelector(`#job-${index}`);
                    return !checkbox || !checkbox.checked;
                });
                
                displayJobs();
                updateStats();
                showNotification(`${selectedJobs.length} jobs deleted`, 'success');
            }
        }

        // Export job data
        function exportJobData() {
            const data = {
                jobs: window.jobs,
                lastUpdated: new Date().toISOString().split('T')[0],
                totalJobs: window.jobs.length
            };
            
            document.getElementById('downloadJobBtn').style.display = 'block';
        }

        // Download job JSON
        function downloadJobJSON() {
            const data = {
                jobs: window.jobs,
                lastUpdated: new Date().toISOString().split('T')[0],
                totalJobs: window.jobs.length
            };
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'jobs-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }



        // Load existing users
        async function loadUsers() {
            try {
                const response = await fetch('users.json');
                if (response.ok) {
                    const data = await response.json();
                    window.users = data.users || {};
                }
            } catch (error) {
                console.log('No existing users file found, starting fresh');
                window.users = {};
            }
            displayUsers();
        }

        // Display users (unified display)
        function displayUsers() {
            const usersList = document.getElementById('usersList');
            
            if (usersList) {
                usersList.innerHTML = '';
            }

            Object.keys(window.users).forEach((name, index) => {
                const user = window.users[name];
                
                const userDiv = document.createElement('div');
                userDiv.className = 'item-card';
                userDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <h4 style="margin: 0;">${name}</h4>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <span style="background: ${user.contract?.contractStatus === 'signed' ? '#22c55e' : '#f59e0b'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                ${user.contract?.contractStatus === 'signed' ? '‚úÖ Contract Signed' : '‚è≥ Contract Pending'}
                            </span>
                            <span style="background: ${user.paymentMethod ? '#22c55e' : '#6b7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                ${user.paymentMethod ? 'üí≥ Payment Set' : 'üí≥ No Payment'}
                            </span>
                            ${user.jobs && Object.keys(user.jobs).length > 0 ? `
                                <span style="background: #3b82f6; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                    üéØ ${Object.keys(user.jobs).length} Job(s)
                                </span>
                            ` : ''}
                        </div>
                    </div>
                    <div class="item-meta">
                        <span>üìß ${user.profile?.email || 'Email not specified'}</span>
                        <span>üé≠ ${user.profile?.role || 'Role not specified'}</span>
                        <span>üìç ${user.profile?.location || 'Location not specified'}</span>
                        <span>üí∞ ${user.profile?.rate || 'Rate not specified'}</span>
                    </div>
                    <div class="item-description">
                        <strong>Primary Job:</strong> ${user.primaryJob || 'None'}<br>
                        <strong>Payment Method:</strong> ${user.paymentMethod || 'Not specified'}<br>
                        <strong>Contract Status:</strong> ${user.contract?.contractStatus || 'Not specified'}
                    </div>
                    <div class="item-actions" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-small" onclick="viewUserDetails('${name}')">üë§ View Details</button>
                        <button class="btn btn-small" onclick="editUser('${name}')">‚úèÔ∏è Edit User</button>
                        <button class="btn btn-small" onclick="downloadUserContract('${name}')">üìÑ Download Contract</button>
                        <button class="btn btn-small" onclick="showBankDetails('${name}')">üè¶ Bank Details</button>
                        <button class="btn btn-small" onclick="showPerformanceReview('${name}')">‚≠ê Performance</button>
                        <button class="btn btn-small btn-danger" onclick="deleteUser('${name}')">üóëÔ∏è Delete</button>
                    </div>
                `;
                usersList.appendChild(userDiv);
            });
        }



        // Add/Edit user
        document.getElementById('contractForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const userData = {
                profile: {
                    email: formData.get('email'),
                    role: formData.get('role'),
                    location: formData.get('location'),
                    rate: formData.get('rate'),
                    approvedDate: formData.get('approvedDate')
                },
                contract: {
                    contractUrl: formData.get('contractUrl'),
                    contractStatus: 'pending'
                }
            };

            const name = formData.get('name');
            const editName = e.target.dataset.editName;
            
            if (editName && editName !== name) {
                delete window.users[editName];
            }
            
            window.users[name] = userData;
            delete e.target.dataset.editName;

            displayUsers();
            updateStats();
            clearContractForm();
        });

        // Edit user
        function editUser(name) {
            const user = window.users[name];
            document.getElementById('freelancerName').value = name;
            document.getElementById('freelancerEmail').value = user.profile?.email || '';
            document.getElementById('contractUrl').value = user.contract?.contractUrl || '';
            document.getElementById('freelancerRole').value = user.profile?.role || '';
            document.getElementById('freelancerLocation').value = user.profile?.location || 'Atlanta Area';
            document.getElementById('freelancerRate').value = user.profile?.rate || '';
            document.getElementById('approvedDate').value = user.profile?.approvedDate || '';
            
            document.getElementById('contractForm').dataset.editName = name;
        }

        // Assign jobs to users
        function assignJobsToUsers() {
            if (!window.jobs || window.jobs.length === 0) {
                showNotification('No jobs available to assign', 'warning');
                return;
            }
            
            if (!window.users || Object.keys(window.users).length === 0) {
                showNotification('No users available to assign jobs to', 'warning');
                return;
            }
            
            // Create modal for job assignment
            const modal = document.createElement('div');
            modal.id = 'jobAssignmentModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            const jobsHTML = window.jobs.map((job, index) => `
                <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                    <h4 style="color: #FFB200; margin-bottom: 0.5rem;">${job.title}</h4>
                    <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 1rem;">
                        <div>üìÖ ${job.date || 'No date'}</div>
                        <div>üìç ${job.location || 'No location'}</div>
                        <div>üí∞ ${job.pay || 'No pay rate'}</div>
                    </div>
                    <select id="job-${index}-user" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,178,0,0.3); border-radius: 4px; color: white;">
                        <option value="">Select a user...</option>
                        ${Object.keys(window.users).map(userName => `
                            <option value="${userName}">${userName}</option>
                        `).join('')}
                    </select>
                </div>
            `).join('');
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
                    padding: 2rem;
                    border-radius: 16px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
                ">
                    <button onclick="this.closest('#jobAssignmentModal').remove()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">√ó</button>
                    
                    <h3 style="color: #FFB200; margin-bottom: 1.5rem; text-align: center; font-family: 'Cinzel', serif;">
                        üë• ASSIGN JOBS TO USERS
                    </h3>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">
                            Select users for each job below. Users will be assigned to jobs based on their roles and availability.
                        </p>
                        ${jobsHTML}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="processJobAssignments()" 
                                style="
                                    background: linear-gradient(135deg, #22c55e, #16a34a);
                                    color: white;
                                    border: none;
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            ‚úÖ Assign Jobs
                        </button>
                        <button onclick="this.closest('#jobAssignmentModal').remove()" 
                                style="
                                    background: linear-gradient(135deg, #6b7280, #4b5563);
                                    color: white;
                                    border: none;
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Assign jobs to user based on role and location
        async function assignJobsToUser(role, location) {
            try {
                // Load jobs data
                const jobsResponse = await fetch('jobs-data.json');
                const jobsData = await jobsResponse.json();
                
                const assignedJobs = {};
                let primaryJob = null;
                
                // Match jobs based on role and location
                jobsData.jobs.forEach(job => {
                    // Check if job matches user's role and location
                    if (job.title.toLowerCase().includes(role.toLowerCase()) || 
                        role.toLowerCase().includes(job.title.toLowerCase())) {
                        
                        // Create job ID
                        const jobId = `job-${job.title.toLowerCase().replace(/\s+/g, '-')}-${Date.now()}`;
                        
                        assignedJobs[jobId] = {
                            id: jobId,
                            title: job.title,
                            date: job.date,
                            location: job.location,
                            rate: job.rate,
                            description: job.description,
                            status: job.status,
                            projectStatus: job.status || 'upcoming',
                            paymentStatus: 'pending',
                            assignedDate: new Date().toISOString().split('T')[0],
                            projectStart: document.getElementById('projectStart')?.value || 'TBD'
                        };
                        
                        // Set as primary job if it's the first match
                        if (!primaryJob) {
                            primaryJob = jobId;
                        }
                    }
                });
                
                // If no specific job matches, create a default job based on role
                if (Object.keys(assignedJobs).length === 0) {
                    const defaultJobId = `job-${role.toLowerCase().replace(/\s+/g, '-')}-default`;
                    
                    assignedJobs[defaultJobId] = {
                        id: defaultJobId,
                        title: `${role} Position`,
                        date: new Date().toISOString().split('T')[0],
                        location: location,
                        rate: document.getElementById('freelancerRate')?.value || '$200',
                        description: `Professional ${role} position in ${location}. Details to be provided.`,
                        status: 'upcoming',
                        projectStatus: 'upcoming',
                        paymentStatus: 'pending',
                        assignedDate: new Date().toISOString().split('T')[0],
                        projectStart: document.getElementById('projectStart')?.value || 'TBD'
                    };
                    
                    primaryJob = defaultJobId;
                }
                
                console.log('‚úÖ Assigned jobs to user:', assignedJobs);
                console.log('‚úÖ Primary job:', primaryJob);
                
                return {
                    jobs: assignedJobs,
                    primaryJob: primaryJob
                };
                
            } catch (error) {
                console.error('‚ùå Error assigning jobs to user:', error);
                
                // Fallback: create a default job
                const defaultJobId = `job-${role.toLowerCase().replace(/\s+/g, '-')}-fallback`;
                const defaultJob = {
                    id: defaultJobId,
                    title: `${role} Position`,
                    date: new Date().toISOString().split('T')[0],
                    location: location,
                    rate: document.getElementById('freelancerRate')?.value || '$200',
                    description: `Professional ${role} position in ${location}. Details to be provided.`,
                    status: 'upcoming',
                    projectStatus: 'upcoming',
                    paymentStatus: 'pending',
                    assignedDate: new Date().toISOString().split('T')[0],
                    projectStart: document.getElementById('projectStart')?.value || 'TBD'
                };
                
                return {
                    jobs: { [defaultJobId]: defaultJob },
                    primaryJob: defaultJobId
                };
            }
        }

        // Process job assignments
        function processJobAssignments() {
            const assignments = [];
            let assignedCount = 0;
            
            window.jobs.forEach((job, index) => {
                const selectElement = document.getElementById(`job-${index}-user`);
                const selectedUser = selectElement.value;
                
                if (selectedUser) {
                    assignments.push({
                        job: job,
                        user: selectedUser
                    });
                    assignedCount++;
                }
            });
            
            if (assignedCount === 0) {
                showNotification('Please select at least one user for job assignment', 'warning');
                return;
            }
            
            // Process assignments
            assignments.forEach(assignment => {
                const userName = assignment.user;
                const job = assignment.job;
                
                if (!window.users[userName].jobs) {
                    window.users[userName].jobs = {};
                }
                
                const jobId = `job-${job.title.toLowerCase().replace(/\s+/g, '-')}-${Date.now()}`;
                window.users[userName].jobs[jobId] = {
                    id: jobId,
                    title: job.title,
                    date: job.date,
                    location: job.location,
                    rate: job.pay,
                    description: job.description,
                    status: job.status,
                    projectStatus: 'upcoming',
                    paymentStatus: 'pending',
                    assignedDate: new Date().toISOString().split('T')[0]
                };
                
                // Set as primary job if user doesn't have one
                if (!window.users[userName].primaryJob) {
                    window.users[userName].primaryJob = jobId;
                }
            });
            
            // Update display
            displayUsers();
            
            // Close modal
            document.getElementById('jobAssignmentModal').remove();
            
            showNotification(`Successfully assigned ${assignedCount} job(s) to users`, 'success');
        }

        // Delete user (for contract management)
        async function deleteUser(name) {
            if (confirm(`Are you sure you want to delete ${name}?`)) {
                try {
                    const userData = window.users[name];
                    const userEmail = userData?.profile?.email;
                    const contractId = userData?.contract?.contractId;
                    const contractFileName = userData?.contract?.fileName;
                    
                    let firebaseDeleted = false;
                    let firebaseMessage = '';
                    let pdfDeleted = false;
                    let pdfMessage = '';
                    
                    // 1. Delete associated PDF file if contract exists
                    if (contractFileName) {
                        try {
                            console.log(`üóëÔ∏è Attempting to delete PDF: ${contractFileName}`);
                            const deletePdfResponse = await fetch('/api/delete-pdf', {
                                method: 'DELETE',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    filename: contractFileName
                                })
                            });
                            
                            if (deletePdfResponse.ok) {
                                const pdfResult = await deletePdfResponse.json();
                                console.log('‚úÖ PDF file deleted successfully:', pdfResult);
                                pdfDeleted = true;
                                pdfMessage = 'PDF file deleted from server.';
                            } else {
                                console.warn('‚ö†Ô∏è PDF deletion request failed:', deletePdfResponse.status);
                                pdfMessage = 'PDF file may still exist on server.';
                            }
                        } catch (pdfError) {
                            console.warn('‚ö†Ô∏è Could not delete PDF file:', pdfError);
                            pdfMessage = 'PDF file may still exist.';
                        }
                    }
                    
                    // 2. Delete from Firebase (if email exists)
                    if (userEmail) {
                        try {
                            const firebaseResult = await deleteFirebaseAccount(userEmail);
                            if (firebaseResult.success) {
                                console.log('‚úÖ Firebase account deleted for:', userEmail);
                                firebaseDeleted = true;
                                firebaseMessage = 'Removed from Firebase and GitHub.';
                            } else {
                                console.warn('‚ö†Ô∏è Firebase account deletion limited:', firebaseResult.error);
                                firebaseMessage = firebaseResult.message || 'Firebase account may still exist.';
                            }
                        } catch (firebaseError) {
                            console.warn('‚ö†Ô∏è Could not delete Firebase account:', firebaseError);
                            firebaseMessage = 'Firebase account may still exist.';
                        }
                    }
                    
                    // 3. Delete from local users object
                    delete window.users[name];
                    
                    // 4. Update GitHub repository
                    await updateUsersOnGitHub('delete', name);
                    
                    // 5. Refresh display
                    displayUsers();
                    updateStats();
                    
                    // 6. Show comprehensive success message
                    let successMessage = `‚úÖ User "${name}" deleted successfully!`;
                    if (firebaseDeleted) successMessage += ` ${firebaseMessage}`;
                    if (pdfDeleted) successMessage += ` ${pdfMessage}`;
                    
                    showNotification(successMessage, 'success');
                    
                } catch (error) {
                    console.error('‚ùå Error deleting user:', error);
                    showNotification(`‚ùå Error deleting user: ${error.message}`, 'error');
                    displayUsers(); // Still update the display
                }
            }
        }

        // Clear contract form
        function clearContractForm() {
            document.getElementById('contractForm').reset();
            document.getElementById('freelancerLocation').value = 'Atlanta Area';
            delete document.getElementById('contractForm').dataset.editName;
        }



        // Export users data
        function exportUsersData() {
            const data = {
                users: window.users,
                lastUpdated: new Date().toISOString().split('T')[0],
                totalUsers: Object.keys(window.users).length
            };
            
            document.getElementById('downloadUsersBtn').style.display = 'block';
        }

        // Download users JSON
        function downloadUsersJSON() {
            const data = {
                users: window.users,
                lastUpdated: new Date().toISOString().split('T')[0],
                totalUsers: Object.keys(window.users).length
            };
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'users.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Update users.json on GitHub
        async function updateUsersOnGitHub(action = 'update', userName = '') {
            try {
                console.log('üîÑ Updating users.json on GitHub...');
                
                // Count performance reviews in users
                let totalReviews = 0;
                for (const user of Object.values(window.users)) {
                    if (user.performance) {
                        totalReviews++;
                    }
                }
                
                const usersData = {
                    users: window.users,
                    statusOptions: {
                        projectStatus: ["upcoming", "in-progress", "completed", "cancelled"],
                        paymentStatus: ["pending", "processing", "paid", "overdue"]
                    },
                    lastUpdated: new Date().toISOString().split('T')[0],
                    totalUsers: Object.keys(window.users).length,
                    system: {
                        totalReviews: totalReviews,
                        lastUpdated: new Date().toISOString().split('T')[0]
                    }
                };
                
                // First, get the current file SHA
                const getResponse = await fetch('/api/github/file/users.json');
                let sha = null;
                
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                    console.log('üìÑ Got current file SHA:', sha.substring(0, 7));
                } else if (getResponse.status === 404) {
                    console.log('üìÑ File does not exist, will create new file');
                } else {
                    console.warn('‚ö†Ô∏è Could not get current file SHA, proceeding without it');
                }
                
                const updateBody = {
                    content: JSON.stringify(usersData, null, 2),
                    message: `Update users.json - ${action} ${userName} - ${new Date().toLocaleString()}`
                };
                
                // Include SHA if we have it (for updates)
                if (sha) {
                    updateBody.sha = sha;
                }
                
                const response = await fetch('/api/github/file/users.json', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateBody)
                });
                
                if (response.ok) {
                    console.log('‚úÖ users.json updated on GitHub successfully');
                    showNotification('‚úÖ Users data updated successfully and pushed to GitHub', 'success');
                    return true;
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('‚ùå Failed to update users.json on GitHub:', response.status, errorData);
                    showNotification('‚ùå Failed to update users data', 'error');
                    return false;
                }
                
            } catch (error) {
                console.error('‚ùå Error updating users.json on GitHub:', error);
                showNotification('‚ùå Error updating users data', 'error');
                return false;
            }
        }

        // Delete Firebase account
        async function deleteFirebaseAccount(email) {
            try {
                console.log(`üóëÔ∏è Attempting to delete Firebase account: ${email}`);
                
                const response = await fetch('/api/firebase', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Firebase deletion response:', result);
                    return result;
                } else {
                    const error = await response.json();
                    console.error('‚ùå Firebase deletion failed:', error);
                    return { success: false, error: error.message };
                }
                
            } catch (error) {
                console.error('‚ùå Error calling Firebase API:', error);
                return { success: false, error: error.message };
            }
        }

        // ==================== PROFESSIONAL NOTIFICATION SYSTEM ====================
        
        // Enhanced notification system - SILENT VERSION (notifications disabled)
        function showNotification(message, type = 'info', duration = 5000) {
            // Silent notification - only log to console
            console.log(`üîá Suppressed notification: ${message} (${type})`);
            // No popup display - notifications are handled by sophisticated system
        }
        
        function getNotificationIcon(type) {
            return 'üîá'; // Silent icon
        }
        
        function getNotificationColors(type) {
            return { background: 'transparent', border: 'transparent' };
        }
        
        // Replace all console.log() calls with silent notifications
        function showAlert(message, type = 'info') {
            console.log(`üîá Suppressed alert: ${message} (${type})`);
        }

        // ==================== SOPHISTICATED NOTIFICATION SYSTEM ====================
        
        // Centralized notification system with real-time updates
        let notifications = [];
        let notificationUpdateInterval;
        
        // Initialize notification system
        async function initializeNotificationSystem() {
            console.log('üîî Initializing sophisticated notification system...');
            await loadNotifications();
            startNotificationPolling();
            updateNotificationBadge();
            updateNotificationList();
        }
        
        // Load notifications from centralized storage
        async function loadNotifications() {
            try {
                const response = await fetch('/api/notifications');
                if (response.ok) {
                    const data = await response.json();
                    notifications = data.notifications || [];
                    console.log('‚úÖ Loaded notifications from API:', notifications.length);
                } else {
                    // Fallback to localStorage
                    notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
                    console.log('‚ö†Ô∏è Using localStorage fallback for notifications');
                }
            } catch (error) {
                console.error('‚ùå Error loading notifications:', error);
                notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
            }
        }
        
        // Save notifications to centralized storage
        async function saveNotifications() {
            try {
                const response = await fetch('/api/notifications', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        notifications: notifications,
                        lastUpdated: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    console.log('‚úÖ Notifications saved to centralized storage');
                } else {
                    // Fallback to localStorage
                    localStorage.setItem('notifications', JSON.stringify(notifications));
                    console.log('‚ö†Ô∏è Using localStorage fallback for notifications');
                }
            } catch (error) {
                console.error('‚ùå Error saving notifications:', error);
                localStorage.setItem('notifications', JSON.stringify(notifications));
            }
        }
        
        // Add notification with rich data
        async function addNotification(title, message, type = 'info', data = {}) {
            const notification = {
                id: Math.floor(Date.now() + Math.random() * 1000),
                title: title,
                message: message,
                type: type,
                data: data,
                timestamp: new Date().toISOString(),
                read: false,
                actionRequired: data.actionRequired || false,
                priority: data.priority || 'normal'
            };
            
            notifications.unshift(notification);
            await saveNotifications();
            updateNotificationBadge();
            updateNotificationList();
        }
        
        // Update notification badge
        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'block' : 'none';
            }
        }
        
        // Update notification list
        function updateNotificationList() {
            const container = document.getElementById('notificationList');
            if (!container) return;
            
            container.innerHTML = '';
            notifications.slice(0, 10).forEach(notification => {
                const item = document.createElement('div');
                item.className = `notification-item ${notification.read ? 'read' : 'unread'}`;
                item.innerHTML = `
                    <div class="notification-header">
                        <strong>${notification.title}</strong>
                        <span class="notification-time">${new Date(notification.timestamp).toLocaleTimeString()}</span>
                    </div>
                    <div class="notification-message">${notification.message}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // Start notification polling
        function startNotificationPolling() {
            notificationUpdateInterval = setInterval(async () => {
                await loadNotifications();
                updateNotificationBadge();
                updateNotificationList();
            }, 30000); // Check every 30 seconds
        }
        
        // Stop notification polling
        function stopNotificationPolling() {
            if (notificationUpdateInterval) {
                clearInterval(notificationUpdateInterval);
            }
        }

        // ==================== DATA SOURCE ARCHITECTURE ====================
        
        /*
        DATA SOURCE CLARIFICATION:
        
        üìã dropdown-options.json (MASTER SOURCE)
        - Purpose: Centralized source for ALL dropdown options
        - Controls: roles, locations, rates, projectTypes
        - Managed by: Admin Dashboard Dropdown Management
        - Structure:
          {
            "roles": ["Photographer", "Videographer", "Editor", ...],
            "locations": ["Atlanta, GA", "Los Angeles, CA", "New York, NY", ...],
            "rates": ["$50/hour", "$100/hour", "$200/hour", ...],
            "projectTypes": ["Wedding", "Commercial", "Corporate Event", ...]
          }
        
        üë• users.json (USER DATA)
        - Purpose: Stores user profile data (references dropdown options)
        - References: dropdown-options.json for role, location, rate
        - Structure:
          {
            "users": {
              "userName": {
                "profile": {
                  "role": "Photographer", // from dropdown-options.json
                  "location": "Atlanta, GA", // from dropdown-options.json
                  "rate": "$100/hour" // from dropdown-options.json
                },
                "contract": { /* contract data */ },
                "jobs": { /* job assignments */ }
              }
            }
          }
        
        /*
        üìã jobs-data.json (JOB DATA)
        - Purpose: Stores job listings (references dropdown options)
        - References: dropdown-options.json for location, projectType
        - Structure:
          {
            "jobs": [
              {
                "title": "Backdrop Photographer Base",
                "location": "Douglasville, GA", // from dropdown-options.json
                "projectType": "Event Coverage", // from dropdown-options.json
                "pay": "$400" // from dropdown-options.json
              }
            ]
          }
        
        DATA FLOW:
        dropdown-options.json (Master) 
            ‚Üì (provides options)
        users.json (User Profiles) ‚Üê‚Üí jobs-data.json (Job Listings)
            ‚Üì (uses options)
        Admin Dashboard & User Portal
        
        BENEFITS:
        ‚úÖ Single source of truth for all dropdown options
        ‚úÖ Consistent data across user and job systems
        ‚úÖ Easy management from one interface
        ‚úÖ No data conflicts or inconsistencies
        ‚úÖ Scalable architecture for future additions
        
        ROLE vs PROJECT TYPE CLARIFICATION:
        
        üé≠ ROLES (User-Specific):
        - Definition: User's professional role/career
        - Examples: Photographer, Videographer, Editor, Producer, Director
        - Stored in: users.json under user.profile.role
        - Used in: User creation form, user profiles
        - Purpose: Defines what the user does professionally
        
        üé¨ PROJECT TYPES (Job-Specific):
        - Definition: Types of projects/jobs available
        - Examples: Wedding Photography, Corporate Event, Commercial Video, Product Photography
        - Stored in: jobs-data.json under job.projectType
        - Used in: Job creation form, job listings
        - Purpose: Defines what type of project the job is
        
        KEY DIFFERENCES:
        ‚úÖ Roles are user-specific (what they do professionally)
        ‚úÖ Project Types are job-specific (what type of project it is)
        ‚úÖ User creation form only needs Role field (not Project Type)
        ‚úÖ Job creation form needs Project Type field (not Role)
        ‚úÖ Clear separation prevents confusion between career and project type
        */
        
        // ==================== CORE FUNCTION RESTORATION ====================
        
        // Firebase Management Functions
        function showFirebaseManagement() {
            const container = document.getElementById('firebase-tab');
            if (!container) {
                console.error('‚ùå Firebase tab container not found');
                showNotification('Error: Firebase tab not found', 'error');
                return;
            }
            
            container.innerHTML = `
                <div class="form-section">
                    <h2><i class="fas fa-fire"></i> Firebase Authentication Management</h2>
                    <div class="firebase-management">
                        <div class="info-card">
                            <h3><i class="fas fa-info-circle"></i> Current Authentication Setup</h3>
                            <p><strong>Admin Dashboard:</strong> Uses Firebase Authentication with role-based access</p>
                            <p><strong>User Portal:</strong> Now uses Firebase Authentication (updated)</p>
                            <p><strong>Security:</strong> Only admin emails can access admin dashboard</p>
                        </div>
                        
                        <div class="action-card">
                            <h3><i class="fas fa-users"></i> Create Firebase Accounts</h3>
                            <p>Create Firebase authentication accounts for all existing users in the system.</p>
                            <button onclick="createFirebaseAccountsForExistingUsers()" class="action-btn">
                                <i class="fas fa-plus"></i> Create Firebase Accounts
                            </button>
                        </div>
                        
                        <div class="info-card">
                            <h3><i class="fas fa-shield-alt"></i> Security Notes</h3>
                            <ul>
                                <li>Admin emails: ${ADMIN_EMAILS.join(', ')}</li>
                                <li>Users can only access their own portal</li>
                                <li>Admins can access both admin dashboard and user portal</li>
                                <li>Firebase handles password security and authentication</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // Update existing users with missing job data
        async function updateExistingUsersWithJobData() {
            try {
                console.log('üîÑ Updating existing users with missing job data...');
                
                let updatedCount = 0;
                
                for (const [userName, userData] of Object.entries(window.users || {})) {
                    // Check if user has empty jobs object or null primaryJob
                    if (!userData.jobs || Object.keys(userData.jobs).length === 0 || !userData.primaryJob) {
                        console.log(`üîÑ Updating job data for user: ${userName}`);
                        
                        const role = userData.profile?.role || 'Producer';
                        const location = userData.profile?.location || 'Atlanta, GA';
                        
                        // Assign job data
                        const assignedJobs = await assignJobsToUser(role, location);
                        
                        // Update user data
                        window.users[userName].jobs = assignedJobs.jobs;
                        window.users[userName].primaryJob = assignedJobs.primaryJob;
                        
                        updatedCount++;
                        console.log(`‚úÖ Updated job data for ${userName}`);
                    }
                }
                
                if (updatedCount > 0) {
                    // Update localStorage
                    localStorage.setItem('users', JSON.stringify(window.users));
                    
                    // Update GitHub repository
                    await updateUsersOnGitHub();
                    
                    showNotification(`‚úÖ Updated job data for ${updatedCount} existing users`, 'success');
                } else {
                    console.log('‚úÖ All users already have job data');
                }
                
            } catch (error) {
                console.error('‚ùå Error updating existing users with job data:', error);
                showNotification('‚ùå Error updating existing users with job data', 'error');
            }
        }

        // Manual refresh function
        async function refreshFreelancers() {
            try {
                console.log('üîÑ Refreshing freelancers data...');
                
                // Reload users data
                await loadUsers();
                
                // Reload jobs data
                await loadJobs();
                
                // Update display
                displayUsers();
                displayJobs();
                updateStats();
                
                showNotification('‚úÖ Data refreshed successfully', 'success');
                
            } catch (error) {
                console.error('‚ùå Error refreshing data:', error);
                showNotification('‚ùå Error refreshing data', 'error');
            }
        }
        
        // Check if performance review should be shown for a user
        function shouldShowPerformanceReview(userData) {
            // Check if user has completed projects with paid status
            if (userData.jobs && Object.keys(userData.jobs).length > 0) {
                const completedJobs = Object.values(userData.jobs).filter(job => 
                    job.projectStatus === 'completed' && job.paymentStatus === 'paid'
                );
                
                // Show if there are completed paid jobs and no performance review exists
                if (completedJobs.length > 0) {
                    const existingReview = performanceReviews[userData.profile?.email];
                    return !existingReview || existingReview.status === 'pending';
                }
            }
            return false;
        }
        
        // Check for performance review alerts
        function checkPerformanceReviewAlerts() {
            const pendingReviews = Object.values(window.users || {}).filter(userData => shouldShowPerformanceReview(userData));
            
            if (pendingReviews.length > 0) {
                const alertContainer = document.createElement('div');
                alertContainer.id = 'performanceReviewAlert';
                alertContainer.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #f59e0b, #d97706);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 12px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 1000;
                    max-width: 300px;
                    border: 1px solid rgba(255,255,255,0.2);
                `;
                
                alertContainer.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                        <h4 style="margin: 0; color: white;"><i class="fas fa-star"></i> Performance Reviews Due</h4>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">√ó</button>
                    </div>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">
                        ${pendingReviews.length} user${pendingReviews.length > 1 ? 's' : ''} need${pendingReviews.length > 1 ? '' : 's'} performance review.
                    </p>
                    <div style="margin-top: 0.5rem;">
                        <button onclick="showPerformanceReviewList()" 
                                style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">
                            View All
                        </button>
                    </div>
                `;
                
                document.body.appendChild(alertContainer);
                
                // Auto-remove after 10 seconds
                setTimeout(() => {
                    const alert = document.getElementById('performanceReviewAlert');
                    if (alert) alert.remove();
                }, 10000);
            }
        }

        // Show performance review list
        function showPerformanceReviewList() {
            const pendingReviews = Object.values(window.users || {}).filter(userData => shouldShowPerformanceReview(userData));
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-star"></i> Performance Reviews Due</h2>
                        <button onclick="closeModal(this)" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">
                            The following users have completed paid projects and need performance reviews:
                        </p>
                        ${pendingReviews.map(userData => `
                            <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="color: #FFB200; margin: 0 0 0.5rem 0;">${Object.keys(window.users || {}).find(key => window.users[key] === userData)}</h4>
                                        <p style="color: rgba(255,255,255,0.8); margin: 0; font-size: 0.9rem;">${userData.profile?.email || 'No email'}</p>
                                    </div>
                                    <button onclick="showPerformanceReviewModal('${Object.keys(window.users || {}).find(key => window.users[key] === userData)}'); closeModal(this);" 
                                            style="background: #FFB200; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                        Review Now
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,178,0,0.2);">
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> Performance reviews help improve collaboration and future opportunities.
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Get performance review status badge
        function getPerformanceReviewStatus(userData) {
            // Try multiple ways to get the email
            const userEmail = userData.profile?.email || userData.email || userData.profile?.userEmail;
            const userName = userData.profile?.name || userData.name || 'Unknown User';
            console.log('üîç Checking performance review for user:', userName, 'Email:', userEmail);
            console.log('üîç Available performance reviews:', Object.keys(performanceReviews));
            
            const existingReview = performanceReviews[userEmail];
            
            if (existingReview) {
                return `<span style="background: #22c55e; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">COMPLETED</span>`;
            } else {
                return `<span style="background: #f59e0b; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">PENDING</span>`;
            }
        }
        
        // Generate temporary password for Firebase account
        function generateTempPassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let password = '';
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }
        
        // Send job acceptance email
        async function sendJobAcceptanceEmail(userName, userData) {
            try {
                // Prepare email parameters (no contract ID until user actually signs)
                const emailParams = {
                    to_email: userData.profile.email,
                    freelancer_name: userName || 'User',
                    role: userData.profile.role || 'Contractor',
                    location: userData.profile.location || 'Atlanta Area',
                    rate: userData.profile.rate || 'Rate to be determined',
                    project_start: userData.profile.projectStart || 'TBD',
                    contract_id: 'Will be generated when you sign the contract'
                };

                console.log('üìß Sending job acceptance email to:', userData.profile.email);

                // Send email using EmailJS
                if (typeof emailjs !== 'undefined') {
                    try {
                        const response = await emailjs.send(
                            EMAILJS_CONFIG.serviceId, 
                            EMAILJS_CONFIG.jobAcceptanceTemplateId, 
                            emailParams
                        );
                        
                        console.log('‚úÖ Job acceptance email sent successfully:', response);
                        
                        // Show success message
                        setTimeout(() => {
                            showNotification(`üéâ User approved and email sent!\n\nüìß Email sent to: ${userData.profile.email}\n\n‚úÖ The user will receive the job acceptance email with contract signing instructions.`, 'success');
                        }, 1000);
                        
                    } catch (emailError) {
                        console.error('‚ùå EmailJS error:', emailError);
                        showNotification(`‚úÖ User saved successfully!\n\n‚ö†Ô∏è Email failed to send: ${emailError.message}\n\nPlease check EmailJS template configuration.`, 'warning');
                    }
                    
                } else {
                    console.warn('‚ö†Ô∏è EmailJS not available, skipping email send');
                    showNotification('‚úÖ User saved successfully!\n\n‚ö†Ô∏è EmailJS not configured - please set up EmailJS to send automatic job acceptance emails.', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Error sending job acceptance email:', error);
                showNotification('‚úÖ User saved successfully!\n\n‚ö†Ô∏è Email sending failed. Please check EmailJS configuration.', 'warning');
            }
        }

        // Validate user data
        function validateUserData(userName, userData) {
            if (!userName.trim() || !userData.profile.email.trim() || !userData.profile.role.trim()) {
                showNotification('Name, email, and role are required', 'error');
                return false;
            }
            return true;
        }

        // Approve existing user (for users already in the system)
        async function approveUser(userName) {
            const userData = window.users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }
            
            if (confirm(`Are you sure you want to approve ${userName}?\n\nThis will send them a job acceptance email with contract signing instructions.`)) {
                // Update approval date if not set
                if (!userData.profile.approvedDate) {
                    userData.profile.approvedDate = new Date().toISOString().split('T')[0];
                }
                
                // Send job acceptance email
                sendJobAcceptanceEmail(userName, userData);
                
                // Save updated user data
                localStorage.setItem('users', JSON.stringify(window.users));
                await updateUsersOnGitHub();
                displayUsers();
                
                showNotification(`‚úÖ ${userName} approved successfully!`, 'success');
            }
        }
        
        // Populate user dropdowns
        function populateUserDropdowns() {
            // Populate contract upload user dropdown
            const uploadUserSelect = document.getElementById('uploadFreelancerName');
            if (uploadUserSelect) {
                uploadUserSelect.innerHTML = '<option value="">Select a user...</option>';
                Object.keys(window.users || {}).forEach(userName => {
                    const option = document.createElement('option');
                    option.value = userName;
                    option.textContent = userName;
                    uploadUserSelect.appendChild(option);
                });
            }
            
            // Populate job assignment user dropdown
            const jobAssignmentSelect = document.getElementById('jobAssignmentFreelancer');
            if (jobAssignmentSelect) {
                jobAssignmentSelect.innerHTML = '<option value="">Choose a user...</option>';
                Object.keys(window.users || {}).forEach(userName => {
                    const option = document.createElement('option');
                    option.value = userName;
                    option.textContent = userName;
                    jobAssignmentSelect.appendChild(option);
                });
            }
            
            console.log('üë• Populated user dropdowns with', Object.keys(window.users || {}).length, 'options');
        }

        // Load dropdown options from API or use defaults
        async function loadDropdownOptions() {
            try {
                console.log('üîÑ Loading dropdown options...');
                
                // Add timeout to prevent hanging
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
                
                const response = await fetch('/api/dropdown-options', {
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (response.ok) {
                    window.dropdownOptions = await response.json();
                    console.log('üìã Loaded dropdown options from API:', window.dropdownOptions);
                } else {
                    console.warn(`‚ö†Ô∏è API returned status ${response.status}, using defaults`);
                    // Initialize with default options if API fails
                    window.dropdownOptions = {
                        roles: ['Backdrop Photographer', 'Editor', 'Videographer', 'Photographer', 'Full Stack Designer', 'Video Editor', 'Corporate Videographer'],
                        locations: ['6695 Church Street, Douglasville, GA 30134', 'Sandy Springs, GA', 'Douglasville, GA', 'Atlanta, GA', 'Atlanta Area'],
                        rates: ['$400.00 USD (Flat)', '$450.00 USD (Flat)', '$500.00 USD (Flat)', '$750.00 USD (Flat)', '$900.00 USD (Flat)', '$150/day', '$200/day'],
                        projectTypes: ['Photography', 'Video', 'Editor Project', 'Corporate Video', 'Event Coverage', 'Product Photography', 'Real Estate', 'Wedding', 'Commercial'],
                        paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                        projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                        paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                    };
                    console.log('üìã Initialized default dropdown options (API failed):', window.dropdownOptions);
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.warn('‚ö†Ô∏è Dropdown options request timed out, using defaults');
                } else {
                    console.error('‚ùå Error loading dropdown options from API:', error);
                }
                
                // Initialize with default options
                window.dropdownOptions = {
                    roles: ['Backdrop Photographer', 'Editor', 'Videographer', 'Douglasville, GA', 'Atlanta, GA', 'Atlanta Area'],
                    locations: ['6695 Church Street, Douglasville, GA 30134', 'Sandy Springs, GA', 'Douglasville, GA', 'Atlanta, GA', 'Atlanta Area'],
                    rates: ['$400.00 USD (Flat)', '$450.00 USD (Flat)', '$500.00 USD (Flat)', '$750.00 USD (Flat)', '$900.00 USD (Flat)', '$150/day', '$200/day'],
                    projectTypes: ['Photography', 'Video', 'Editor Project', 'Corporate Video', 'Event Coverage', 'Product Photography', 'Real Estate', 'Wedding', 'Commercial'],
                    paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                    projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                    paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                };
                console.log('üìã Initialized default dropdown options (error):', window.dropdownOptions);
            }
            
            // Populate the management interface
            populateDropdownManagementInterface();
            
            // Populate user creation dropdowns
            populateUserCreationDropdowns();
            
            // Populate job assignment dropdowns
            populateJobAssignmentDropdowns();
        }
        
        // Populate dropdown management interface
        function populateDropdownManagementInterface() {
            if (!window.dropdownOptions) return;
            
            // Populate roles list
            const rolesList = document.getElementById('rolesList');
            if (rolesList) {
                rolesList.innerHTML = window.dropdownOptions.roles.map(role => `
                    <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">
                        <span style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">${role}</span>
                        <button onclick="removeDropdownOption('roles', '${role}')" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
            
            // Populate locations list
            const locationsList = document.getElementById('locationsList');
            if (locationsList) {
                locationsList.innerHTML = window.dropdownOptions.locations.map(location => `
                    <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">
                        <span style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">${location}</span>
                        <button onclick="removeDropdownOption('locations', '${location}')" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
            
            // Populate rates list
            const ratesList = document.getElementById('ratesList');
            if (ratesList) {
                ratesList.innerHTML = window.dropdownOptions.rates.map(rate => `
                    <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">
                        <span style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">${rate}</span>
                        <button onclick="removeDropdownOption('rates', '${rate}')" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
            
            // Populate project types list
            const projectTypesList = document.getElementById('projectTypesList');
            if (projectTypesList) {
                projectTypesList.innerHTML = window.dropdownOptions.projectTypes.map(type => `
                    <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">
                        <span style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">${type}</span>
                        <button onclick="removeDropdownOption('projectTypes', '${type}')" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }
            
            console.log('üìã Populated dropdown management interface');
        }
            if (ratesSelect) {
                ratesSelect.innerHTML = '<option value="">Select Rate...</option>';
                window.dropdownOptions.rates.forEach(rate => {
                    const option = document.createElement('option');
                    option.value = rate;
                    option.textContent = rate;
                    ratesSelect.appendChild(option);
                });
            }
            
            console.log('üìã Populated dropdown management interface');
        }
        
        // Add dropdown option
        function addDropdownOption(category, inputId) {
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            
            if (!value) {
                showNotification('Please enter a value to add.', 'error');
                return;
            }
            
            if (!window.dropdownOptions[category]) {
                window.dropdownOptions[category] = [];
            }
            
            if (window.dropdownOptions[category].includes(value)) {
                showNotification('This option already exists.', 'warning');
                return;
            }
            
            window.dropdownOptions[category].push(value);
            input.value = '';
            
            // Update the management interface
            populateDropdownManagementInterface();
            
            // Update job assignment dropdowns
            populateJobAssignmentDropdowns();
            
            console.log(`‚úÖ Added ${value} to ${category}`);
        }
        
        // Remove dropdown option
        function removeDropdownOption(category, value) {
            if (window.dropdownOptions[category]) {
                window.dropdownOptions[category] = window.dropdownOptions[category].filter(item => item !== value);
                populateDropdownManagementInterface();
                populateJobAssignmentDropdowns();
                console.log(`‚úÖ Removed ${value} from ${category}`);
            }
        }
        
        // Save dropdown options to GitHub API
        async function saveDropdownOptions() {
            if (!window.dropdownOptions) {
                showNotification('‚ùå No dropdown options to save.', 'error');
                return;
            }
            
            try {
                console.log('üîÑ Saving dropdown options to GitHub via server...');
                
                // Get current SHA for the file
                const shaResponse = await fetch('/api/github/info');
                if (!shaResponse.ok) {
                    throw new Error('Failed to get GitHub info');
                }
                
                const shaData = await shaResponse.json();
                const currentSha = shaData.sha;
                
                console.log('üîç Retrieved current SHA:', currentSha);
                
                // Update the file on GitHub
                const updateResponse = await fetch('/api/github/file/dropdown-options.json', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update dropdown options via admin dashboard',
                        content: btoa(JSON.stringify(window.dropdownOptions, null, 2)),
                        sha: currentSha
                    })
                });
                
                if (updateResponse.ok) {
                    console.log('‚úÖ Successfully saved dropdown options to GitHub');
                    console.log('‚úÖ Dropdown options saved successfully to GitHub!');
                    showNotification('‚úÖ Dropdown options saved successfully to GitHub!', 'success');
                } else {
                    const errorData = await updateResponse.json();
                    throw new Error(`GitHub API error: ${errorData.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('‚ùå Error saving dropdown options:', error);
                showNotification(`‚ùå Failed to save dropdown options: ${error.message}`, 'error');
            }
        }

        // Populate user creation dropdowns
        function populateUserCreationDropdowns() {
            if (!window.dropdownOptions) return;
            
            // Populate role dropdown
            const roleSelect = document.getElementById('freelancerRole');
            if (roleSelect) {
                roleSelect.innerHTML = '<option value="">Select Role...</option>';
                window.dropdownOptions.roles.forEach(role => {
                    const option = document.createElement('option');
                    option.value = role;
                    option.textContent = role;
                    roleSelect.appendChild(option);
                });
            }
            
            // Populate location dropdown
            const locationSelect = document.getElementById('freelancerLocation');
            if (locationSelect) {
                locationSelect.innerHTML = '<option value="">Select Location...</option>';
                window.dropdownOptions.locations.forEach(location => {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    locationSelect.appendChild(option);
                });
            }
            
            // Populate rate dropdown
            const rateSelect = document.getElementById('freelancerRate');
            if (rateSelect) {
                rateSelect.innerHTML = '<option value="">Select Rate...</option>';
                window.dropdownOptions.rates.forEach(rate => {
                    const option = document.createElement('option');
                    option.value = rate;
                    option.textContent = rate;
                    rateSelect.appendChild(option);
                });
            }
            
            console.log('üìã Populated user creation dropdowns');
        }

        // Populate job assignment dropdowns
        function populateJobAssignmentDropdowns() {
            if (!window.dropdownOptions) return;
            
            // Populate project types dropdown
            const projectTypesSelect = document.getElementById('projectTypeSelect');
            if (projectTypesSelect) {
                projectTypesSelect.innerHTML = '<option value="">Select Project Type...</option>';
                window.dropdownOptions.projectTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    projectTypesSelect.appendChild(option);
                });
            }
            
            // Populate payment methods dropdown
            const paymentMethodsSelect = document.getElementById('paymentMethodSelect');
            if (paymentMethodsSelect) {
                paymentMethodsSelect.innerHTML = '<option value="">Select Payment Method...</option>';
                window.dropdownOptions.paymentMethods.forEach(method => {
                    const option = document.createElement('option');
                    option.value = method;
                    option.textContent = method;
                    paymentMethodsSelect.appendChild(option);
                });
            }
            
            console.log('üìã Populated job assignment dropdowns');
        }

        // Enhanced notification system
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            const icon = getNotificationIcon(type);
            const colors = getNotificationColors(type);
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors.background};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                border: 1px solid ${colors.border};
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                font-family: 'Inter', sans-serif;
                font-size: 0.9rem;
                max-width: 400px;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                backdrop-filter: blur(10px);
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <span style="font-size: 1.2rem;">${icon}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">${type.toUpperCase()}</div>
                        <div style="opacity: 0.9; line-height: 1.4;">${message}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Auto remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }
        
        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return '‚úÖ';
                case 'error': return '‚ùå';
                case 'warning': return '‚ö†Ô∏è';
                case 'info': return '‚ÑπÔ∏è';
                default: return 'üîî';
            }
        }
        
        function getNotificationColors(type) {
            switch (type) {
                case 'success': return { background: 'linear-gradient(135deg, #22c55e, #16a34a)', border: '#16a34a' };
                case 'error': return { background: 'linear-gradient(135deg, #ef4444, #dc2626)', border: '#dc2626' };
                case 'warning': return { background: 'linear-gradient(135deg, #f59e0b, #d97706)', border: '#d97706' };
                case 'info': return { background: 'linear-gradient(135deg, #3b82f6, #2563eb)', border: '#2563eb' };
                default: return { background: 'linear-gradient(135deg, #6b7280, #4b5563)', border: '#4b5563' };
            }
        }

        // View user details with sophisticated modal
        function viewUserDetails(userName) {
            const user = window.users[userName];
            if (!user) return;
            
            // Create sophisticated modal
            const modal = document.createElement('div');
            modal.id = 'userDetailsModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
                    padding: 2rem;
                    border-radius: 16px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
                ">
                    <button onclick="this.closest('#userDetailsModal').remove()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">√ó</button>
                    
                    <h3 style="color: #FFB200; margin-bottom: 1.5rem; text-align: center; font-family: 'Cinzel', serif;">
                        üë§ USER DETAILS - ${userName.toUpperCase()}
                    </h3>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            üìã Profile Information
                        </h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Email:</strong> 
                                <span style="color: #FFB200;">${user.profile?.email || 'Not specified'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Role:</strong> 
                                <span style="color: #FFB200;">${user.profile?.role || 'Not specified'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Location:</strong> 
                                <span style="color: #FFB200;">${user.profile?.location || 'Not specified'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Approved Date:</strong> 
                                <span style="color: #FFB200;">${user.profile?.approvedDate || 'Not specified'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            üìù Contract Information
                        </h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Contract Status:</strong> 
                                <span style="color: ${user.contract?.contractStatus === 'signed' ? '#22c55e' : '#f59e0b'};">
                                    ${user.contract?.contractStatus || 'Not specified'}
                                </span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Contract ID:</strong> 
                                <span style="color: #FFB200; font-family: monospace;">${user.contract?.contractId || 'Not specified'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Signed Date:</strong> 
                                <span style="color: #FFB200;">${user.contract?.contractSignedDate || 'Not specified'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            üíº Job Information
                        </h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Primary Job:</strong> 
                                <span style="color: #FFB200;">${user.primaryJob || 'None'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Payment Method:</strong> 
                                <span style="color: #FFB200;">${user.paymentMethod || 'Not specified'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button onclick="showBankDetails('${userName}')" 
                                style="
                                    background: linear-gradient(135deg, #3b82f6, #2563eb);
                                    color: white;
                                    border: none;
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    flex: 1;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            üè¶ View Bank Details
                        </button>
                        <button onclick="showPerformanceReview('${userName}')" 
                                style="
                                    background: linear-gradient(135deg, #f59e0b, #d97706);
                                    color: white;
                                    border: none;
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    flex: 1;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            üìä Performance Review
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Delete user (FIXED - Now persists to server)
        async function deleteUser(userName) {
            if (confirm(`Are you sure you want to delete ${userName}?`)) {
                try {
                    // Show loading state
                    showNotification('Deleting user...', 'info');
                    
                    // Get current users from server
                    const response = await fetch('users.json');
                    if (!response.ok) {
                        throw new Error('Failed to load current users');
                    }
                    
                    const data = await response.json();
                    const currentUsers = data.users || {};
                    
                    // Check if user exists
                    if (!currentUsers[userName]) {
                        throw new Error(`User ${userName} not found`);
                    }
                    
                    // Delete the user
                    delete currentUsers[userName];
                    console.log(`üóëÔ∏è Deleted ${userName} from users object`);
                    
                                // Update GitHub repository
            await updateUsersOnGitHub('delete', userName);
            
            // Update local state
            window.users = currentUsers;
            displayUsers();
            updateStats();
            
            showNotification(`User ${userName} deleted successfully and persisted to GitHub`, 'success');
            return true;
                } catch (error) {
                    console.error('‚ùå Error deleting user:', error);
                    showNotification(`Failed to delete user: ${error.message}`, 'error');
                    return false;
                }
            }
            return false;
        }

        // Show bank details with encryption
        function showBankDetails(userName) {
            const user = window.users[userName];
            if (!user) {
                showNotification('User not found', 'error');
                return;
            }

            // Use the proper admin bank viewer system
            if (window.adminBankViewer) {
                window.adminBankViewer.showUserBankDetails(userName, user);
            } else {
                // Fallback to simple modal if admin bank viewer is not available
                showSimpleBankModal(userName, user);
            }
        }

        // Fallback simple bank modal
        function showSimpleBankModal(userName, user) {
            const modal = document.createElement('div');
            modal.id = 'bankDetailsModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            // Check if user has bank data
            const hasBankData = user.bankData && Object.keys(user.bankData).length > 0;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
                    padding: 2rem;
                    border-radius: 16px;
                    max-width: 500px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
                ">
                    <button onclick="this.closest('#bankDetailsModal').remove()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">√ó</button>
                    
                    <h3 style="color: #FFB200; margin-bottom: 1.5rem; text-align: center; font-family: 'Cinzel', serif;">
                        üè¶ BANK DETAILS - ${userName.toUpperCase()}
                    </h3>
                    
                    ${hasBankData ? `
                        <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                üîê Secure Banking Information
                            </h4>
                            <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; line-height: 1.8;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <strong>Bank Name:</strong> 
                                    <span style="color: #FFB200;">${user.bankData.bankName || 'Not specified'}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <strong>Account Type:</strong> 
                                    <span style="color: #FFB200;">${user.bankData.accountType || 'Not specified'}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <strong>Last 4 Digits:</strong> 
                                    <span style="color: #FFB200;">****${user.bankData.lastFour || '****'}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <strong>Encryption Status:</strong> 
                                    <span style="color: #22c55e;">üîí End-to-End Encrypted</span>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <div style="background: rgba(59,130,246,0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid rgba(59,130,246,0.3);">
                            <h4 style="color: #3b82f6; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                ‚ÑπÔ∏è No Bank Data Available
                            </h4>
                            <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; line-height: 1.6;">
                                <strong>${userName}</strong> has not set up bank transfer details yet.
                                <br><br>
                                Bank details will appear here once the user selects "Bank Transfer" as their payment method and completes the secure setup process.
                            </div>
                        </div>
                    `}
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            üí≥ Payment Method
                        </h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Current Method:</strong> 
                                <span style="color: #FFB200;">${user.paymentMethod || 'Not specified'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Security Level:</strong> 
                                <span style="color: #22c55e;">Maximum</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button onclick="this.closest('#bankDetailsModal').remove()" 
                                style="
                                    background: linear-gradient(135deg, #6b7280, #4b5563);
                                    color: white;
                                    border: none;
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    flex: 1;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show performance review
        function showPerformanceReview(userName) {
            const user = window.users[userName];
            if (!user) {
                showNotification('User not found', 'error');
                return;
            }

            // Create sophisticated performance review modal
            const modal = document.createElement('div');
            modal.id = 'performanceReviewModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
                    padding: 2rem;
                    border-radius: 16px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
                ">
                    <button onclick="this.closest('#performanceReviewModal').remove()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">√ó</button>
                    
                    <h3 style="color: #FFB200; margin-bottom: 1.5rem; text-align: center; font-family: 'Cinzel', serif;">
                        üìä PERFORMANCE REVIEW - ${userName.toUpperCase()}
                    </h3>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            üìã Review Status
                        </h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.95rem; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Review Status:</strong> 
                                <span style="color: #f59e0b;">Pending</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Last Review:</strong> 
                                <span style="color: #FFB200;">Not yet reviewed</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Performance Level:</strong> 
                                <span style="color: #22c55e;">New</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(59,130,246,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(59,130,246,0.3);">
                        <h4 style="color: #3b82f6; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            üìù Review Notes
                        </h4>
                        <textarea placeholder="Enter performance review notes here..." 
                                  style="
                                      width: 100%;
                                      min-height: 100px;
                                      background: rgba(0,0,0,0.4);
                                      border: 1px solid rgba(255,178,0,0.3);
                                      border-radius: 8px;
                                      color: white;
                                      padding: 0.75rem;
                                      font-family: 'Inter', sans-serif;
                                      resize: vertical;
                                  "></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button onclick="submitPerformanceReview('${userName}')" 
                                style="
                                    background: linear-gradient(135deg, #22c55e, #16a34a);
                                    color: white;
                                    border: none;
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    flex: 1;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            ‚úÖ Submit Review
                        </button>
                        <button onclick="this.closest('#performanceReviewModal').remove()" 
                                style="
                                    background: linear-gradient(135deg, #6b7280, #4b5563);
                                    color: white;
                                    border: none;
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    flex: 1;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Submit performance review
        function submitPerformanceReview(userName) {
            const modal = document.getElementById('performanceReviewModal');
            const textarea = modal.querySelector('textarea');
            const notes = textarea.value.trim();
            
            if (!notes) {
                showNotification('Please enter review notes', 'warning');
                return;
            }
            
            // Here you would typically save the review to your backend
            showNotification(`Performance review submitted for ${userName}`, 'success');
            modal.remove();
        }

        // Download user contract - Generate PDF on-the-fly
        async function downloadUserContract(userName) {
            console.log('üîç downloadUserContract function called with:', userName);
            
            // Force refresh users data from centralized source
            try {
                console.log('üîÑ Refreshing users data from centralized source...');
                const response = await fetch('users.json');
                if (response.ok) {
                    const freshData = await response.json();
                    window.users = freshData.users;
                    console.log('‚úÖ Users data refreshed from centralized source');
                } else {
                    console.warn('‚ö†Ô∏è Could not refresh users data');
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Error refreshing users data:', error);
            }
            
            const userData = window.users[userName];
            if (!userData) {
                console.log('‚ùå User not found:', userName);
                showNotification('User not found', 'error');
                return;
            }

            console.log('üìÑ Attempting to generate contract for:', userName);
            console.log('üìÑ User data:', userData);
            
            // Check if user has contract data in centralized system
            if (!userData.contract) {
                console.log('‚ùå No contract data found for user:', userName);
                showNotification('No contract data found for user', 'error');
                return;
            }
            
            const userContract = userData.contract;
            console.log('üìÑ Contract data from centralized system:', userContract);
            
            // Check if contract is signed
            if (userContract.contractStatus !== 'signed') {
                console.log('‚ùå Contract not signed yet for user:', userName);
                showNotification('Contract not signed yet for user', 'error');
                return;
            }
            
            // Create contract data for PDF generation
            const contractData = {
                contractId: userContract.contractId || userName,
                freelancerName: userName,
                freelancerEmail: userData.profile?.email || 'Not specified',
                role: userData.profile?.role || 'Contractor',
                location: userData.profile?.location || 'Atlanta Area',
                projectStart: userData.profile?.projectStart || 'TBD',
                rate: userData.profile?.rate || 'Not specified',
                effectiveDate: userData.profile?.approvedDate || new Date().toISOString().split('T')[0],
                signatureDate: userContract.contractSignedDate || new Date().toISOString().split('T')[0],
                signature: userContract.contractStatus === 'signed' ? 'Digital Signature' : 'Not Signed'
            };
            
            try {
                console.log('üìÑ Generating PDF with contract data:', contractData);
                
                // Generate PDF using jsPDF
                const { jsPDF } = window.jspdf;
                if (!jsPDF) {
                    throw new Error('jsPDF library not loaded');
                }
                
                const doc = new jsPDF();
                
                // Professional header with gold background
                doc.setFillColor(255, 178, 0);
                doc.rect(0, 0, 210, 25, 'F');
                
                // Company name and title in header
                doc.setFontSize(20);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('COCHRAN FILMS', 105, 12, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'normal');
                doc.text('FREELANCE CONTRACT AGREEMENT', 105, 20, { align: 'center' });
                
                // Contract metadata
                doc.setFontSize(9);
                doc.setTextColor(100, 100, 100);
                doc.setFont('helvetica', 'normal');
                doc.text(`Contract ID: ${contractData.contractId}`, 20, 35);
                doc.text(`Effective Date: ${contractData.effectiveDate}`, 20, 40);
                
                // Contractor information
                doc.setFillColor(255, 178, 0);
                doc.rect(20, 50, 170, 8, 'F');
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('CONTRACTOR INFORMATION', 105, 56, { align: 'center' });
                
                // Contractor details
                doc.setFillColor(248, 249, 250);
                doc.rect(20, 65, 80, 25, 'F');
                doc.setDrawColor(255, 178, 0);
                doc.setLineWidth(0.5);
                doc.rect(20, 65, 80, 25, 'S');
                
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('CONTRACTOR INFO', 25, 72);
                
                doc.setFontSize(7);
                doc.setFont('helvetica', 'normal');
                doc.text(`Name: ${contractData.freelancerName}`, 25, 78);
                doc.text(`Role: ${contractData.role}`, 25, 82);
                doc.text(`Location: ${contractData.location}`, 25, 86);
                
                // Project details
                doc.setFillColor(248, 249, 250);
                doc.rect(110, 65, 80, 25, 'F');
                doc.setDrawColor(255, 178, 0);
                doc.setLineWidth(0.5);
                doc.rect(110, 65, 80, 25, 'S');
                
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('PROJECT DETAILS', 115, 72);
                
                doc.setFontSize(7);
                doc.setFont('helvetica', 'normal');
                doc.text(`Email: ${contractData.freelancerEmail}`, 115, 78);
                doc.text(`Start: ${contractData.projectStart}`, 115, 82);
                doc.text(`Rate: ${contractData.rate}`, 115, 86);
                
                // Contract terms
                doc.setFillColor(255, 178, 0);
                doc.rect(20, 100, 170, 8, 'F');
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('CONTRACT TERMS & CONDITIONS', 105, 106, { align: 'center' });
                
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                
                const terms = [
                    'INDEPENDENT CONTRACTOR: Not an employee of Cochran Films.',
                    'SERVICES: Provide professional services as specified.',
                    'COMPENSATION: Payment within 24 hours of completion.',
                    'STANDARDS: All work must meet Cochran Films quality.',
                    'ATTIRE: Professional attire (all black) required.',
                    'PUNCTUALITY: Arrive 15 minutes before start time.',
                    'DOCUMENTATION: Bring valid ID and signed contract.',
                    'EQUIPMENT: Use provided Cochran Films equipment.',
                    'CONDUCT: Maintain professional demeanor at all times.',
                    'SAFETY: Follow all safety protocols provided.',
                    'CONFIDENTIALITY: Respect project confidentiality.',
                    'BTS CONTENT: May freely take and share behind-the-scenes.',
                    'TAX OBLIGATIONS: Contractor responsible for personal taxes.',
                    'TRANSPORTATION: Contractor responsible for own transport.'
                ];
                
                let currentY = 120;
                terms.forEach((term, index) => {
                    const isLeftColumn = index < 7;
                    const columnIndex = isLeftColumn ? index : index - 7;
                    const xPos = isLeftColumn ? 20 : 110;
                    const yPos = 120 + (columnIndex * 8);
                    
                    if (term.includes('\n')) {
                        const lines = term.split('\n');
                        lines.forEach((line, lineIndex) => {
                            doc.text(line, xPos, yPos + (lineIndex * 4));
                        });
                    } else {
                        doc.text(term, xPos, yPos);
                    }
                });
                
                // Signatures
                const signatureY = 200;
                doc.setFillColor(255, 178, 0);
                doc.rect(20, signatureY - 5, 170, 8, 'F');
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('CONTRACT SIGNATURES', 105, signatureY + 2, { align: 'center' });
                
                // Company signature
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('COCHRAN FILMS (COMPANY)', 20, signatureY + 15);
                
                doc.setFillColor(248, 249, 250);
                doc.rect(20, signatureY + 20, 75, 25, 'F');
                doc.setDrawColor(255, 178, 0);
                doc.setLineWidth(0.5);
                doc.rect(20, signatureY + 20, 75, 25, 'S');
                
                doc.setFontSize(6);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                doc.text('Authorized Signature:', 25, signatureY + 26);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'italic');
                doc.text('Cody Cochran', 25, signatureY + 32);
                
                doc.setDrawColor(0, 0, 0);
                doc.setLineWidth(0.3);
                doc.line(25, signatureY + 34, 85, signatureY + 34);
                
                doc.setFontSize(6);
                doc.setFont('helvetica', 'normal');
                doc.text('Title: Founder & CEO', 25, signatureY + 38);
                doc.text('Date: ' + contractData.effectiveDate, 25, signatureY + 42);
                
                // Contractor signature
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'bold');
                doc.text('CONTRACTOR SIGNATURE', 105, signatureY + 15);
                
                doc.setFillColor(248, 249, 250);
                doc.rect(105, signatureY + 20, 75, 25, 'F');
                doc.setDrawColor(255, 178, 0);
                doc.setLineWidth(0.5);
                doc.rect(105, signatureY + 20, 75, 25, 'S');
                
                doc.setFontSize(6);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'normal');
                doc.text('Contractor:', 115, signatureY + 26);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.setFont('helvetica', 'italic');
                doc.text(contractData.freelancerName, 115, signatureY + 32);
                
                doc.setDrawColor(0, 0, 0);
                doc.setLineWidth(0.3);
                doc.line(115, signatureY + 34, 175, signatureY + 34);
                
                doc.setFontSize(6);
                doc.setFont('helvetica', 'normal');
                doc.text('Signature: ' + contractData.signature, 115, signatureY + 38);
                doc.text('Date: ' + contractData.signatureDate, 115, signatureY + 42);
                
                // Footer
                const footerY = 260;
                doc.setFillColor(248, 249, 250);
                doc.rect(20, footerY - 5, 170, 20, 'F');
                doc.setDrawColor(255, 178, 0);
                doc.setLineWidth(0.3);
                doc.rect(20, footerY - 5, 170, 20, 'S');
                
                doc.setFontSize(6);
                doc.setTextColor(100, 100, 100);
                doc.setFont('helvetica', 'normal');
                doc.text('This contract was digitally signed and is legally binding under Georgia law.', 105, footerY + 3, { align: 'center' });
                doc.text('Generated by Cochran Films Contract Portal ‚Ä¢ ' + new Date().toLocaleDateString(), 105, footerY + 8, { align: 'center' });
                doc.text('Contract ID: ' + contractData.contractId, 105, footerY + 13, { align: 'center' });
                
                // Save PDF to user's device
                const safeFileName = userName.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, ' ').trim() + '.pdf';
                doc.save(safeFileName);
                
                console.log('‚úÖ PDF generated and downloaded successfully:', safeFileName);
                showNotification('‚úÖ Contract downloaded successfully!', 'success');
                
            } catch (error) {
                console.error('‚ùå Error generating PDF:', error);
                showNotification('‚ùå Error generating contract PDF. Please try again.', 'error');
            }
        }

        // Generate all contract files
        function generateAllContracts() {
            const statusDiv = document.getElementById('contractGenerationStatus');
            statusDiv.innerHTML = '<p style="color: #FFB200;">üîÑ Generating contract files...</p>';
            
            const contracts = {};
            
            Object.keys(window.users).forEach(userName => {
                const userData = window.users[userName];
                const fileName = userName.toLowerCase().replace(/\s+/g, '-') + '.html';
                contracts[fileName] = generateContractHTML(userName, userData);
            });
            
            window.generatedContracts = contracts;
            
            statusDiv.innerHTML = `
                <p style="color: #22c55e;">‚úÖ Generated ${Object.keys(contracts).length} contract files</p>
            `;
            
            document.getElementById('downloadContractsBtn').style.display = 'block';
        }

        // Generate contract HTML
        function generateContractHTML(userName, userData) {
            return `<!DOCTYPE html>
<html>
<head>
    <title>Contract - ${userName}</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .contract { max-width: 800px; margin: auto; }
        h1 { color: #FFB200; }
    </style>
</head>
<body>
    <div class="contract">
        <h1>Contract for ${userName}</h1>
        <p>Role: ${userData.profile?.role || 'Contractor'}</p>
        <p>Email: ${userData.profile?.email}</p>
        <p>Contract URL: ${userData.contract?.contractUrl}</p>
        <p>Approved Date: ${userData.profile?.approvedDate || 'TBD'}</p>
    </div>
</body>
</html>`;
        }

        // Download all contract files as a zip
        function downloadContractFiles() {
            if (!window.generatedContracts) {
                alert('Please generate contracts first.');
                return;
            }
            
            const zip = new JSZip();
            
            Object.keys(window.generatedContracts).forEach(fileName => {
                zip.file(fileName, window.generatedContracts[fileName]);
            });
            
            zip.generateAsync({type: 'blob'}).then(function(content) {
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'contracts.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            
            // Initialize admin bank viewer
            if (typeof AdminBankViewer !== 'undefined') {
                window.adminBankViewer = new AdminBankViewer();
                console.log('‚úÖ Admin Bank Viewer initialized');
            } else {
                console.log('‚ö†Ô∏è Admin Bank Viewer not available, using fallback');
            }
            
            // Auto-run tests after a short delay
            setTimeout(() => {
                console.log('üß™ Auto-running dashboard tests...');
                runDashboardTests();
            }, 2000);
        });
        
        // Test function to run all dashboard tests
        async function runDashboardTests() {
            console.log('üöÄ Starting Automatic Dashboard Tests...\n');
            
            // Test 1: Check if dashboard elements exist
            console.log('üìã Test 1: Dashboard Elements');
            const elements = ['loginScreen', 'dashboard', 'totalCreators', 'activeJobs', 'pendingReviews', 'totalContracts', 'jobForm', 'contractForm', 'jobsList', 'contractsList'];
            let passed = 0;
            let failed = 0;
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    console.log(`‚úÖ ${elementId} - Found`);
                    passed++;
                } else {
                    console.log(`‚ùå ${elementId} - Missing`);
                    failed++;
                }
            });
            console.log(`üìä Results: ${passed} passed, ${failed} failed`);
            
            // Test 2: Check authentication system
            console.log('\nüìã Test 2: Authentication System');
            if (typeof ADMIN_PASSWORD !== 'undefined') {
                console.log('‚úÖ ADMIN_PASSWORD - Configured');
            } else {
                console.log('‚ùå ADMIN_PASSWORD - Missing');
            }
            
            // Test 3: Check API endpoints
            console.log('\nüìã Test 3: API Endpoints');
            try {
                const jobsResponse = await fetch('/api/jobs-data');
                if (jobsResponse.ok) {
                    const jobsData = await jobsResponse.json();
                    console.log(`‚úÖ /api/jobs-data - Working (${jobsData.jobs?.length || 0} jobs)`);
                } else {
                    console.log(`‚ùå /api/jobs-data - Status: ${jobsResponse.status}`);
                }
            } catch (error) {
                console.log('‚ùå /api/jobs-data - Error:', error.message);
            }
            
            try {
                const usersResponse = await fetch('users.json');
                if (usersResponse.ok) {
                    const usersData = await usersResponse.json();
                    console.log(`‚úÖ users.json - Working (${Object.keys(usersData.users || {}).length} users)`);
                } else {
                    console.log(`‚ùå users.json - Status: ${usersResponse.status}`);
                }
            } catch (error) {
                console.log('‚ùå users.json - Error:', error.message);
            }
            
            // Test 4: Check functions
            console.log('\nüìã Test 4: Core Functions');
            const functions = ['loadJobs', 'displayJobs', 'loadUsers', 'displayUsers', 'updateStats'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    console.log(`‚úÖ ${funcName}() - Available`);
                } else {
                    console.log(`‚ùå ${funcName}() - Missing`);
                }
            });
            
            // Test 5: Check global variables
            console.log('\nüìã Test 5: Global Variables');
            const variables = ['jobs', 'users', 'isAuthenticated'];
            variables.forEach(varName => {
                if (typeof window[varName] !== 'undefined') {
                    console.log(`‚úÖ ${varName} - Available`);
                } else {
                    console.log(`‚ùå ${varName} - Missing`);
                }
            });
            
            // Test 6: Check login status
            console.log('\nüìã Test 6: Login Status');
            const loginScreen = document.getElementById('loginScreen');
            const dashboard = document.getElementById('dashboard');
            if (loginScreen && dashboard) {
                const loginDisplay = loginScreen.style.display;
                const dashboardDisplay = dashboard.style.display;
                console.log(`Login screen: ${loginDisplay}, Dashboard: ${dashboardDisplay}`);
                
                if (loginDisplay === 'flex' && dashboardDisplay === 'none') {
                    console.log('‚úÖ Login screen visible (expected)');
                } else if (loginDisplay === 'none' && dashboardDisplay === 'block') {
                    console.log('‚úÖ Dashboard visible (logged in)');
                } else {
                    console.log('‚ö†Ô∏è Unexpected display states');
                }
            }
            
            console.log('\nüìä AUTOMATIC TEST COMPLETE');
            console.log('üí° Check console for detailed results');
        }
    </script>
</body>
</html> 