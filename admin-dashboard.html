<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Cochran Films</title>
    
    <!-- Favicon to prevent 404 error -->
    <link rel="icon" href="https://static.wixstatic.com/media/aeef42_570164eee75f4394a4fc1cf9c62ceae0~mv2.png" type="image/png">
    
    <!-- Schema.org structured data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Cochran Films",
      "url": "https://cochranfilms.com",
      "logo": "https://static.wixstatic.com/media/aeef42_570164eee75f4394a4fc1cf9c62ceae0~mv2.png",
      "description": "Professional film and photography services with automated creator management system",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Douglasville",
        "addressRegion": "GA",
        "addressCountry": "US"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "email": "info@cochranfilms.com"
      },
      "sameAs": [
        "https://collaborate.cochranfilms.com"
      ]
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Cochran Films Admin Dashboard",
      "description": "Central management system for creator contracts, job listings, and automated workflows",
      "url": "https://collaborate.cochranfilms.com/admin-dashboard.html",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web Browser",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Creator Management",
        "Contract Automation",
        "Job Listings",
        "Payment Processing",
        "Email Notifications",
        "GitHub Integration"
      ]
    }
    </script>
    
    <!-- Content Security Policy - Allow Google APIs, EmailJS, and GitHub API -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://apis.google.com https://accounts.google.com https://ssl.gstatic.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' data: https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self' https://apis.google.com https://accounts.google.com https://www.googleapis.com https://api.emailjs.com https://api.github.com; frame-src https://accounts.google.com;"
    
    <!-- Fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Performance Data Script -->
    <script src="performance-data.js"></script>
    
    <!-- EmailJS for automated job acceptance emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <script>
        // Simple admin dashboard configuration
        let uploadedContracts = [];
        let contractsAnalytics = {};
        let performanceReviews = {};
        let users = {};
        let jobs = [];

        // EmailJS Configuration for Job Acceptance
        const EMAILJS_CONFIG = {
            publicKey: 'p4pF3OWvh-DXtae4c',
            serviceId: 'service_t11yvru',
            jobAcceptanceTemplateId: 'template_job_acceptance' // ⚠️ This template ID doesn't exist - create it in EmailJS dashboard
        };

        // Global GitHub configuration
        let GITHUB_CONFIG = {
            token: null,
            owner: 'cochranfilms',
            repo: 'cochran-job-listings',
            repoOwner: 'cochranfilms',
            repoName: 'cochran-job-listings',
            branch: 'main'
        };
        
        // Load GitHub configuration from external file
        async function loadGitHubConfig() {
            try {
                // First try to load the public config
                const response = await fetch('config/github-config-public.json');
                if (response.ok) {
                    const config = await response.json();
                    GITHUB_CONFIG = {
                        token: null, // Token needs to be set via admin dashboard
                        owner: config.repoOwner || 'cochranfilms',
                        repo: config.repoName || 'cochran-job-listings',
                        repoOwner: config.repoOwner || 'cochranfilms',
                        repoName: config.repoName || 'cochran-job-listings',
                        branch: config.branch || 'main'
                    };
                    console.log('✅ GitHub configuration loaded successfully');
                    return true;
                } else {
                    console.warn('⚠️ Could not load GitHub config file, using fallback');
                    return false;
                }
            } catch (error) {
                console.warn('⚠️ Error loading GitHub config:', error);
                return false;
            }
        }
        
        // GitHub token management is now handled securely by the server
        // No client-side token handling needed - all API calls go through secure server endpoints

        // Initialize EmailJS and GitHub config
        document.addEventListener('DOMContentLoaded', async function() {
            if (typeof emailjs !== 'undefined') {
                emailjs.init(EMAILJS_CONFIG.publicKey);
                console.log('✅ EmailJS initialized for job acceptance emails');
            } else {
                console.warn('⚠️ EmailJS library not loaded');
            }
            
            // Load GitHub configuration
            await loadGitHubConfig();
            
            // Clear any old local contract data from localStorage
            localStorage.removeItem('uploadedContracts');
            localStorage.removeItem('signedContracts');
            console.log('🧹 Cleared old local contract data from localStorage');
        });

        // Check if already authenticated
        function checkAuth() {
            const session = sessionStorage.getItem('adminDashboardAuthenticated');
            if (session === 'true') {
                isAuthenticated = true;
                showAdminInterface();
            } else {
                showLoginScreen();
            }
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminInterface').style.display = 'none';
        }

        // Show admin interface
        async function showAdminInterface() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminInterface').style.display = 'block';
            
            await loadJobs();
            await loadUsers();
            await loadUploadedContracts();
            await loadPerformanceReviews();
            
            // Initialize real-time performance review monitoring
            initializePerformanceReviewMonitoring();
        }

        // Handle login
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple authentication
            if (username === 'admin' && password === 'Deannajack3#') {
                sessionStorage.setItem('adminDashboardAuthenticated', 'true');
                isAuthenticated = true;
                showAdminInterface();
            } else {
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        // Initialize login form handler
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            // Listen for payment method updates from user portal
            window.addEventListener('message', function(event) {
                if (event.data.type === 'paymentMethodUpdated') {
                    console.log('🔄 Payment method updated by user:', event.data.email, event.data.paymentMethod);
                    // Refresh user data to show updated payment methods
                    loadUsers();
                }
            });
            
            // Cleanup performance review monitoring on page unload
            window.addEventListener('beforeunload', function() {
                cleanupPerformanceReviewMonitoring();
            });
        });

        // Logout
        function logout() {
            // Cleanup performance review monitoring
            cleanupPerformanceReviewMonitoring();
            
            sessionStorage.removeItem('adminDashboardAuthenticated');
            isAuthenticated = false;
            showLoginScreen();
        }

        // Tab switching
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const btns = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            btns.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // ==================== CONTRACTS UPLOAD FUNCTIONALITY ====================

        // Manual upload functionality removed - contracts are now automatically uploaded via contract signing

        // Manual upload functionality removed - contracts are now automatically uploaded via contract signing

        // Manual upload functions removed - contracts are now automatically uploaded via contract signing

        // Load uploaded contracts
        async function loadUploadedContracts() {
            console.log('🔄 Loading uploaded contracts...');
            
            try {
                const response = await fetch('/api/uploaded-contracts');
                if (response.ok) {
                    const data = await response.json();
                    // The API returns the full JSON structure, so we need to access uploadedContracts
                    uploadedContracts = data.uploadedContracts || [];
                    console.log('✅ Loaded', uploadedContracts.length, 'uploaded contracts from API');
                } else {
                    console.warn('⚠️ Could not load uploaded contracts from API, showing empty state');
                    uploadedContracts = [];
                }
            } catch (error) {
                console.error('❌ Error loading uploaded contracts:', error);
                uploadedContracts = [];
            }
            
            displayUploadedContracts();
            updateContractAnalytics();
            
            console.log('✅ Loaded', uploadedContracts.length, 'uploaded contracts');
        }

        // Display uploaded contracts
        function displayUploadedContracts() {
            const container = document.getElementById('uploadedContractsList');
            const countElement = document.getElementById('contractCount');
            
            // Check if container exists
            if (!container) {
                console.warn('⚠️ uploadedContractsList container not found');
                return;
            }
            
            if (uploadedContracts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                        <h3 style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">📋 No Contracts Uploaded Yet</h3>
                        <p>Upload signed contract PDFs using the form above</p>
                    </div>
                `;
                if (countElement) countElement.textContent = '';
                return;
            }
            
            if (countElement) countElement.textContent = `(${uploadedContracts.length} contract${uploadedContracts.length !== 1 ? 's' : ''})`;
            
            const contractsHTML = uploadedContracts.map((contract, index) => `
                <div class="item-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <input type="checkbox" name="contract-select" value="${index}" style="transform: scale(1.2);">
                            <h3>${contract.freelancerName}</h3>
                        </div>
                        <div style="text-align: right; font-size: 0.8rem; color: rgba(255,255,255,0.6);">
                            <div>📁 ${contract.fileName}</div>
                            <div>📤 ${new Date(contract.uploadDate).toLocaleDateString()}</div>
                        </div>
                    </div>
                    
                    <div class="item-meta">
                        <span>📧 ${contract.freelancerEmail}</span>
                        <span>🎯 ${contract.role}</span>
                        <span>💰 ${contract.rate}</span>
                        <span>📍 ${contract.location}</span>
                        ${contract.contractDate ? `<span>📅 ${contract.contractDate}</span>` : ''}
                    </div>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                            <div><strong>Contract ID:</strong><br>${contract.contractId}</div>
                            <div><strong>File Size:</strong><br>${(contract.fileSize / 1024).toFixed(1)} KB</div>
                        </div>
                        ${contract.notes ? `<div style="margin-top: 0.5rem;"><strong>Notes:</strong><br>${contract.notes}</div>` : ''}
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-small" onclick="downloadUploadedContract(${index})">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                        <button class="btn btn-small" onclick="viewUploadedContractDetails(${index})">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteUploadedContract(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = contractsHTML;
        }

        // Bulk delete selected contracts
        async function bulkDeleteContracts() {
            const selectedCheckboxes = document.querySelectorAll('input[name="contract-select"]:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('❌ Please select at least one contract to delete.', 'warning');
                return;
            }
            
            const selectedContracts = Array.from(selectedCheckboxes).map(checkbox => {
                const index = parseInt(checkbox.value);
                return { index, contract: uploadedContracts[index] };
            });
            
            if (confirm(`Are you sure you want to delete ${selectedContracts.length} contract(s)?\n\nThis will delete both the contract data AND the PDF files from GitHub.\n\nThis action cannot be undone.`)) {
                try {
                    let successCount = 0;
                    let errorCount = 0;
                    
                    for (const { index, contract } of selectedContracts) {
                        try {
                            // Remove from local array (in reverse order to maintain indices)
                            uploadedContracts.splice(index, 1);
                            
                            successCount++;
                        } catch (error) {
                            console.error(`❌ Error deleting contract ${contract.contractId}:`, error);
                            errorCount++;
                        }
                    }
                    

                    
                    displayUploadedContracts();
                    updateContractAnalytics();
                    
                    if (errorCount === 0) {
                        showNotification(`✅ Successfully deleted ${successCount} contract(s)!\n\nBoth contract data and PDF files have been removed from GitHub.`, 'success');
                    } else {
                        showNotification(`⚠️ Deleted ${successCount} contract(s), but ${errorCount} failed.\n\nCheck the console for details.`, 'warning');
                    }
                    
                } catch (error) {
                    console.error('❌ Error in bulk delete:', error);
                    showNotification(`❌ Error during bulk delete: ${error.message}`, 'error');
                }
            }
        }

        // Download uploaded contract
        function downloadUploadedContract(index) {
            const contract = uploadedContracts[index];
            if (!contract || !contract.fileData) {
                showNotification('❌ Contract file not found.', 'error');
                return;
            }
            
            const link = document.createElement('a');
            link.href = contract.fileData;
            link.download = contract.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('📄 Downloaded contract:', contract.fileName);
        }

        // View uploaded contract details
        function viewUploadedContractDetails(index) {
            const contract = uploadedContracts[index];
            
            // Create a proper modal instead of using notification
            const modal = document.createElement('div');
            modal.id = 'contractDetailsModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #1a1a1a;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                ">
                    <button onclick="this.closest('#contractDetailsModal').remove()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                            ">×</button>
                    
                    <h3 style="color: #FFB200; margin-bottom: 1.5rem; text-align: center;">
🎬 COCHRAN FILMS - CONTRACT DETAILS
                    </h3>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">📋 Basic Information</h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; line-height: 1.6;">
                            <div><strong>Contract ID:</strong> ${contract.contractId}</div>
                            <div><strong>Freelancer:</strong> ${contract.freelancerName}</div>
                            <div><strong>Email:</strong> ${contract.freelancerEmail}</div>
                            <div><strong>Role:</strong> ${contract.role}</div>
                            <div><strong>Rate:</strong> ${contract.rate}</div>
                            <div><strong>Location:</strong> ${contract.location}</div>
                            <div><strong>Contract Date:</strong> ${contract.contractDate || 'Not specified'}</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">📁 File Information</h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; line-height: 1.6;">
                            <div><strong>File Name:</strong> ${contract.fileName}</div>
                            <div><strong>File Size:</strong> ${(contract.fileSize / 1024).toFixed(1)} KB</div>
                            <div><strong>Upload Date:</strong> ${new Date(contract.uploadDate).toLocaleString()}</div>
                            <div><strong>Status:</strong> ${contract.status}</div>
                        </div>
                    </div>
                    
                    ${contract.notes ? `
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">📝 Notes</h4>
                        <div style="color: rgba(255,255,255,0.9); font-size: 0.9rem; line-height: 1.6;">
                            ${contract.notes}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Delete uploaded contract
        async function deleteUploadedContract(index) {
            const contract = uploadedContracts[index];
            if (confirm(`Are you sure you want to delete the contract for ${contract.freelancerName}?\n\nContract ID: ${contract.contractId}\n\nThis will delete both the contract data AND the PDF file from GitHub.\n\nThis action cannot be undone.`)) {
                try {
                    // Remove from local array
                    uploadedContracts.splice(index, 1);
                    
                    displayUploadedContracts();
                    updateContractAnalytics();
                    
                    showNotification(`✅ Contract for ${contract.freelancerName} deleted successfully!`, 'success');
                    
                } catch (error) {
                    console.error('❌ Error deleting contract:', error);
                    showNotification(`❌ Error deleting contract: ${error.message}`, 'error');
                }
            }
        }

        // Export contract list
        function exportContractList() {
            if (uploadedContracts.length === 0) {
                showNotification('No contracts to export.', 'warning');
                return;
            }
            
            const exportData = {
                exportDate: new Date().toISOString(),
                totalContracts: uploadedContracts.length,
                contracts: uploadedContracts.map(contract => ({
                    ...contract,
                    fileData: undefined // Remove file data from export
                }))
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `cochran-films-contracts-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            console.log('📦 Contract list exported');
        }

        // Export uploaded contracts for user portal access
        function exportUploadedContractsForPortal() {
            if (uploadedContracts.length === 0) {
                showNotification('No uploaded contracts to export.', 'warning');
                return;
            }
            
            const exportData = {
                lastUpdated: new Date().toISOString(),
                totalContracts: uploadedContracts.length,
                uploadedContracts: uploadedContracts
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `uploaded-contracts.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            console.log('📦 Uploaded contracts exported for user portal');
            showNotification('✅ Uploaded contracts exported as uploaded-contracts.json\n\nUpload this file to your server so users can access their signed contracts!', 'success');
        }

        // Update contract analytics
        function updateContractAnalytics() {
            const analytics = {
                total: uploadedContracts.length,
                thisMonth: uploadedContracts.filter(c => {
                    const uploadDate = new Date(c.uploadDate);
                    const now = new Date();
                    return uploadDate.getMonth() === now.getMonth() && uploadDate.getFullYear() === now.getFullYear();
                }).length,
                roles: {},
                totalFileSize: uploadedContracts.reduce((sum, c) => sum + (c.fileSize || 0), 0)
            };
            
            // Count roles
            uploadedContracts.forEach(contract => {
                const role = contract.role || 'Unknown';
                analytics.roles[role] = (analytics.roles[role] || 0) + 1;
            });
            
            const container = document.getElementById('contractAnalytics');
            if (!container) {
                console.warn('⚠️ contractAnalytics container not found');
                return;
            }
            container.innerHTML = `
                <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.3);">
                    <h4 style="color: #FFB200; margin-bottom: 0.5rem;">📊 Total Contracts</h4>
                    <div style="font-size: 2rem; font-weight: bold; color: #FFB200;">${analytics.total}</div>
                </div>
                
                <div style="background: rgba(34,197,94,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(34,197,94,0.3);">
                    <h4 style="color: #22c55e; margin-bottom: 0.5rem;">📅 This Month</h4>
                    <div style="font-size: 2rem; font-weight: bold; color: #22c55e;">${analytics.thisMonth}</div>
                </div>
                
                <div style="background: rgba(59,130,246,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(59,130,246,0.3);">
                    <h4 style="color: #3b82f6; margin-bottom: 0.5rem;">💾 Total Size</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;">${(analytics.totalFileSize / 1024 / 1024).toFixed(1)} MB</div>
                </div>
                
                <div style="background: rgba(168,85,247,0.1); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(168,85,247,0.3);">
                    <h4 style="color: #a855f7; margin-bottom: 0.5rem;">🎯 Top Role</h4>
                    <div style="font-size: 1.2rem; font-weight: bold; color: #a855f7;">
                        ${Object.keys(analytics.roles).length > 0 ? 
                            Object.entries(analytics.roles).sort((a, b) => b[1] - a[1])[0][0] : 
                            'No roles yet'
                        }
                    </div>
                </div>
            `;
        }

        // Update user contract status when contract is uploaded
        async function updateUserContractStatus(email, contractId, contractDate) {
            try {
                // Find and update the user in the users object
                const userName = Object.keys(users).find(name => 
                    users[name].profile?.email?.toLowerCase() === email.toLowerCase()
                );
                
                if (userName) {
                    users[userName].contract.contractStatus = 'uploaded';
                    users[userName].contract.contractId = contractId;
                    users[userName].contract.contractUploadedDate = contractDate;
                    users[userName].contract.contractSignedDate = contractDate; // Assume signed same day for now
                    
                    // Save updated users object
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    console.log('✅ Updated user contract status:', users[userName]);
                    
                    // Refresh user list display
                    displayUsers();
                    
                    // Automatically update GitHub
                    await updateUsersOnGitHub();
                    
                    showNotification('✅ User contract status updated and users.json updated on GitHub!', 'success');
                } else {
                    console.warn('⚠️ User not found in local array for email:', email);
                    showNotification(`⚠️ Note: User ${email} not found in local database.\n\nConsider adding them to the user list first, then re-uploading the contract.`, 'warning');
                }
            } catch (error) {
                console.error('❌ Error updating user contract status:', error);
                showNotification(`❌ Error updating user contract status: ${error.message}`, 'error');
            }
        }

        // ==================== JOBS MANAGEMENT FUNCTIONALITY ====================
        
        let editingJobIndex = -1;

        // Load jobs from jobs-data.json and localStorage
        async function loadJobs() {
            console.log('🔄 Loading jobs...');
            
            // First try to load from jobs API
            try {
                const response = await fetch('/api/jobs-data');
                if (response.ok) {
                    const data = await response.json();
                    jobs = data.jobs || [];
                    console.log('📖 Loaded', jobs.length, 'jobs from API');
                } else {
                    // Fallback to localStorage
                    jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
                    console.log('📝 Loaded', jobs.length, 'jobs from localStorage');
                }
            } catch (error) {
                // Fallback to localStorage
                jobs = JSON.parse(localStorage.getItem('jobs') || '[]');
                console.log('📝 Loaded', jobs.length, 'jobs from localStorage (fallback)');
            }
            
            displayJobs();
            console.log('✅ Total jobs loaded:', jobs.length);
        }

        // Display jobs
        function displayJobs() {
            const container = document.getElementById('jobsList');
            
            if (jobs.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                        <h3 style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">📋 No Jobs Created Yet</h3>
                        <p>Create your first job listing using the form above</p>
                    </div>
                `;
                return;
            }
            
            const jobsHTML = jobs.map((job, index) => `
                <div class="item-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>${job.title}</h3>
                        <span style="background: ${job.status === 'Active' ? '#22c55e' : '#6b7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">${job.status}</span>
                    </div>
                    
                    <div class="item-meta">
                        <span>📅 ${job.date || 'No date set'}</span>
                        <span>📍 ${job.location || 'No location'}</span>
                        <span>💰 ${job.pay || 'No pay listed'}</span>
                    </div>
                    
                    <div class="item-description">
                        ${job.description || 'No description provided'}
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-small" onclick="editJob(${index})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteJob(${index})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = jobsHTML;
        }

        // Job form submission
        document.addEventListener('DOMContentLoaded', function() {
            const jobForm = document.getElementById('jobForm');
            if (jobForm) {
                jobForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveJob();
                });
            }
        });

        // Save job
        async function saveJob() {
            const formData = new FormData(document.getElementById('jobForm'));
            const jobData = {
                title: formData.get('title'),
                date: formData.get('date'),
                location: formData.get('location'),
                pay: formData.get('pay'),
                description: formData.get('description'),
                status: formData.get('status')
            };

            if (!jobData.title.trim()) {
                showNotification('Job title is required', 'error');
                return;
            }

            if (editingJobIndex >= 0) {
                jobs[editingJobIndex] = jobData;
                editingJobIndex = -1;
            } else {
                jobs.push(jobData);
            }

            // Update localStorage with current jobs
            localStorage.setItem('jobs', JSON.stringify(jobs));
            
            // Automatically update GitHub with merged data
            await updateJobsOnGitHub();
            
            displayJobs();
            clearJobForm();
            showNotification('Job saved successfully and updated on GitHub!', 'success');
        }

        // Edit job
        function editJob(index) {
            const job = jobs[index];
            document.getElementById('jobTitle').value = job.title;
            document.getElementById('jobDate').value = job.date;
            document.getElementById('jobLocation').value = job.location;
            document.getElementById('jobPay').value = job.pay;
            document.getElementById('jobDescription').value = job.description;
            document.getElementById('jobStatus').value = job.status;
            editingJobIndex = index;
        }

        // Delete job
        async function deleteJob(index) {
            const job = jobs[index];
            if (confirm(`Are you sure you want to delete "${job.title}"?`)) {
                jobs.splice(index, 1);
                localStorage.setItem('jobs', JSON.stringify(jobs));
                
                // Update GitHub
                await updateJobsOnGitHub();
                
                displayJobs();
                showNotification('Job deleted successfully and updated on GitHub!', 'success');
            }
        }

        // Clear job form
        function clearJobForm() {
            document.getElementById('jobForm').reset();
            document.getElementById('jobLocation').value = 'Atlanta Area';
            editingJobIndex = -1;
        }



        // ==================== FREELANCER MANAGEMENT FUNCTIONALITY ====================
        
        let editingFreelancerIndex = -1;

        // Load users from users.json and localStorage
        async function loadUsers() {
            console.log('🔄 Loading users...');
            
            // First, try to load from users API
            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    const jsonData = await response.json();
                    users = jsonData.users || {};
                    
                    console.log('📖 Loaded', Object.keys(users).length, 'users from API');
                    
                    // Update localStorage to sync with GitHub data
                    localStorage.setItem('users', JSON.stringify(users));
                    
                } else {
                    console.warn('⚠️ Could not load users.json, trying localStorage');
                    users = JSON.parse(localStorage.getItem('users') || '{}');
                    console.log('📝 Loaded', Object.keys(users).length, 'users from localStorage');
                }
            } catch (error) {
                console.warn('⚠️ Error loading users.json:', error);
                users = JSON.parse(localStorage.getItem('users') || '{}');
                console.log('📝 Loaded', Object.keys(users).length, 'users from localStorage (fallback)');
            }
            
            displayUsers();
            console.log('✅ Total users loaded:', Object.keys(users).length);
            
            // Load and populate dropdown options
            await loadDropdownOptions();
            
            // Populate user dropdowns
            populateUserDropdowns();
            
            // Show payment method summary
            displayPaymentMethodSummary();
            
            // Check for performance review alerts
            checkPerformanceReviewAlerts();
            
            // Show status in the interface
            const statusElement = document.getElementById('freelancerStatus');
            if (statusElement) {
                statusElement.textContent = `Loaded ${Object.keys(users).length} users from ${Object.keys(users).length > 0 ? 'users.json' : 'localStorage'}`;
            }
        }
        


        // Populate user dropdowns
        function populateUserDropdowns() {
            // Populate contract upload user dropdown
            const uploadUserSelect = document.getElementById('uploadFreelancerName');
            if (uploadUserSelect) {
                uploadUserSelect.innerHTML = '<option value="">Select a user...</option>';
                Object.keys(users).forEach(userName => {
                    const option = document.createElement('option');
                    option.value = userName;
                    option.textContent = userName;
                    uploadUserSelect.appendChild(option);
                });
            }
            
            // Populate job assignment user dropdown
            const jobAssignmentSelect = document.getElementById('jobAssignmentFreelancer');
            if (jobAssignmentSelect) {
                jobAssignmentSelect.innerHTML = '<option value="">Choose a user...</option>';
                Object.keys(users).forEach(userName => {
                    const option = document.createElement('option');
                    option.value = userName;
                    option.textContent = userName;
                    jobAssignmentSelect.appendChild(option);
                });
            }
            
            console.log('👥 Populated user dropdowns with', Object.keys(users).length, 'options');
        }

        // Load dropdown options from API or use defaults
        async function loadDropdownOptions() {
            try {
                const response = await fetch('/api/dropdown-options');
                if (response.ok) {
                    window.dropdownOptions = await response.json();
                    console.log('📋 Loaded dropdown options from API:', window.dropdownOptions);
                } else {
                    // Initialize with default options if API fails
                    window.dropdownOptions = {
                        roles: ['Backdrop Photographer', 'Editor', 'Videographer', 'Photographer', 'Full Stack Designer', 'Video Editor', 'Corporate Videographer'],
                        locations: ['6695 Church Street, Douglasville, GA 30134', 'Sandy Springs, GA', 'Douglasville, GA', 'Atlanta, GA', 'Atlanta Area'],
                        rates: ['$400.00 USD (Flat)', '$450.00 USD (Flat)', '$500.00 USD (Flat)', '$750.00 USD (Flat)', '$900.00 USD (Flat)', '$150/day', '$200/day'],
                        projectTypes: ['Photography', 'Video', 'Editor Project', 'Corporate Video', 'Event Coverage', 'Product Photography', 'Real Estate', 'Wedding', 'Commercial'],
                        paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                        projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                        paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                    };
                    console.log('📋 Initialized default dropdown options (API failed):', window.dropdownOptions);
                }
            } catch (error) {
                console.error('❌ Error loading dropdown options from API:', error);
                // Initialize with default options
                window.dropdownOptions = {
                    roles: ['Backdrop Photographer', 'Editor', 'Videographer', 'Photographer', 'Full Stack Designer', 'Video Editor', 'Corporate Videographer'],
                    locations: ['6695 Church Street, Douglasville, GA 30134', 'Sandy Springs, GA', 'Douglasville, GA', 'Atlanta, GA', 'Atlanta Area'],
                    rates: ['$400.00 USD (Flat)', '$450.00 USD (Flat)', '$500.00 USD (Flat)', '$750.00 USD (Flat)', '$900.00 USD (Flat)', '$150/day', '$200/day'],
                    projectTypes: ['Photography', 'Video', 'Editor Project', 'Corporate Video', 'Event Coverage', 'Product Photography', 'Real Estate', 'Wedding', 'Commercial'],
                    paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                    projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                    paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                };
                console.log('📋 Initialized default dropdown options (error):', window.dropdownOptions);
            }
            
            // Populate the management interface
            populateDropdownManagementInterface();
            
            // Populate job assignment dropdowns
            populateJobAssignmentDropdowns();
        }
        
        // Populate dropdown options from JSON data (legacy function)
        function populateDropdownOptions() {
            // Get unique roles from freelancers.json
            const roles = new Set();
            freelancers.forEach(freelancer => {
                if (freelancer.role) roles.add(freelancer.role);
            });
            
            // Get unique locations from freelancers.json
            const locations = new Set();
            freelancers.forEach(freelancer => {
                if (freelancer.location) locations.add(freelancer.location);
            });
            
            // Get unique rates from freelancers.json
            const rates = new Set();
            freelancers.forEach(freelancer => {
                if (freelancer.rate) rates.add(freelancer.rate);
            });
            
            // Get job titles from jobs-data.json
            const jobTitles = jobs.map(job => job.title);
            
            // Get project types from jobs-data.json (extract from descriptions)
            const projectTypes = new Set();
            jobs.forEach(job => {
                if (job.description) {
                    // Extract project type from job description or title
                    const type = job.title.includes('Photographer') ? 'Photography' :
                               job.title.includes('Editor') ? 'Editor Project' :
                               job.title.includes('Videographer') ? 'Video' :
                               'General';
                    projectTypes.add(type);
                }
            });
            
            // Merge with existing options
            if (window.dropdownOptions) {
                window.dropdownOptions.roles = [...new Set([...window.dropdownOptions.roles, ...Array.from(roles)])];
                window.dropdownOptions.locations = [...new Set([...window.dropdownOptions.locations, ...Array.from(locations)])];
                window.dropdownOptions.rates = [...new Set([...window.dropdownOptions.rates, ...Array.from(rates)])];
                window.dropdownOptions.projectTypes = [...new Set([...window.dropdownOptions.projectTypes, ...Array.from(projectTypes)])];
            } else {
                window.dropdownOptions = {
                    roles: Array.from(roles),
                    locations: Array.from(locations),
                    rates: Array.from(rates),
                    jobTitles: jobTitles,
                    projectTypes: Array.from(projectTypes),
                    paymentMethods: ['Cash', 'Check', 'Zelle', 'PayPal', 'Invoice Request'],
                    projectStatuses: ['upcoming', 'in-progress', 'completed', 'cancelled'],
                    paymentStatuses: ['pending', 'processing', 'paid', 'overdue']
                };
            }
            
            console.log('📋 Populated dropdown options:', window.dropdownOptions);
        }

        // Add dropdown option
        function addDropdownOption(category, inputId) {
            const input = document.getElementById(inputId);
            const value = input.value.trim();
            
            if (!value) {
                showNotification('Please enter a value to add.', 'error');
                return;
            }
            
            if (!window.dropdownOptions[category]) {
                window.dropdownOptions[category] = [];
            }
            
            if (window.dropdownOptions[category].includes(value)) {
                showNotification('This option already exists.', 'warning');
                return;
            }
            
            window.dropdownOptions[category].push(value);
            input.value = '';
            
            // Update the management interface
            populateDropdownManagementInterface();
            
            // Update job assignment dropdowns
            populateJobAssignmentDropdowns();
            
            console.log(`✅ Added ${value} to ${category}`);
        }
        
        // Remove dropdown option
        function removeDropdownOption(category, value) {
            if (window.dropdownOptions[category]) {
                window.dropdownOptions[category] = window.dropdownOptions[category].filter(item => item !== value);
                populateDropdownManagementInterface();
                populateJobAssignmentDropdowns();
                console.log(`✅ Removed ${value} from ${category}`);
            }
        }
        
        // Populate dropdown management interface
        function populateDropdownManagementInterface() {
            const categories = ['roles', 'locations', 'rates', 'projectTypes'];
            
            categories.forEach(category => {
                const container = document.getElementById(`${category}List`);
                if (container && window.dropdownOptions[category]) {
                    container.innerHTML = window.dropdownOptions[category].map(item => `
                        <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem;">
                            <span style="color: rgba(255,255,255,0.9); font-size: 0.9rem;">${item}</span>
                            <button onclick="removeDropdownOption('${category}', '${item}')" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `).join('');
                }
            });
        }
        
        // Populate all dropdowns from dropdown options
        function populateJobAssignmentDropdowns() {
            if (!window.dropdownOptions) return;
            
            // Populate role dropdowns
            const roleSelects = ['jobRole', 'freelancerRole'];
            roleSelects.forEach(selectId => {
                const roleSelect = document.getElementById(selectId);
                if (roleSelect) {
                    roleSelect.innerHTML = '<option value="">Select a role...</option>';
                    window.dropdownOptions.roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role;
                        option.textContent = role;
                        roleSelect.appendChild(option);
                    });
                }
            });
            
            // Populate location dropdowns
            const locationSelects = ['assignmentJobLocation', 'freelancerLocation', 'jobLocation'];
            locationSelects.forEach(selectId => {
                const locationSelect = document.getElementById(selectId);
                if (locationSelect) {
                    locationSelect.innerHTML = '<option value="">Select a location...</option>';
                    window.dropdownOptions.locations.forEach(location => {
                        const option = document.createElement('option');
                        option.value = location;
                        option.textContent = location;
                        locationSelect.appendChild(option);
                    });
                }
            });
            
            // Populate rate dropdowns
            const rateSelects = ['assignmentJobRate', 'freelancerRate', 'jobPay'];
            rateSelects.forEach(selectId => {
                const rateSelect = document.getElementById(selectId);
                if (rateSelect) {
                    rateSelect.innerHTML = '<option value="">Select a rate...</option>';
                    window.dropdownOptions.rates.forEach(rate => {
                        const option = document.createElement('option');
                        option.value = rate;
                        option.textContent = rate;
                        rateSelect.appendChild(option);
                    });
                }
            });
            
            // Populate project type dropdown
            const projectTypeSelect = document.getElementById('assignmentJobProjectType');
            if (projectTypeSelect) {
                projectTypeSelect.innerHTML = '<option value="">Select a project type...</option>';
                window.dropdownOptions.projectTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    projectTypeSelect.appendChild(option);
                });
            }
        }
        
        // Save dropdown options to GitHub API
        async function saveDropdownOptions() {
            if (!window.dropdownOptions) {
                showNotification('❌ No dropdown options to save.', 'error');
                return;
            }
            
            try {
                console.log('🔄 Saving dropdown options to GitHub via server...');
                
                // Get current SHA for the file
                const shaResponse = await fetch('/api/github/info');
                if (!shaResponse.ok) {
                    throw new Error('Failed to get GitHub info');
                }
                
                const shaData = await shaResponse.json();
                const currentSha = shaData.sha;
                
                console.log('🔍 Retrieved current SHA:', currentSha);
                
                // Update the file on GitHub
                const updateResponse = await fetch('/api/github/file/dropdown-options.json', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'Update dropdown options via admin dashboard',
                        content: btoa(JSON.stringify(window.dropdownOptions, null, 2)),
                        sha: currentSha
                    })
                });
                
                if (updateResponse.ok) {
                    console.log('✅ Successfully saved dropdown options to GitHub');
                    showNotification('✅ Dropdown options saved successfully to GitHub!', 'success');
                } else {
                    const errorData = await updateResponse.json();
                    throw new Error(`GitHub API error: ${errorData.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('❌ Error saving dropdown options:', error);
                showNotification(`❌ Failed to save dropdown options: ${error.message}`, 'error');
            }
        }
        
        // Display payment method summary
        function displayPaymentMethodSummary() {
            const paymentMethods = {};
            let totalUsers = 0;
            let usersWithPaymentMethod = 0;
            
            Object.values(users).forEach(userData => {
                totalUsers++;
                if (userData.paymentMethod) {
                    usersWithPaymentMethod++;
                    paymentMethods[userData.paymentMethod] = (paymentMethods[userData.paymentMethod] || 0) + 1;
                }
            });
            
            // Create summary HTML
            const summaryHTML = `
                <div style="background: rgba(255,178,0,0.1); padding: 1.5rem; border-radius: 12px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                    <h3 style="color: #FFB200; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-credit-card"></i> Payment Method Summary
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #FFB200;">${usersWithPaymentMethod}</div>
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">Users with Payment Method</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #ff6b6b;">${totalUsers - usersWithPaymentMethod}</div>
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">Users Pending Selection</div>
                        </div>
                    </div>
                    ${Object.keys(paymentMethods).length > 0 ? `
                        <div style="margin-top: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Payment Method Breakdown:</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                ${Object.entries(paymentMethods).map(([method, count]) => `
                                    <span style="background: rgba(255,178,0,0.3); color: #FFB200; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">
                                        ${method.toUpperCase()}: ${count}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Insert summary at the top of the freelancers list
            const container = document.getElementById('contractsList');
            if (container && container.children.length > 0) {
                container.insertAdjacentHTML('afterbegin', summaryHTML);
            }
        }

        // Check for performance review alerts
        function checkPerformanceReviewAlerts() {
            const pendingReviews = Object.values(users).filter(userData => shouldShowPerformanceReview(userData));
            
            if (pendingReviews.length > 0) {
                const alertContainer = document.createElement('div');
                alertContainer.id = 'performanceReviewAlert';
                alertContainer.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #f59e0b, #d97706);
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 12px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 1000;
                    max-width: 300px;
                    border: 1px solid rgba(255,255,255,0.2);
                `;
                
                alertContainer.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                        <h4 style="margin: 0; color: white;"><i class="fas fa-star"></i> Performance Reviews Due</h4>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">×</button>
                    </div>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">
                        ${pendingReviews.length} user${pendingReviews.length > 1 ? 's' : ''} need${pendingReviews.length > 1 ? '' : 's'} performance review.
                    </p>
                    <div style="margin-top: 0.5rem;">
                        <button onclick="showPerformanceReviewList()" 
                                style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">
                            View All
                        </button>
                    </div>
                `;
                
                document.body.appendChild(alertContainer);
                
                // Auto-remove after 10 seconds
                setTimeout(() => {
                    const alert = document.getElementById('performanceReviewAlert');
                    if (alert) alert.remove();
                }, 10000);
            }
        }

        // Show performance review list
        function showPerformanceReviewList() {
            const pendingReviews = Object.values(users).filter(userData => shouldShowPerformanceReview(userData));
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-star"></i> Performance Reviews Due</h2>
                        <button onclick="closeModal(this)" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">×</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">
                            The following users have completed paid projects and need performance reviews:
                        </p>
                        ${pendingReviews.map(userData => `
                            <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="color: #FFB200; margin: 0 0 0.5rem 0;">${Object.keys(users).find(key => users[key] === userData)}</h4>
                                        <p style="color: rgba(255,255,255,0.8); margin: 0; font-size: 0.9rem;">${userData.profile?.email || 'No email'}</p>
                                    </div>
                                    <button onclick="showPerformanceReviewModal('${Object.keys(users).find(key => users[key] === userData)}'); closeModal(this);" 
                                            style="background: #FFB200; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                        Review Now
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,178,0,0.2);">
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> Performance reviews help improve collaboration and future opportunities.
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Get performance review status badge
        function getPerformanceReviewStatus(userData) {
            // Try multiple ways to get the email
            const userEmail = userData.profile?.email || userData.email || userData.profile?.userEmail;
            console.log('🔍 Checking performance review for user:', userData.name, 'Email:', userEmail);
            console.log('🔍 Available performance reviews:', Object.keys(performanceReviews));
            
            const existingReview = performanceReviews[userEmail];
            
            if (existingReview) {
                const statusColor = existingReview.status === 'completed' ? '#22c55e' : 
                                  existingReview.status === 'pending' ? '#f59e0b' : '#ef4444';
                return `<span style="background: ${statusColor}; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">${existingReview.status.toUpperCase()}</span>`;
            } else {
                return `<span style="background: rgba(255,255,255,0.2); color: rgba(255,255,255,0.7); padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">NO REVIEW</span>`;
            }
        }

        // Get performance review summary
        function getPerformanceReviewSummary(userData) {
            // Try multiple ways to get the email
            const userEmail = userData.profile?.email || userData.email || userData.profile?.userEmail;
            const existingReview = performanceReviews[userEmail];
            
            if (existingReview) {
                const reviewDate = existingReview.reviewDate ? new Date(existingReview.reviewDate).toLocaleDateString() : 'N/A';
                const overallRating = existingReview.overallRating || 'N/A';
                const comments = existingReview.comments ? existingReview.comments.substring(0, 100) + (existingReview.comments.length > 100 ? '...' : '') : 'No comments';
                
                return `
                    <div style="margin-bottom: 0.5rem;">
                        <strong>Date:</strong> ${reviewDate} | <strong>Rating:</strong> ${overallRating}/5
                    </div>
                    <div style="font-style: italic; color: rgba(255,255,255,0.7);">
                        "${comments}"
                    </div>
                `;
            } else {
                // Check if they have completed paid projects
                const hasCompletedProjects = userData.jobs && 
                    Object.values(userData.jobs || {}).some(job => 
                        job.projectStatus === 'completed' && job.paymentStatus === 'paid'
                    );
                
                if (hasCompletedProjects) {
                    return `<span style="color: #f59e0b; font-weight: bold;">⚠️ Performance review needed - completed paid projects</span>`;
                } else {
                    return `<span style="color: rgba(255,255,255,0.6);">No completed paid projects yet</span>`;
                }
            }
        }

        // Get performance review button
        function getPerformanceReviewButton(userData) {
            // Try multiple ways to get the email
            const userEmail = userData.profile?.email || userData.email || userData.profile?.userEmail;
            const existingReview = performanceReviews[userEmail];
            
            // Get the user name properly
            const userName = userData.name || userData.profile?.name || 'Unknown';
            
            if (existingReview) {
                return `
                    <div style="margin-top: 0.5rem;">
                        <button onclick="showPerformanceReviewModal('${userEmail}')" 
                                style="background: #FFB200; color: #000; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.8rem;">
                            <i class="fas fa-edit"></i> Edit Review
                        </button>
                        <button onclick="viewPerformanceReviewDetails('${userEmail}')" 
                                style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.8rem; margin-left: 0.5rem;">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </div>
                `;
            } else {
                // Check if they have completed paid projects
                const hasCompletedProjects = userData.jobs && 
                    Object.values(userData.jobs || {}).some(job => 
                        job.projectStatus === 'completed' && job.paymentStatus === 'paid'
                    );
                
                if (hasCompletedProjects) {
                    return `
                        <div style="margin-top: 0.5rem;">
                            <button onclick="showPerformanceReviewModal('${userEmail}')" 
                                    style="background: #f59e0b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.8rem;">
                                <i class="fas fa-star"></i> Create Review
                            </button>
                        </div>
                    `;
                } else {
                    return `
                        <div style="margin-top: 0.5rem;">
                            <span style="color: rgba(255,255,255,0.5); font-size: 0.8rem; font-style: italic;">
                                Review available after project completion and payment
                            </span>
                        </div>
                    `;
                }
            }
        }

        // View performance review details (works with both username and email)
        function viewPerformanceReviewDetails(userNameOrEmail) {
            let userData = users[userNameOrEmail];
            let userEmail = userNameOrEmail;
            let userName = userNameOrEmail;
            
            // If not found by username, try to find by email
            if (!userData) {
                // Search for user by email
                for (const [name, data] of Object.entries(users)) {
                    if (data.profile?.email === userNameOrEmail) {
                        userData = data;
                        userName = name;
                        break;
                    }
                }
            } else {
                // If found by username, get the email
                userEmail = userData.profile?.email || userNameOrEmail;
            }
            
            // If still no user data, try to get review directly by email
            const existingReview = userData ? performanceReviews[userData.profile?.email] : performanceReviews[userNameOrEmail];
            
            if (!existingReview) {
                showNotification('No performance review found', 'warning');
                return;
            }

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const reviewDate = existingReview.reviewDate ? new Date(existingReview.reviewDate).toLocaleDateString() : 'N/A';
            const overallRating = existingReview.overallRating || 'N/A';
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-star"></i> Performance Review Details</h2>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">×</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.3);">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Review Information</h4>
                            <div style="color: rgba(255,255,255,0.9);">
                                <div><strong>Freelancer:</strong> ${userName}</div>
                                <div><strong>Email:</strong> ${userData.profile?.email || 'N/A'}</div>
                                <div><strong>Review Date:</strong> ${reviewDate}</div>
                                <div><strong>Overall Rating:</strong> ${overallRating}/5</div>
                                <div><strong>Status:</strong> ${existingReview.status || 'completed'}</div>
                                <div><strong>Reviewed By:</strong> ${existingReview.reviewedBy || 'admin'}</div>
                            </div>
                        </div>
                        
                        ${existingReview.comments ? `
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Comments</h4>
                            <p style="color: rgba(255,255,255,0.9); line-height: 1.6;">${existingReview.comments}</p>
                        </div>
                        ` : ''}
                        
                        ${existingReview.adminNotes ? `
                        <div style="background: rgba(255,0,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,0,0,0.3);">
                            <h4 style="color: #ff6b6b; margin-bottom: 0.5rem;">Admin Notes (Internal)</h4>
                            <p style="color: rgba(255,255,255,0.9); line-height: 1.6;">${existingReview.adminNotes}</p>
                        </div>
                        ` : ''}
                        
                        ${existingReview.categories ? `
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Category Ratings</h4>
                            ${Object.entries(existingReview.categories).map(([category, rating]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="color: rgba(255,255,255,0.9);">${category}:</span>
                                    <span style="color: #FFB200; font-weight: bold;">${rating}/5</span>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button onclick="showPerformanceReviewModal('${userName}'); this.closest('div[style*=\"position: fixed\"]').remove();" 
                                style="background: #FFB200; color: #000; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-edit"></i> Edit Review
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                                style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Download user contract
        function downloadUserContract(userName) {
            const userData = users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }

            // Check if contract exists in uploaded contracts
            const userContract = uploadedContracts.find(contract => 
                contract.freelancerName === userName || 
                contract.freelancerEmail === userData.profile?.email
            );

            if (userContract && userContract.contractUrl) {
                // If we have a contract URL, download it
                const link = document.createElement('a');
                link.href = userContract.contractUrl;
                link.download = `${userName.replace(/\s+/g, '_')}_Contract.pdf`;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                console.log('✅ Contract downloaded for:', userName);
                showNotification('✅ Contract downloaded successfully!', 'success');
            } else {
                // Check if contract exists in the contracts directory using contract ID format
                const contractId = userData.contract?.contractId;
                if (contractId) {
                    const contractFileName = `${contractId}.pdf`;
                    
                    // Try multiple possible URLs like user-portal.html does
                    const possibleUrls = [
                        `contracts/${contractFileName}`,
                        `https://collaborate.cochranfilms.com/contracts/${contractFileName}`,
                        `contracts/${contractId.replace('CF-UPLOAD-', 'CF-')}.pdf`,
                        `contracts/${contractId.replace('CF-', 'CF-UPLOAD-')}.pdf`
                    ];
                    
                    let downloadAttempted = false;
                    
                    for (const contractUrl of possibleUrls) {
                        try {
                    const link = document.createElement('a');
                    link.href = contractUrl;
                    link.download = contractFileName;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                            downloadAttempted = true;
                            console.log('📄 Contract download attempted for:', userName, 'with URL:', contractUrl);
                            break;
                        } catch (error) {
                            console.log('❌ Failed to download from:', contractUrl);
                        }
                    }
                    
                    if (downloadAttempted) {
                        showNotification(`📄 Downloading contract ${contractId} for ${userName}`, 'info');
                    } else {
                        showNotification(`❌ Failed to download contract for ${userName}`, 'error');
                    }
                } else {
                    // No contract ID found, show error
                    showNotification(`❌ No contract ID found for ${userName}`, 'error');
                    console.log('❌ No contract ID found for:', userName);
                }
            }
        }

        // Check if performance review should be shown for a user
        function shouldShowPerformanceReview(userData) {
            // Check if user has completed projects with paid status
            if (userData.jobs && Object.keys(userData.jobs).length > 0) {
                const completedJobs = Object.values(userData.jobs).filter(job => 
                    job.projectStatus === 'completed' && job.paymentStatus === 'paid'
                );
                
                // Show if there are completed paid jobs and no performance review exists
                if (completedJobs.length > 0) {
                    const existingReview = performanceReviews[userData.profile?.email];
                    return !existingReview || existingReview.status === 'pending';
                }
            }
            return false;
        }

        // Display users
        async function displayUsers() {
            // Ensure performance reviews are loaded before displaying users
            if (Object.keys(performanceReviews).length === 0) {
                console.log('🔄 Loading performance reviews before displaying users...');
                await loadPerformanceReviews();
            }
            
            const container = document.getElementById('contractsList');
            
            if (Object.keys(users).length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 2rem;">
                        <h3 style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">👥 No Users Added Yet</h3>
                        <p>Add users using the form above to manage contracts</p>
                    </div>
                `;
                return;
            }
            
            const usersHTML = Object.entries(users).map(([userName, userData]) => `
                <div class="item-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>${userName}</h3>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span style="background: ${userData.contract?.contractStatus === 'uploaded' ? '#22c55e' : userData.contract?.contractStatus === 'signed' ? '#f59e0b' : '#6b7280'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                ${userData.contract?.contractStatus === 'uploaded' ? 'Contract Complete' : userData.contract?.contractStatus === 'signed' ? 'Contract Signed' : 'Pending Approval'}
                            </span>
                            <span style="background: ${userData.profile?.password ? '#22c55e' : '#f59e0b'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                                ${userData.profile?.password ? '🔐 Password Set' : '⏳ Pending Password'}
                            </span>
                            <button onclick="showProjectStatusManager('${userName}')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                📊 Project Status
                            </button>
                            <button onclick="showJobAssignmentModal('${userName}')" style="background: #22c55e; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                🎯 Assign Jobs
                            </button>
                            <button onclick="downloadUserContract('${userName}')" style="background: #8b5cf6; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                📄 Download Contract
                            </button>

                            ${shouldShowPerformanceReview(userData) ? `
                            <button onclick="showPerformanceReviewModal('${userName}')" style="background: #f59e0b; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                ⭐ Performance Review
                            </button>
                            ` : ''}
                            ${!userData.profile?.approvedDate ? `
                                <button onclick="approveUser('${userName}')" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; cursor: pointer;">
                                    ✅ Approve
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="item-meta">
                        <span>📧 ${userData.profile?.email || 'No email'}</span>
                        <span>🎯 ${userData.profile?.role || 'No role'}</span>
                        <span>💰 ${userData.profile?.rate || 'No rate'}</span>
                        <span>📍 ${userData.profile?.location || 'No location'}</span>
                    </div>
                    
                    <!-- Payment Method Section -->
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong style="color: #FFB200;">💳 Payment Method</strong>
                            ${userData.paymentMethod ? 
                                `<span style="background: rgba(255,178,0,0.3); color: #FFB200; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">${userData.paymentMethod.toUpperCase()}</span>` : 
                                `<span style="background: rgba(255,0,0,0.2); color: #ff6b6b; padding: 0.3rem 0.8rem; border-radius: 6px; font-weight: bold; font-size: 0.9rem;">NOT SET</span>`
                            }
                        </div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">
                            ${userData.paymentMethod ? 
                                `User has selected <strong>${userData.paymentMethod.toUpperCase()}</strong> as their preferred payment method.` : 
                                `User has not yet selected a payment method. They can do this in their portal.`
                            }
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                            <div><strong>Project Start:</strong><br>${userData.profile?.projectStart || 'Not set'}</div>
                            <div><strong>Approved Date:</strong><br>${userData.profile?.approvedDate || 'Not approved yet'}</div>
                        </div>
                        ${userData.jobs && Object.keys(userData.jobs).length > 0 ? `
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,178,0,0.3);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <strong style="color: #22c55e;">🎯 Assigned Jobs (${Object.keys(userData.jobs).length})</strong>
                                    ${userData.primaryJob ? `<span style="background: #22c55e; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Primary Job</span>` : ''}
                                </div>
                                <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">
                                    ${Object.values(userData.jobs).slice(0, 2).map(job => `
                                        <div style="margin-bottom: 0.25rem;">• ${job.role || 'No role'} - ${job.projectStatus || 'No status'} (${job.id})</div>
                                    `).join('')}
                                    ${Object.keys(userData.jobs).length > 2 ? `<div style="font-style: italic; color: rgba(255,255,255,0.6);">... and ${Object.keys(userData.jobs).length - 2} more</div>` : ''}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Performance Review Section -->
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(255,178,0,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong style="color: #FFB200;">⭐ Performance Review</strong>
                            ${getPerformanceReviewStatus(userData)}
                        </div>
                        <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8);">
                            ${getPerformanceReviewSummary(userData)}
                        </div>
                        ${getPerformanceReviewButton(userData)}
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-small" onclick="editUser('${userName}')">
                            <i class="fas fa-edit"></i> Edit User
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteUser('${userName}')">
                            <i class="fas fa-trash"></i> Delete User
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = usersHTML;
        }

        // User management functions
        function editUser(userName) {
            const userData = users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }
            
            // For now, just show a notification that user editing is not implemented yet
            showNotification(`User editing for ${userName} is not implemented yet. This feature will be added soon.`, 'info');
        }

        async function deleteUser(userName) {
            if (confirm(`Are you sure you want to delete user "${userName}"? This action cannot be undone.`)) {
                try {
                    delete users[userName];
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    // Update users.json on GitHub
                    await updateUsersOnGitHub();
                    
                    await displayUsers();
                    showNotification(`User "${userName}" has been deleted and users.json updated on GitHub!`, 'success');
                } catch (error) {
                    console.error('❌ Error deleting user:', error);
                    showNotification(`Error deleting user: ${error.message}. The user was removed locally but the GitHub update failed.`, 'error');
                    await displayUsers(); // Still update the display
                }
            }
        }

        // User management functions
        function editUser(userName) {
            const userData = users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }
            
            // Populate the form with existing user data
            document.getElementById('freelancerName').value = userName;
            document.getElementById('freelancerEmail').value = userData.profile?.email || '';
            document.getElementById('freelancerRole').value = userData.profile?.role || '';
            document.getElementById('freelancerLocation').value = userData.profile?.location || '';
            document.getElementById('projectStart').value = userData.profile?.projectStart || '';
            document.getElementById('freelancerRate').value = userData.profile?.rate || '';
            document.getElementById('approvedDate').value = userData.profile?.approvedDate || '';
            
            // Set editing mode
            editingFreelancerIndex = 0; // Any positive number indicates editing mode
            
            // Update form button text
            const submitButton = document.querySelector('#contractForm button[type="submit"]');
            if (submitButton) {
                submitButton.innerHTML = '<i class="fas fa-save"></i> Update User';
            }
            
            // Scroll to form
            document.getElementById('contractForm').scrollIntoView({ behavior: 'smooth' });
            
            showNotification(`Editing user: ${userName}`, 'info');
        }



        // Contract form submission
        document.addEventListener('DOMContentLoaded', function() {
            const contractForm = document.getElementById('contractForm');
            if (contractForm) {
                contractForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveFreelancer();
                });
            }
        });

        // Save user (formerly freelancer)
        async function saveFreelancer() {
            const userName = document.getElementById('freelancerName').value;
            const userData = {
                profile: {
                    email: document.getElementById('freelancerEmail').value,
                    password: null, // Password will be set by user during contract signing
                    role: document.getElementById('freelancerRole').value,
                    location: document.getElementById('freelancerLocation').value,
                    projectStart: document.getElementById('projectStart').value,
                    rate: document.getElementById('freelancerRate').value,
                    approvedDate: document.getElementById('approvedDate').value
                },
                contract: {
                    contractUrl: "contract.html",
                    contractStatus: 'pending',
                    contractSignedDate: null,
                    contractUploadedDate: null,
                    contractId: null
                },
                jobs: {},
                primaryJob: null,
                paymentMethod: null
            };

            if (!userName.trim() || !userData.profile.email.trim() || !userData.profile.role.trim()) {
                showNotification('Name, email, and role are required', 'error');
                return;
            }

            if (editingFreelancerIndex >= 0) {
                // Preserve existing data when editing
                const existingUser = users[userName];
                if (existingUser) {
                    userData.contract = {
                        ...userData.contract,
                        ...existingUser.contract
                    };
                    userData.jobs = existingUser.jobs || {};
                    userData.primaryJob = existingUser.primaryJob;
                    userData.paymentMethod = existingUser.paymentMethod;
                }
                
                users[userName] = userData;
                editingFreelancerIndex = -1;
                
                // Reset form button text
                const submitButton = document.querySelector('#contractForm button[type="submit"]');
                if (submitButton) {
                    submitButton.innerHTML = '<i class="fas fa-plus"></i> Add New User';
                }
                
                showNotification('User updated successfully!', 'success');
            } else {
                // Create primary job for new users
                const primaryJobId = 'job-' + userName.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now();
                const primaryJob = {
                    id: primaryJobId,
                    role: userData.profile.role,
                    location: userData.profile.location,
                    projectStart: userData.profile.projectStart,
                    rate: userData.profile.rate,
                    projectType: userData.profile.role + ' Project',
                    description: `Primary assignment for ${userName}`,
                    projectStatus: 'upcoming',
                    paymentStatus: 'pending',
                    completionDate: null,
                    paymentDate: null
                };
                
                userData.jobs[primaryJobId] = primaryJob;
                userData.primaryJob = primaryJobId;
                
                users[userName] = userData;
                
                // Send job acceptance email for new users
                sendJobAcceptanceEmail(userName, userData);
            }

            // Save to localStorage for backup
            localStorage.setItem('users', JSON.stringify(users));
            
            // Automatically update GitHub
            await updateUsersOnGitHub();
            
            displayUsers();
            clearContractForm();
        }

        // Send job acceptance email
        async function sendJobAcceptanceEmail(userName, userData) {
            try {
                // Generate contract ID for tracking
                const contractId = 'CF-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
                
                // Prepare email parameters
                const emailParams = {
                    to_email: userData.profile.email,
                    freelancer_name: userName || 'User',
                    role: userData.profile.role || 'Contractor',
                    location: userData.profile.location || 'Atlanta Area',
                    rate: userData.profile.rate || 'Rate to be determined',
                    project_start: userData.profile.projectStart || 'TBD',
                    contract_id: contractId
                };

                console.log('📧 Sending job acceptance email to:', userData.profile.email);

                // Send email using EmailJS
                if (typeof emailjs !== 'undefined') {
                    await emailjs.send(
                        EMAILJS_CONFIG.serviceId, 
                        EMAILJS_CONFIG.jobAcceptanceTemplateId, 
                        emailParams
                    );
                    
                    console.log('✅ Job acceptance email sent successfully');
                    
                    // Show success message
                    setTimeout(() => {
                        showNotification(`🎉 User approved and email sent!\n\n📧 Email sent to: ${userData.profile.email}\n📄 Contract ID: ${contractId}\n\n✅ The user will receive the job acceptance email with contract signing instructions.`, 'success');
                    }, 1000);
                    
                } else {
                    console.warn('⚠️ EmailJS not available, skipping email send');
                    showNotification('✅ User saved successfully!\n\n⚠️ EmailJS not configured - please set up EmailJS to send automatic job acceptance emails.', 'warning');
                }
                
            } catch (error) {
                console.error('❌ Error sending job acceptance email:', error);
                showNotification('✅ User saved successfully!\n\n⚠️ Email sending failed. Please check EmailJS configuration.', 'warning');
            }
        }

        // Approve existing user (for users already in the system)
        async function approveUser(userName) {
            const userData = users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }
            
            if (confirm(`Are you sure you want to approve ${userName}?\n\nThis will send them a job acceptance email with contract signing instructions.`)) {
                // Update approval date if not set
                if (!userData.profile.approvedDate) {
                    userData.profile.approvedDate = new Date().toISOString().split('T')[0];
                }
                
                // Send job acceptance email
                sendJobAcceptanceEmail(userName, userData);
                
                // Save updated user data
                localStorage.setItem('users', JSON.stringify(users));
                await updateUsersOnGitHub();
                displayUsers();
                
                showNotification(`✅ ${userName} approved successfully!`, 'success');
            }
        }

        // Approve existing freelancer (for freelancers already in the system) - LEGACY
        function approveFreelancer(index) {
            const freelancer = freelancers[index];
            
            if (confirm(`Are you sure you want to approve ${freelancer.name}?\n\nThis will send them a job acceptance email with contract signing instructions.`)) {
                // Update approval date if not set
                if (!freelancer.approvedDate) {
                    freelancer.approvedDate = new Date().toISOString().split('T')[0];
                }
                
                // Send job acceptance email
                sendJobAcceptanceEmail(freelancer);
                
                // Save updated freelancer data
                localStorage.setItem('freelancers', JSON.stringify(freelancers));
                displayFreelancers();
            }
        }

        // Edit freelancer
        function editFreelancer(index) {
            const freelancer = freelancers[index];
            document.getElementById('freelancerName').value = freelancer.name;
            document.getElementById('freelancerEmail').value = freelancer.email;
            document.getElementById('freelancerPassword').value = freelancer.password || 'Password will be set during contract signing';
            document.getElementById('freelancerRole').value = freelancer.role;
            document.getElementById('freelancerLocation').value = freelancer.location;
            document.getElementById('projectStart').value = freelancer.projectStart;
            document.getElementById('freelancerRate').value = freelancer.rate;
            document.getElementById('approvedDate').value = freelancer.approvedDate;
            editingFreelancerIndex = index;
        }

        // Delete freelancer
        async function deleteFreelancer(index) {
            const freelancer = freelancers[index];
            if (confirm(`Are you sure you want to delete "${freelancer.name}"?`)) {
                try {
                    // Remove freelancer from freelancers array
                    freelancers.splice(index, 1);
                    localStorage.setItem('freelancers', JSON.stringify(freelancers));
                    
                    // Update freelancers.json on GitHub
                    await updateFreelancersOnGitHub();
                    
                    displayFreelancers();
                    showNotification('Freelancer deleted successfully and freelancers.json updated on GitHub!', 'success');
                } catch (error) {
                    console.error('❌ Error deleting freelancer:', error);
                    showNotification(`Error deleting freelancer: ${error.message}. The freelancer was removed locally but the GitHub update failed.`, 'error');
                    displayFreelancers(); // Still update the display
                }
            }
        }

        // Manual refresh function
        async function refreshFreelancers() {
            console.log('🔄 Manually refreshing freelancers...');
            
            // Clear any cached data
            localStorage.removeItem('freelancers');
            
            // Clear browser cache for freelancers.json
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        const cache = await caches.open(cacheName);
                        await cache.delete('freelancers.json');
                    }
                    console.log('🗑️ Cleared browser cache for freelancers.json');
                } catch (error) {
                    console.warn('⚠️ Could not clear cache:', error);
                }
            }
            
            await loadUsers();
        }

        // Clear contract form
        function clearContractForm() {
            document.getElementById('contractForm').reset();
            document.getElementById('freelancerLocation').value = 'Atlanta Area';
            document.getElementById('projectStart').value = 'TBD';
            document.getElementById('contractUrl').value = 'contract.html';
            document.getElementById('freelancerPassword').value = '';
            editingFreelancerIndex = -1;
        }





        // ==================== JOB ASSIGNMENT FUNCTIONALITY ====================

        // Populate freelancer dropdown for job assignment
        function populateJobAssignmentDropdown() {
            const select = document.getElementById('jobAssignmentFreelancer');
            if (!select) return;
            
            select.innerHTML = '<option value="">Choose a freelancer...</option>';
            freelancers.forEach((freelancer, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = freelancer.name;
                select.appendChild(option);
            });
        }

        // Handle freelancer selection for job assignment
        function handleFreelancerSelection() {
            const select = document.getElementById('jobAssignmentFreelancer');
            const jobInfo = document.getElementById('freelancerJobInfo');
            const currentJobsList = document.getElementById('currentJobsList');
            
            if (!select || !jobInfo || !currentJobsList) return;
            
            const selectedIndex = select.value;
            if (selectedIndex === '') {
                jobInfo.style.display = 'none';
                return;
            }
            
            const freelancer = freelancers[selectedIndex];
            jobInfo.style.display = 'block';
            
            if (freelancer.jobs && freelancer.jobs.length > 0) {
                const jobsHTML = freelancer.jobs.map((job, jobIndex) => `
                    <div style="background: rgba(0,0,0,0.3); padding: 0.75rem; border-radius: 6px; margin-bottom: 0.5rem; border: 1px solid rgba(255,178,0,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <strong style="color: #FFB200;">${job.id}</strong>
                            ${job.id === freelancer.primaryJob ? '<span style="background: #22c55e; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Primary</span>' : ''}
                        </div>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                            <div>🎯 ${job.role || 'No role'}</div>
                            <div>📍 ${job.location || 'No location'}</div>
                            <div>💰 ${job.rate || 'No rate'}</div>
                            <div>📅 ${job.projectStart || 'No date'}</div>
                            <div>📊 ${job.status || 'No status'}</div>
                        </div>
                        <button onclick="removeJobFromFreelancer(${selectedIndex}, ${jobIndex})" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; margin-top: 0.5rem;">Remove</button>
                    </div>
                `).join('');
                currentJobsList.innerHTML = jobsHTML;
            } else {
                currentJobsList.innerHTML = '<p style="color: rgba(255,255,255,0.6); font-style: italic;">No jobs assigned yet</p>';
            }
        }

        // Add job to freelancer
        function addJobToFreelancer() {
            const freelancerIndex = document.getElementById('jobAssignmentFreelancer').value;
            if (freelancerIndex === '') {
                showNotification('Please select a freelancer first.', 'warning');
                return;
            }
            
            // Format the project start date for better display
            const projectStartInput = document.getElementById('assignmentJobProjectStart').value;
            let formattedProjectStart = projectStartInput;
            if (projectStartInput) {
                try {
                    const date = new Date(projectStartInput);
                    formattedProjectStart = date.toLocaleString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    // If date parsing fails, use the original value
                    formattedProjectStart = projectStartInput;
                }
            }
            
            const jobData = {
                id: document.getElementById('jobId').value,
                role: document.getElementById('jobRole').value,
                location: document.getElementById('assignmentJobLocation').value,
                projectStart: formattedProjectStart,
                rate: document.getElementById('assignmentJobRate').value,
                status: document.getElementById('assignmentJobStatus').value,
                projectType: document.getElementById('assignmentJobProjectType').value,
                description: document.getElementById('assignmentJobDescription').value
            };
            
            if (!jobData.id.trim()) {
                showNotification('Job ID is required.', 'error');
                return;
            }
            
            const freelancer = freelancers[freelancerIndex];
            if (!freelancer.jobs) {
                freelancer.jobs = [];
            }
            
            // Check if job ID already exists
            const existingJobIndex = freelancer.jobs.findIndex(job => job.id === jobData.id);
            if (existingJobIndex >= 0) {
                if (confirm('A job with this ID already exists. Do you want to replace it?')) {
                    freelancer.jobs[existingJobIndex] = jobData;
                } else {
                    return;
                }
            } else {
                freelancer.jobs.push(jobData);
            }
            
            // Set as primary job if checkbox is checked
            if (document.getElementById('primaryJobCheckbox').checked) {
                freelancer.primaryJob = jobData.id;
            }
            
            // Save to localStorage
            localStorage.setItem('freelancers', JSON.stringify(freelancers));
            
            // Refresh displays
            displayFreelancers();
            handleFreelancerSelection();
            
            // Clear form
            document.getElementById('jobAssignmentForm').reset();
            
            showNotification(`✅ Job "${jobData.id}" added to ${freelancer.name}!`, 'success');
        }

        // Remove job from freelancer
        function removeJobFromFreelancer(freelancerIndex, jobIndex) {
            const freelancer = freelancers[freelancerIndex];
            const job = freelancer.jobs[jobIndex];
            
            if (confirm(`Are you sure you want to remove job "${job.id}" from ${freelancer.name}?`)) {
                freelancer.jobs.splice(jobIndex, 1);
                
                // If this was the primary job, clear it
                if (freelancer.primaryJob === job.id) {
                    freelancer.primaryJob = null;
                }
                
                // Save to localStorage
                localStorage.setItem('freelancers', JSON.stringify(freelancers));
                
                // Refresh displays
                displayFreelancers();
                handleFreelancerSelection();
                
                showNotification(`✅ Job "${job.id}" removed from ${freelancer.name}!`, 'success');
            }
        }

        // Initialize job assignment functionality
        document.addEventListener('DOMContentLoaded', function() {
            const jobAssignmentForm = document.getElementById('jobAssignmentForm');
            const freelancerSelect = document.getElementById('jobAssignmentFreelancer');
            
            if (jobAssignmentForm) {
                jobAssignmentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    addJobToFreelancer();
                });
            }
            
            if (freelancerSelect) {
                freelancerSelect.addEventListener('change', handleFreelancerSelection);
            }
        });



        // ==================== QUICK IMPORT FROM EMAIL ====================

        // Parse email data and auto-fill form
        function parseEmailData() {
            const emailText = document.getElementById('quickImportData').value;
            if (!emailText.trim()) {
                showNotification('Please paste the contract data from your email first.', 'warning');
                return;
            }

            // Try to extract contract information using regex patterns
            const extractData = (text) => {
                const patterns = {
                    freelancer_name: /(?:Freelancer|Name):\s*([^\n\r]+)/i,
                    freelancer_email: /(?:Email):\s*([^\n\r\s]+)/i,
                    role: /(?:Role):\s*([^\n\r]+)/i,
                    location: /(?:Location):\s*([^\n\r]+)/i,
                    rate: /(?:Rate):\s*([^\n\r]+)/i,
                    contract_id: /(?:Contract ID):\s*([^\n\r]+)/i,
                    signed_date: /(?:Signed):\s*([^\n\r]+)/i
                };

                const extracted = {};
                for (const [key, pattern] of Object.entries(patterns)) {
                    const match = text.match(pattern);
                    if (match) {
                        extracted[key] = match[1].trim();
                    }
                }
                return extracted;
            };

            const data = extractData(emailText);
            
            // Auto-fill the upload form fields
            if (data.freelancer_name) {
                document.getElementById('uploadFreelancerName').value = data.freelancer_name;
            }
            if (data.freelancer_email) {
                document.getElementById('uploadFreelancerEmail').value = data.freelancer_email;
            }
            if (data.role) {
                document.getElementById('uploadRole').value = data.role;
            }
            if (data.location) {
                document.getElementById('uploadLocation').value = data.location;
            }
            if (data.rate) {
                document.getElementById('uploadRate').value = data.rate;
            }
            if (data.signed_date) {
                // Try to parse and format the date
                try {
                    const date = new Date(data.signed_date);
                    if (!isNaN(date.getTime())) {
                        document.getElementById('uploadDate').value = date.toISOString().split('T')[0];
                    }
                } catch (e) {
                    // If date parsing fails, just use today's date
                    document.getElementById('uploadDate').value = new Date().toISOString().split('T')[0];
                }
            }
            
            // Add contract ID to notes if available
            if (data.contract_id) {
                const notesField = document.getElementById('uploadNotes');
                notesField.value = `Contract ID: ${data.contract_id}\n${notesField.value}`.trim();
            }

            // Clear the import text area
            document.getElementById('quickImportData').value = '';
            
            // Show success message
            const filledFields = Object.values(data).filter(v => v).length;
            if (filledFields > 0) {
                showNotification(`✅ Auto-filled ${filledFields} fields! Now upload your PDF file.`, 'success');
                
                // Scroll to the form
                document.getElementById('contractDetailsForm').style.display = 'block';
                document.getElementById('contractDetailsForm').scrollIntoView({ behavior: 'smooth' });
            } else {
                showNotification('❌ Could not extract contract data. Please check the format and try again.', 'error');
            }
        }




        


        // Show update status message
        function showUpdateStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                background: ${type === 'success' ? 'linear-gradient(135deg, #22c55e, #16a34a)' : 'linear-gradient(135deg, #ef4444, #dc2626)'};
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            statusDiv.textContent = message;
            
            document.body.appendChild(statusDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        }











        // ==================== PROJECT STATUS MANAGEMENT ====================
        
        // Load performance reviews from JSON file with fallbacks
        async function loadPerformanceReviews() {
            try {
                console.log('🔄 Loading performance reviews...');
                console.log('🔍 Current performanceReviews object:', performanceReviews);
                
                // Try API endpoint first
                try {
                    const apiResponse = await fetch('/api/performance');
                    if (apiResponse.ok) {
                        const apiData = await apiResponse.json();
                        performanceReviews = apiData.performanceReviews || {};
                        console.log('✅ Performance reviews loaded from API:', Object.keys(performanceReviews).length, 'reviews');
                        return;
                    }
                } catch (apiError) {
                    console.warn('⚠️ API endpoint failed, trying direct JSON file...');
                }
                
                // Try direct JSON file
                const response = await fetch('performance.json');
                if (response.ok) {
                    const jsonData = await response.json();
                    performanceReviews = jsonData.performanceReviews || {};
                    console.log('✅ Performance reviews loaded from JSON file:', Object.keys(performanceReviews).length, 'reviews');
                } else {
                    console.warn('⚠️ Could not load performance.json, trying embedded data...');
                    // Try embedded data as fallback
                    if (window.performanceData && window.performanceData.performanceReviews) {
                        performanceReviews = window.performanceData.performanceReviews;
                        console.log('✅ Performance reviews loaded from embedded data:', Object.keys(performanceReviews).length, 'reviews');
                    } else {
                        console.warn('⚠️ No fallback data available, using empty object');
                        performanceReviews = {};
                    }
                }
            } catch (error) {
                console.error('❌ Error loading performance reviews:', error);
                // Try embedded data as final fallback
                if (window.performanceData && window.performanceData.performanceReviews) {
                    performanceReviews = window.performanceData.performanceReviews;
                    console.log('✅ Performance reviews loaded from embedded data:', Object.keys(performanceReviews).length, 'reviews');
                } else {
                    performanceReviews = {};
                }
            }
        }



        // Load project status from users data (no longer needed as separate file)
        async function loadProjectStatus() {
            // Project status is now part of the users data structure
            console.log('✅ Project status loaded from users data');
        }
        

        
        // Update project status for a specific job
        async function updateProjectStatus(userName, jobId, newStatus, paymentStatus = null) {
            if (!users[userName]) {
                users[userName] = {
                    profile: {},
                    contract: {},
                    jobs: {},
                    paymentMethod: null
                };
            }
            
            if (!users[userName].jobs) {
                users[userName].jobs = {};
            }
            
            if (!users[userName].jobs[jobId]) {
                // Create job entry if it doesn't exist
                const userData = users[userName];
                if (userData) {
                    // Create a job from user's primary data
                    const job = {
                        id: jobId,
                        role: userData.profile?.role || 'General',
                        location: userData.profile?.location || 'Not specified',
                        projectStart: userData.profile?.projectStart || 'Not specified',
                        rate: userData.profile?.rate || 'Not specified',
                        projectType: (userData.profile?.role || 'General') + ' Project',
                        description: `Primary assignment for ${userName}`
                    };
                    
                    users[userName].jobs[jobId] = {
                        id: job.id,
                        role: job.role,
                        location: job.location,
                        projectStart: job.projectStart,
                        rate: job.rate,
                        projectStatus: newStatus,
                        paymentStatus: paymentStatus || 'pending',
                        completionDate: newStatus === 'completed' ? new Date().toISOString().split('T')[0] : null,
                        paymentDate: paymentStatus === 'paid' ? new Date().toISOString().split('T')[0] : null,
                        projectType: job.projectType || 'General',
                        description: job.description || ''
                    };
                }
            } else {
                // Update existing job
                users[userName].jobs[jobId].projectStatus = newStatus;
                if (paymentStatus) {
                    users[userName].jobs[jobId].paymentStatus = paymentStatus;
                }
                
                if (newStatus === 'completed') {
                    users[userName].jobs[jobId].completionDate = new Date().toISOString().split('T')[0];
                }
                
                if (paymentStatus === 'paid') {
                    users[userName].jobs[jobId].paymentDate = new Date().toISOString().split('T')[0];
                }
            }
            
            // Save to localStorage
            localStorage.setItem('users', JSON.stringify(users));
            
            // Update GitHub
            await updateUsersOnGitHub();
            
            console.log(`✅ Updated project status for ${userName} - ${jobId}: ${newStatus}`);
            showNotification(`✅ Project status updated for ${userName} - ${jobId}: ${newStatus}`, 'success');
        }

        // ==================== JOB ASSIGNMENT & PAYMENT MANAGEMENT ====================
        
        // Show performance review modal (works with both username and email)
        function showPerformanceReviewModal(userNameOrEmail) {
            let userData = users[userNameOrEmail];
            let userEmail = userNameOrEmail;
            let userName = userNameOrEmail;
            
            // If not found by username, try to find by email
            if (!userData) {
                // Search for user by email
                for (const [name, data] of Object.entries(users)) {
                    if (data.profile?.email === userNameOrEmail) {
                        userData = data;
                        userName = name;
                        break;
                    }
                }
            } else {
                // If found by username, get the email
                userEmail = userData.profile?.email || userNameOrEmail;
            }
            
            // If still no user data, try to get review directly by email
            const existingReview = userData ? performanceReviews[userData.profile?.email] : performanceReviews[userNameOrEmail];
            const reviewDate = new Date().toISOString().split('T')[0];
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-star"></i> Performance Review for ${userName || userEmail}</h2>
                        <button onclick="closeModal(this)" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">×</button>
                    </div>
                    
                    ${existingReview ? `
                    <div style="background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid rgba(255,178,0,0.3);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Existing Review</h4>
                        <div style="color: rgba(255,255,255,0.9);">
                            <div><strong>Date:</strong> ${existingReview.reviewDate || reviewDate}</div>
                            <div><strong>Overall Rating:</strong> ${existingReview.overallRating || 'N/A'}/5</div>
                            <div><strong>Status:</strong> ${existingReview.status || 'completed'}</div>
                            ${existingReview.comments ? `<div><strong>Comments:</strong> ${existingReview.comments}</div>` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    <form id="performanceReviewForm">
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Category Ratings</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                ${['Professionalism', 'Quality', 'Communication', 'Reliability', 'Overall Performance'].map(category => `
                                    <div>
                                        <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">${category}:</label>
                                        <select name="${category.toLowerCase().replace(' ', '_')}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                            <option value="">Select rating</option>
                                            <option value="1" ${existingReview?.categories?.[category] === 1 ? 'selected' : ''}>1 - Poor</option>
                                            <option value="2" ${existingReview?.categories?.[category] === 2 ? 'selected' : ''}>2 - Below Average</option>
                                            <option value="3" ${existingReview?.categories?.[category] === 3 ? 'selected' : ''}>3 - Average</option>
                                            <option value="4" ${existingReview?.categories?.[category] === 4 ? 'selected' : ''}>4 - Good</option>
                                            <option value="5" ${existingReview?.categories?.[category] === 5 ? 'selected' : ''}>5 - Excellent</option>
                                        </select>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Overall Rating</h3>
                            <select name="overall_rating" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                <option value="">Select overall rating</option>
                                <option value="1" ${existingReview?.overallRating === 1 ? 'selected' : ''}>1 - Poor</option>
                                <option value="2" ${existingReview?.overallRating === 2 ? 'selected' : ''}>2 - Below Average</option>
                                <option value="3" ${existingReview?.overallRating === 3 ? 'selected' : ''}>3 - Average</option>
                                <option value="4" ${existingReview?.overallRating === 4 ? 'selected' : ''}>4 - Good</option>
                                <option value="5" ${existingReview?.overallRating === 5 ? 'selected' : ''}>5 - Excellent</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Comments</h3>
                            <textarea name="comments" rows="4" placeholder="Provide detailed feedback about the freelancer's performance..." style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; resize: vertical;">${existingReview?.comments || ''}</textarea>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Admin Notes (Internal)</h3>
                            <textarea name="admin_notes" rows="3" placeholder="Internal notes for admin reference (not visible to freelancer)..." style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; resize: vertical;">${existingReview?.adminNotes || ''}</textarea>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #FFB200; margin-bottom: 1rem;">Status</h3>
                            <select name="status" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                <option value="completed" ${existingReview?.status === 'completed' ? 'selected' : ''}>Completed</option>
                                <option value="pending" ${existingReview?.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="overdue" ${existingReview?.status === 'overdue' ? 'selected' : ''}>Overdue</option>
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" onclick="closeModal(this)" 
                                    style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                Cancel
                            </button>
                            <button type="submit" 
                                    style="background: #FFB200; color: #000; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ${existingReview ? 'Update Review' : 'Save Review'}
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            const form = modal.querySelector('#performanceReviewForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                savePerformanceReview(userData.profile?.email, form);
            });
        }

        // Save performance review
        function savePerformanceReview(userEmail, form) {
            const formData = new FormData(form);
            const categories = {};
            
            // Collect category ratings
            ['professionalism', 'quality', 'communication', 'reliability', 'overall_performance'].forEach(category => {
                const value = formData.get(category);
                if (value) {
                    const categoryName = category.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
                    categories[categoryName] = parseInt(value);
                }
            });
            
            const reviewData = {
                userEmail: userEmail,
                reviewDate: new Date().toISOString().split('T')[0],
                overallRating: parseInt(formData.get('overall_rating')) || 0,
                categories: categories,
                comments: formData.get('comments') || '',
                adminNotes: formData.get('admin_notes') || '',
                status: formData.get('status') || 'completed',
                reviewedBy: 'admin',
                lastUpdated: new Date().toISOString()
            };
            
            // Save to performance reviews
            performanceReviews[userEmail] = reviewData;
            
            // Update GitHub
            updatePerformanceReviewsOnGitHub();
            
            // Close modal
            closeModal(form);
            
            // Refresh display
            displayUsers();
            
            // Show notification
            notifyJSONUpdate('performance.json', 'created', `for ${userEmail}`);
            
            console.log('✅ Performance review saved for:', userEmail);
        }

        // Show job assignment modal
        function showJobAssignmentModal(userName) {
            const userData = users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }

            // Get available jobs from jobs-data.json
            const availableJobs = jobs.filter(job => !userData.jobs || !Object.values(userData.jobs).some(userJob => userJob.id === job.id));
            
            let jobsHTML = '';
            if (availableJobs.length > 0) {
                jobsHTML = availableJobs.map(job => `
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.2);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">${job.title}</h4>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 0.5rem;">${job.location}</p>
                        <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">${job.eventDate}</p>
                        <button onclick="assignJobToUser('${userName}', '${job.id}')" 
                                style="background: #22c55e; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Assign Job
                        </button>
                    </div>
                `).join('');
            } else {
                jobsHTML = '<p style="color: rgba(255,255,255,0.7);">No available jobs to assign.</p>';
            }

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 2rem; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,178,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="color: #FFB200; margin: 0;"><i class="fas fa-briefcase"></i> Assign Jobs to ${userName}</h2>
                        <button onclick="closeModal(this)" 
                                style="background: none; border: none; color: #FFB200; font-size: 1.5rem; cursor: pointer;">×</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">Available Jobs:</h3>
                        ${jobsHTML}
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">Available Jobs:</h3>
                        ${jobsHTML}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Assign job to user
        function assignJobToUser(userName, jobId) {
            const userData = users[userName];
            const job = jobs.find(j => j.id === jobId);
            
            if (!userData || !job) {
                showNotification('User or job not found', 'error');
                return;
            }

            // Add job to freelancer's jobs array
            if (!freelancer.jobs) {
                freelancer.jobs = [];
            }
            
            const newJob = {
                id: job.id,
                role: job.title,
                location: job.location,
                projectStart: job.eventDate,
                rate: job.rate || '$TBD',
                projectType: job.title,
                description: job.description || `Assigned job: ${job.title}`,
                status: 'upcoming'
            };
            
            freelancer.jobs.push(newJob);
            
            // Update project status
            if (!projectStatus[freelancerName]) {
                projectStatus[freelancerName] = { jobs: {} };
            }
            
            projectStatus[freelancerName].jobs[jobId] = {
                id: job.id,
                role: job.title,
                location: job.location,
                projectStart: job.eventDate,
                rate: job.rate || '$TBD',
                projectStatus: 'upcoming',
                paymentStatus: 'pending',
                projectType: job.title,
                description: job.description || `Assigned job: ${job.title}`
            };
            
            // Update GitHub
            updateFreelancersOnGitHub();
            updateProjectStatusOnGitHub();
            
            showNotification(`✅ Job "${job.title}" assigned to ${freelancerName} successfully!`, 'success');
            
            // Close modal
            document.querySelector('div[style*="position: fixed"]').remove();
        }

        // Update payment settings
        async function updatePaymentSettings(userName) {
            console.log('🔍 Debugging updatePaymentSettings:');
            console.log('User name:', userName);
            console.log('Available users:', Object.keys(users));
            console.log('User data:', users[userName]);
            
            const userData = users[userName];
            if (!userData) {
                console.error('❌ User not found:', userName);
                showNotification('User not found', 'error');
                return;
            }
            
            const paymentStatus = document.getElementById(`paymentStatus_${userName}`).value;
            
            // Use the enhanced payment status update function
            await updatePaymentStatusWithPerformanceReview(userName, paymentStatus);
        }
        
        // Show project status manager modal
        function showProjectStatusManager(userName) {
            const userData = users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }
            
            // Get jobs from the new users structure
            let jobs = [];
            if (userData.jobs && Object.keys(userData.jobs).length > 0) {
                jobs = Object.values(userData.jobs);
            } else {
                // If no jobs, create a default job from user data
                const defaultJobId = `job-${userName.toLowerCase().replace(/\s+/g, '-')}-default`;
                const defaultJob = {
                    id: defaultJobId,
                    role: userData.profile?.role || 'No role',
                    location: userData.profile?.location || 'No location',
                    projectStart: userData.profile?.projectStart || 'Not set',
                    rate: userData.profile?.rate || 'No rate',
                    projectStatus: 'upcoming',
                    paymentStatus: 'pending',
                    projectType: (userData.profile?.role || 'No role') + ' Project',
                    description: `Primary assignment for ${userName}`
                };
                
                // Add to user's jobs
                if (!userData.jobs) {
                    userData.jobs = {};
                }
                userData.jobs[defaultJobId] = defaultJob;
                jobs = [defaultJob];
                
                console.log(`📋 Created default job for ${userName}:`, defaultJob);
            }
            
            let jobsHTML = '';
            if (jobs.length > 0) {
                jobsHTML = jobs.map(job => `
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.2);">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">${job.role}</h4>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">${job.description || 'No description'}</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Project Status:</label>
                                <select id="projectStatus_${job.id}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                    <option value="upcoming" ${job.projectStatus === 'upcoming' ? 'selected' : ''}>Upcoming</option>
                                    <option value="in-progress" ${job.projectStatus === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                    <option value="completed" ${job.projectStatus === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="cancelled" ${job.projectStatus === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                </select>
                            </div>
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Payment Status:</label>
                                <select id="paymentStatus_${job.id}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px;">
                                    <option value="pending" ${job.paymentStatus === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="processing" ${job.paymentStatus === 'processing' ? 'selected' : ''}>Processing</option>
                                    <option value="paid" ${job.paymentStatus === 'paid' ? 'selected' : ''}>Paid</option>
                                    <option value="overdue" ${job.paymentStatus === 'overdue' ? 'selected' : ''}>Overdue</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="updateJobStatus('${userName}', '${job.id}')" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                            Update Status
                        </button>
                    </div>
                `).join('');
            } else {
                jobsHTML = '<p style="color: rgba(255,255,255,0.6); font-style: italic;">No jobs found for this freelancer.</p>';
            }
            
            const modal = document.createElement('div');
            modal.id = 'projectStatusModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #1a1a1a;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                ">
                    <button onclick="closeProjectStatusManager()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                            ">×</button>
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">📊 Project Status Manager</h3>
                    <h4 style="color: white; margin-bottom: 1rem;">${userName}</h4>
                    ${jobsHTML}
                    
                    <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">Payment Method Setup:</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Payment Method:</label>
                                <input type="text" id="paymentMethod_${userName}" value="${userData?.paymentMethod ? userData.paymentMethod.charAt(0).toUpperCase() + userData.paymentMethod.slice(1) : 'Not Set'}" readonly style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.3); border: 1px solid #FFB200; color: white; border-radius: 4px; cursor: not-allowed;">
                            </div>
                            <div>
                                <label style="color: #FFB200; font-weight: bold;">Payment Status:</label>
                                <input type="text" id="userPaymentStatus_${userName}" value="${userData?.paymentStatus ? userData.paymentStatus.charAt(0).toUpperCase() + userData.paymentStatus.slice(1) : 'Pending'}" readonly style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.3); border: 1px solid #FFB200; color: white; border-radius: 4px; cursor: not-allowed;">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add click outside to close
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeProjectStatusManager();
                }
            });
            
            // Add escape key to close
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeProjectStatusManager();
                }
            });
        }
        
        // Close project status manager modal
        function closeProjectStatusManager() {
            const modal = document.getElementById('projectStatusModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Performance Review Management System
        async function showPerformanceReviewManager() {
            // Load performance reviews first
            await loadPerformanceReviews();
            const modal = document.createElement('div');
            modal.id = 'performanceReviewModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            // Get all performance reviews
            const reviews = performanceReviews || {};
            const reviewsList = Object.entries(reviews).map(([email, review]) => `
                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid rgba(255,178,0,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <h4 style="color: #FFB200; margin: 0;">${email}</h4>
                        <span style="background: ${review.status === 'completed' ? '#22c55e' : '#f59e0b'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">
                            ${review.status === 'completed' ? '✅ Completed' : '⏳ Pending'}
                        </span>
                    </div>
                    <div style="font-size: 0.85rem; color: rgba(255,255,255,0.8); margin-bottom: 0.5rem;">
                        <strong>Overall Rating:</strong> ${review.overallRating}/5 | <strong>Date:</strong> ${review.reviewDate}
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="editPerformanceReview('${email}')" style="background: #3b82f6; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">
                            ✏️ Edit
                        </button>
                        <button onclick="deletePerformanceReview('${email}')" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">
                            🗑️ Delete
                        </button>
                        <button onclick="viewPerformanceReview('${email}')" style="background: #22c55e; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.8rem; cursor: pointer;">
                            👁️ View
                        </button>
                    </div>
                </div>
            `).join('');
            
            modal.innerHTML = `
                <div style="
                    background: #1a1a1a;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 800px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                ">
                    <button onclick="closePerformanceReviewManager()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                            ">×</button>
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">⭐ Performance Review Manager</h3>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 1.5rem;">Manage all performance reviews in the system</p>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <button onclick="createNewPerformanceReview()" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ➕ Create New Review
                        </button>
                    </div>
                    
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${reviewsList || '<p style="color: rgba(255,255,255,0.6); font-style: italic;">No performance reviews found.</p>'}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add click outside to close
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closePerformanceReviewManager();
                }
            });
            
            // Add escape key to close
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closePerformanceReviewManager();
                }
            });
        }
        
        function closePerformanceReviewManager() {
            const modal = document.getElementById('performanceReviewModal');
            if (modal) {
                modal.remove();
            }
        }
        

        

        
        // Create new performance review
        function createNewPerformanceReview() {
            const modal = document.createElement('div');
            modal.id = 'createReviewModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #1a1a1a;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                ">
                    <button onclick="closeCreateReviewModal()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                            ">×</button>
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">➕ Create New Performance Review</h3>
                    
                    <form id="createReviewForm">
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">User Email:</label>
                            <input type="email" id="reviewUserEmail" required style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Overall Rating:</label>
                            <select id="reviewOverallRating" required style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                <option value="">Select Rating</option>
                                <option value="1">1 - Poor</option>
                                <option value="2">2 - Below Average</option>
                                <option value="3">3 - Average</option>
                                <option value="4">4 - Good</option>
                                <option value="5">5 - Excellent</option>
                                </select>
                            </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Category Ratings:</label>
                            <div id="categoryRatings">
                                <div style="margin-bottom: 0.5rem;">
                                    <label style="color: white; font-size: 0.9rem;">Professionalism:</label>
                                    <select class="category-rating" data-category="Professionalism" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; margin-top: 0.25rem;">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                        </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <label style="color: white; font-size: 0.9rem;">Quality:</label>
                                    <select class="category-rating" data-category="Quality" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; margin-top: 0.25rem;">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <label style="color: white; font-size: 0.9rem;">Communication:</label>
                                    <select class="category-rating" data-category="Communication" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; margin-top: 0.25rem;">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <label style="color: white; font-size: 0.9rem;">Reliability:</label>
                                    <select class="category-rating" data-category="Reliability" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; margin-top: 0.25rem;">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 0.5rem;">
                                    <label style="color: white; font-size: 0.9rem;">Overall Performance:</label>
                                    <select class="category-rating" data-category="Overall Performance" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; margin-top: 0.25rem;">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Comments:</label>
                            <textarea id="reviewComments" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px; resize: vertical;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Admin Notes:</label>
                            <textarea id="reviewAdminNotes" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px; resize: vertical;"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                ✅ Create Review
                            </button>
                            <button type="button" onclick="closeCreateReviewModal()" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                Cancel
                        </button>
                    </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('createReviewForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const userEmail = document.getElementById('reviewUserEmail').value;
                const overallRating = document.getElementById('reviewOverallRating').value;
                const comments = document.getElementById('reviewComments').value;
                const adminNotes = document.getElementById('reviewAdminNotes').value;
                
                // Get category ratings
                const categories = {};
                document.querySelectorAll('.category-rating').forEach(select => {
                    const category = select.dataset.category;
                    const rating = parseInt(select.value);
                    categories[category] = rating;
                });
                
                try {
                    const response = await fetch('/api/performance', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_TOKEN}`
                        },
                        body: JSON.stringify({
                            userEmail,
                            overallRating,
                            categories,
                            comments,
                            adminNotes
                        })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        showNotification('Performance review created successfully!', 'success');
                        closeCreateReviewModal();
                        // Refresh the performance reviews
                        await loadPerformanceReviews();
                        showPerformanceReviewManager();
                    } else {
                        const error = await response.json();
                        showNotification(`Error: ${error.error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error creating performance review:', error);
                    showNotification('Failed to create performance review', 'error');
                }
            });
        }
        
        function closeCreateReviewModal() {
            const modal = document.getElementById('createReviewModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Edit performance review
        function editPerformanceReview(email) {
            const review = performanceReviews[email];
            if (!review) {
                showNotification('Performance review not found', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'editReviewModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #1a1a1a;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                ">
                    <button onclick="closeEditReviewModal()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                            ">×</button>
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">✏️ Edit Performance Review</h3>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">Editing review for: ${email}</p>
                    
                    <form id="editReviewForm">
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Overall Rating:</label>
                            <select id="editOverallRating" required style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                <option value="1" ${review.overallRating === 1 ? 'selected' : ''}>1 - Poor</option>
                                <option value="2" ${review.overallRating === 2 ? 'selected' : ''}>2 - Below Average</option>
                                <option value="3" ${review.overallRating === 3 ? 'selected' : ''}>3 - Average</option>
                                <option value="4" ${review.overallRating === 4 ? 'selected' : ''}>4 - Good</option>
                                <option value="5" ${review.overallRating === 5 ? 'selected' : ''}>5 - Excellent</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Category Ratings:</label>
                            <div id="editCategoryRatings">
                                ${Object.entries(review.categories || {}).map(([category, rating]) => `
                                    <div style="margin-bottom: 0.5rem;">
                                        <label style="color: white; font-size: 0.9rem;">${category}:</label>
                                        <select class="edit-category-rating" data-category="${category}" style="width: 100%; padding: 0.5rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 4px; margin-top: 0.25rem;">
                                            <option value="1" ${rating === 1 ? 'selected' : ''}>1</option>
                                            <option value="2" ${rating === 2 ? 'selected' : ''}>2</option>
                                            <option value="3" ${rating === 3 ? 'selected' : ''}>3</option>
                                            <option value="4" ${rating === 4 ? 'selected' : ''}>4</option>
                                            <option value="5" ${rating === 5 ? 'selected' : ''}>5</option>
                                        </select>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Comments:</label>
                            <textarea id="editComments" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px; resize: vertical;">${review.comments || ''}</textarea>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: #FFB200; font-weight: bold; display: block; margin-bottom: 0.5rem;">Admin Notes:</label>
                            <textarea id="editAdminNotes" rows="3" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px; resize: vertical;">${review.adminNotes || ''}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                💾 Update Review
                            </button>
                            <button type="button" onclick="closeEditReviewModal()" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('editReviewForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const overallRating = document.getElementById('editOverallRating').value;
                const comments = document.getElementById('editComments').value;
                const adminNotes = document.getElementById('editAdminNotes').value;
                
                // Get category ratings
                const categories = {};
                document.querySelectorAll('.edit-category-rating').forEach(select => {
                    const category = select.dataset.category;
                    const rating = parseInt(select.value);
                    categories[category] = rating;
                });
                
                try {
                    const response = await fetch(`/api/performance/${email}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_TOKEN}`
                        },
                        body: JSON.stringify({
                            overallRating,
                            categories,
                            comments,
                            adminNotes
                        })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        showNotification('Performance review updated successfully!', 'success');
                        closeEditReviewModal();
                        // Refresh the performance reviews
                        await loadPerformanceReviews();
                        showPerformanceReviewManager();
                    } else {
                        const error = await response.json();
                        showNotification(`Error: ${error.error}`, 'error');
                    }
                } catch (error) {
                    console.error('Error updating performance review:', error);
                    showNotification('Failed to update performance review', 'error');
                }
            });
        }
        
        function closeEditReviewModal() {
            const modal = document.getElementById('editReviewModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Delete performance review (works with orphaned reviews)
        async function deletePerformanceReview(email) {
            if (confirm(`Are you sure you want to delete the performance review for ${email}?`)) {
                try {
                    // Remove from local performanceReviews object
                    if (performanceReviews[email]) {
                        delete performanceReviews[email];
                        console.log(`✅ Performance review for ${email} deleted from local data`);
                        
                        // Try API first, but don't fail if it doesn't work
                        try {
                            const response = await fetch(`/api/performance/${email}`, {
                                method: 'DELETE',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            });
                            
                            if (response.ok) {
                                console.log(`✅ Performance review for ${email} deleted via API`);
                            } else {
                                console.warn(`⚠️ API deletion failed for ${email}, but local deletion succeeded`);
                            }
                        } catch (apiError) {
                            console.warn(`⚠️ API deletion failed for ${email}, but local deletion succeeded:`, apiError);
                        }
                        
                        // Update GitHub with the modified data
                        await updatePerformanceReviewsOnGitHub();
                        
                        showNotification(`Performance review for ${email} deleted successfully!`, 'success');
                        
                        // Refresh the performance reviews display
                        showPerformanceReviewManager();
                    } else {
                        showNotification(`Performance review for ${email} not found`, 'error');
                    }
                } catch (error) {
                    console.error('Error deleting performance review:', error);
                    showNotification(`Failed to delete performance review: ${error.message}`, 'error');
                }
            }
        }
        
        // View performance review details
        function viewPerformanceReview(email) {
            const review = performanceReviews[email];
            if (!review) {
                showNotification('Performance review not found', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'viewReviewModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            const reviewDate = review.reviewDate ? new Date(review.reviewDate).toLocaleDateString() : 'N/A';
            const lastUpdated = review.lastUpdated ? new Date(review.lastUpdated).toLocaleString() : 'N/A';
            
            modal.innerHTML = `
                <div style="
                    background: #1a1a1a;
                    padding: 2rem;
                    border-radius: 12px;
                    max-width: 600px;
                    max-height: 80vh;
                    overflow-y: auto;
                    position: relative;
                    border: 1px solid #FFB200;
                ">
                    <button onclick="closeViewReviewModal()" 
                            style="
                                position: absolute;
                                top: 1rem;
                                right: 1rem;
                                background: #ef4444;
                                color: white;
                                border: none;
                                padding: 0.5rem;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 30px;
                                height: 30px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                font-weight: bold;
                            ">×</button>
                    <h3 style="color: #FFB200; margin-bottom: 1rem;">👁️ Performance Review Details</h3>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">Review for: ${email}</p>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Overall Rating</h4>
                        <div style="font-size: 2rem; color: #FFB200; margin-bottom: 0.5rem;">${review.overallRating}/5</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                            Review Date: ${reviewDate} | Last Updated: ${lastUpdated}
                        </div>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Category Ratings</h4>
                        ${Object.entries(review.categories || {}).map(([category, rating]) => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span style="color: white;">${category}:</span>
                                <span style="color: #FFB200; font-weight: bold;">${rating}/5</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${review.comments ? `
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Comments</h4>
                            <p style="color: white; line-height: 1.5;">${review.comments}</p>
                        </div>
                    ` : ''}
                    
                    ${review.adminNotes ? `
                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Admin Notes</h4>
                            <p style="color: white; line-height: 1.5;">${review.adminNotes}</p>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button onclick="editPerformanceReview('${email}')" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ✏️ Edit Review
                        </button>
                        <button onclick="closeViewReviewModal()" style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeViewReviewModal() {
            const modal = document.getElementById('viewReviewModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Update job status from modal
        async function updateJobStatus(freelancerName, jobId) {
            const projectStatusSelect = document.getElementById(`projectStatus_${jobId}`);
            const paymentStatusSelect = document.getElementById(`paymentStatus_${jobId}`);
            
            if (!projectStatusSelect) {
                showNotification('Project status element not found', 'error');
                return;
            }
            
            const newProjectStatus = projectStatusSelect.value;
            const newPaymentStatus = paymentStatusSelect ? paymentStatusSelect.value : null;
            
            // Update the job in the user's jobs
            if (users[freelancerName] && users[freelancerName].jobs && users[freelancerName].jobs[jobId]) {
                users[freelancerName].jobs[jobId].projectStatus = newProjectStatus;
                
                // Update payment status if available
                if (newPaymentStatus) {
                    users[freelancerName].jobs[jobId].paymentStatus = newPaymentStatus;
                }
                
                // Save to localStorage
                localStorage.setItem('users', JSON.stringify(users));
                
                // Update GitHub
                await updateUsersOnGitHub();
                
                // Close modal
                document.querySelector('div[style*="position: fixed"]').remove();
                
                showNotification(`✅ Updated project status for ${freelancerName} - ${jobId}\nProject: ${newProjectStatus}`, 'success');
                
                // Check for performance review if payment status is "paid"
                if (newPaymentStatus === 'paid') {
                    console.log(`⭐ Payment completed for ${freelancerName}, triggering performance review workflow...`);
                    
                    // Add immediate notification
                    addNotification(
                        'Performance Review Needed',
                        `${freelancerName} has completed a paid project and needs a performance review.`,
                        'performance'
                    );
                    
                    // Show immediate alert
                    showImmediatePerformanceReviewAlert(freelancerName);
                    
                    // Trigger immediate performance review check
                    setTimeout(async () => {
                        await checkForNewPerformanceReviews();
                    }, 1000);
                    
                    showNotification(`⭐ Performance review workflow triggered for ${freelancerName}`, 'info');
                }
                
                // Refresh the display
                displayUsers();
            } else {
                showNotification('Job not found in user data', 'error');
            }
        }
        
        // ==================== AUTOMATIC JSON GENERATION ====================
        
        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication status
            const session = sessionStorage.getItem('adminDashboardAuthenticated');
            if (session === 'true') {
                isAuthenticated = true;
                showAdminInterface();
                
                // Initialize notification system
                updateNotificationBadge();
                
                // Close notification dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    const container = document.querySelector('.notification-container');
                    const dropdown = document.getElementById('notificationDropdown');
                    if (container && dropdown && !container.contains(event.target)) {
                        dropdown.style.display = 'none';
                    }
                });
            }
        });

        // ==================== PROFESSIONAL NOTIFICATION SYSTEM ====================
        
        // Enhanced notification system to replace all alert() calls
        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            const icon = getNotificationIcon(type);
            const colors = getNotificationColors(type);
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                background: ${colors.background};
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                border: 1px solid ${colors.border};
                max-width: 400px;
                min-width: 300px;
                backdrop-filter: blur(10px);
                transform: translateX(100%);
                transition: transform 0.3s ease-out;
                font-family: 'Poppins', sans-serif;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <div style="font-size: 1.2rem; margin-top: 2px;">${icon}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">
                            ${type.toUpperCase()}
                        </div>
                        <div style="font-size: 0.95rem; line-height: 1.4;">
                            ${message}
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="
                                background: rgba(255,255,255,0.2);
                                color: white;
                                border: none;
                                padding: 4px;
                                border-radius: 50%;
                                cursor: pointer;
                                width: 24px;
                                height: 24px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 14px;
                                margin-left: 8px;
                                transition: background 0.2s;
                            "
                            onmouseover="this.style.background='rgba(255,255,255,0.3)'"
                            onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        ×
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Auto-remove after duration
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, duration);
        }
        
        function getNotificationIcon(type) {
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️',
                loading: '🔄',
                contract: '📄',
                payment: '💰',
                performance: '⭐',
                github: '🐙',
                email: '📧',
                job: '🎯',
                freelancer: '👤'
            };
            return icons[type] || icons.info;
        }
        
        function getNotificationColors(type) {
            const colors = {
                success: {
                    background: 'linear-gradient(135deg, #22c55e, #16a34a)',
                    border: 'rgba(34, 197, 94, 0.3)'
                },
                error: {
                    background: 'linear-gradient(135deg, #ef4444, #dc2626)',
                    border: 'rgba(239, 68, 68, 0.3)'
                },
                warning: {
                    background: 'linear-gradient(135deg, #f59e0b, #d97706)',
                    border: 'rgba(245, 158, 11, 0.3)'
                },
                info: {
                    background: 'linear-gradient(135deg, #3b82f6, #2563eb)',
                    border: 'rgba(59, 130, 246, 0.3)'
                },
                loading: {
                    background: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                    border: 'rgba(139, 92, 246, 0.3)'
                },
                contract: {
                    background: 'linear-gradient(135deg, #06b6d4, #0891b2)',
                    border: 'rgba(6, 182, 212, 0.3)'
                },
                payment: {
                    background: 'linear-gradient(135deg, #10b981, #059669)',
                    border: 'rgba(16, 185, 129, 0.3)'
                },
                performance: {
                    background: 'linear-gradient(135deg, #f59e0b, #d97706)',
                    border: 'rgba(245, 158, 11, 0.3)'
                },
                github: {
                    background: 'linear-gradient(135deg, #333, #24292e)',
                    border: 'rgba(51, 51, 51, 0.3)'
                },
                email: {
                    background: 'linear-gradient(135deg, #ec4899, #db2777)',
                    border: 'rgba(236, 72, 153, 0.3)'
                },
                job: {
                    background: 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                    border: 'rgba(139, 92, 246, 0.3)'
                },
                freelancer: {
                    background: 'linear-gradient(135deg, #06b6d4, #0891b2)',
                    border: 'rgba(6, 182, 212, 0.3)'
                }
            };
            return colors[type] || colors.info;
        }
        
        // Enhanced showUpdateStatus function (backward compatibility)
        function showUpdateStatus(message, type) {
            showNotification(message, type);
        }
        
        // Replace all alert() calls with professional notifications
        function showAlert(message, type = 'info') {
            showNotification(message, type);
        }

        // ==================== BELL NOTIFICATION SYSTEM ====================
        
        // Notification System
        let notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
        
        function addNotification(title, message, type = 'info') {
            const notification = {
                id: Date.now() + Math.random(),
                title: title,
                message: message,
                type: type,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            notifications.unshift(notification);
            localStorage.setItem('adminNotifications', JSON.stringify(notifications));
            updateNotificationBadge();
            updateNotificationList();
        }
        
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                const unreadCount = notifications.filter(n => !n.read).length;
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'block' : 'none';
            }
        }
        
        function updateNotificationList() {
            const list = document.getElementById('notificationList');
            if (!list) return;
            
            if (notifications.length === 0) {
                list.innerHTML = `
                    <div class="no-notifications">
                        <i class="fas fa-bell-slash"></i>
                        <p>No notifications</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = notifications.map(notification => `
                <div class="notification-item ${notification.read ? 'read' : 'unread'}" onclick="markAsRead(${notification.id})">
                    <div class="notification-title">
                        <i class="fas fa-${getNotificationIcon(notification.type)}"></i>
                        ${notification.title}
                    </div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">${formatNotificationTime(notification.timestamp)}</div>
                </div>
            `).join('');
        }
        
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            if (dropdown) {
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                updateNotificationList();
            }
        }
        
        function markAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                localStorage.setItem('adminNotifications', JSON.stringify(notifications));
                updateNotificationBadge();
                updateNotificationList();
            }
        }
        
        function clearAllNotifications() {
            notifications = [];
            localStorage.setItem('adminNotifications', JSON.stringify(notifications));
            updateNotificationBadge();
            updateNotificationList();
        }
        
        function formatNotificationTime(timestamp) {
            const now = new Date();
            const notificationTime = new Date(timestamp);
            const diffMs = now - notificationTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return notificationTime.toLocaleDateString();
        }

        // ==================== MODAL MANAGEMENT ====================
        
        // Universal modal close function
        function closeModal(button) {
            const modal = button.closest('div[style*="position: fixed"]');
            if (modal) {
                modal.remove();
            }
        }
        
        // Enhanced notification for JSON updates
        function notifyJSONUpdate(fileName, action, details = '') {
            const messages = {
                'freelancers.json': {
                    'updated': `✅ Freelancer data updated successfully!`,
                    'payment': `💰 Payment status updated for freelancer`,
                    'performance': `⭐ Performance review saved successfully!`
                },
                'jobs-data.json': {
                    'updated': `🎯 Job data updated successfully!`,
                    'assigned': `✅ Job assigned to freelancer successfully!`
                },
                'project-status.json': {
                    'updated': `📊 Project status updated successfully!`,
                    'payment': `💰 Payment status updated for project`
                },
                'performance.json': {
                    'updated': `⭐ Performance review data updated successfully!`,
                    'created': `⭐ New performance review created!`
                },
                'uploaded-contracts.json': {
                    'updated': `📄 Contract data updated successfully!`,
                    'uploaded': `📄 New contract uploaded successfully!`
                }
            };
            
            const fileMessages = messages[fileName] || {};
            const message = fileMessages[action] || `✅ ${fileName} updated successfully!`;
            
            showNotification(`${message} ${details}`, 'success');
        }

        // Real-time Performance Review System
        let performanceReviewPollingInterval = null;
        let lastPerformanceCheck = 0;
        
        // Initialize real-time performance review monitoring
        function initializePerformanceReviewMonitoring() {
            console.log('🔄 Initializing real-time performance review monitoring...');
            
            // Start polling for performance reviews every 30 seconds
            performanceReviewPollingInterval = setInterval(async () => {
                await checkForNewPerformanceReviews();
            }, 30000); // 30 seconds
            
            // Initial check
            setTimeout(async () => {
                await checkForNewPerformanceReviews();
            }, 2000); // Check after 2 seconds
            
            // Update monitoring status
            updateMonitoringStatus(true);
            
            console.log('✅ Real-time performance review monitoring started');
        }
        
        // Check for new performance reviews that need attention
        async function checkForNewPerformanceReviews() {
            try {
                console.log('🔍 Checking for new performance reviews...');
                
                // Reload users and performance reviews to get latest data
                await loadUsers();
                await loadPerformanceReviews();
                
                // Find users who need performance reviews
                const pendingReviews = Object.values(users).filter(userData => {
                    return shouldShowPerformanceReview(userData);
                });
                
                console.log(`📊 Found ${pendingReviews.length} pending performance reviews`);
                
                // Update performance review alerts
                updatePerformanceReviewAlerts(pendingReviews);
                
                // Check for new notifications that need to be added
                await checkForNewPerformanceNotifications(pendingReviews);
                
                lastPerformanceCheck = Date.now();
                
            } catch (error) {
                console.error('❌ Error checking performance reviews:', error);
            }
        }
        
        // Update performance review alerts in real-time
        function updatePerformanceReviewAlerts(pendingReviews) {
            const existingAlert = document.getElementById('performanceReviewAlert');
            
            if (pendingReviews.length > 0) {
                if (!existingAlert) {
                    // Create new alert
                    const alertContainer = document.createElement('div');
                    alertContainer.id = 'performanceReviewAlert';
                    alertContainer.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #f59e0b, #d97706);
                        color: white;
                        padding: 1rem;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        z-index: 10000;
                        max-width: 350px;
                        animation: slideInRight 0.3s ease-out;
                    `;
                    
                    alertContainer.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <h4 style="margin: 0; color: white;"><i class="fas fa-star"></i> Performance Reviews Due</h4>
                            <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;">×</button>
                        </div>
                        <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem;">
                            ${pendingReviews.length} freelancer${pendingReviews.length > 1 ? 's' : ''} need${pendingReviews.length > 1 ? '' : 's'} performance review.
                        </p>
                        <button onclick="showPerformanceReviewList()" 
                                style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                            View All Reviews
                        </button>
                    `;
                    
                    document.body.appendChild(alertContainer);
                    
                    // Auto-hide after 10 seconds
                    setTimeout(() => {
                        if (alertContainer.parentNode) {
                            alertContainer.remove();
                        }
                    }, 10000);
                } else {
                    // Update existing alert
                    const countElement = existingAlert.querySelector('p');
                    if (countElement) {
                        countElement.innerHTML = `${pendingReviews.length} freelancer${pendingReviews.length > 1 ? 's' : ''} need${pendingReviews.length > 1 ? '' : 's'} performance review.`;
                    }
                }
            } else {
                // Remove alert if no pending reviews
                if (existingAlert) {
                    existingAlert.remove();
                }
            }
        }
        
        // Check for new performance notifications that need to be added
        async function checkForNewPerformanceNotifications(pendingReviews) {
            try {
                // Get existing notifications
                const existingNotifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
                
                // Check each pending review
                for (const userData of pendingReviews) {
                    const userEmail = userData.profile?.email;
                    if (!userEmail) continue;
                    
                    // Check if notification already exists for this user
                    const existingNotification = existingNotifications.find(n => 
                        n.type === 'performance' && 
                        n.message.includes(userData.name || userEmail)
                    );
                    
                    // If no notification exists, add one
                    if (!existingNotification) {
                        addNotification(
                            'Performance Review Needed',
                            `${userData.name || userEmail} has completed a paid project and needs a performance review.`,
                            'performance'
                        );
                        
                        console.log(`📢 Added performance review notification for ${userData.name || userEmail}`);
                    }
                }
                
            } catch (error) {
                console.error('❌ Error checking performance notifications:', error);
            }
        }
        
        // Enhanced payment status update with immediate performance review trigger
        async function updatePaymentStatusWithPerformanceReview(userName, paymentStatus) {
            console.log(`🔄 Updating payment status for ${userName} to ${paymentStatus}...`);
            
            const userData = users[userName];
            if (!userData) {
                showNotification('User not found', 'error');
                return;
            }
            
            // Update user's payment status
            userData.paymentStatus = paymentStatus;
            
            // Update all jobs for this user
            if (userData.jobs) {
                Object.values(userData.jobs).forEach(job => {
                    job.paymentStatus = paymentStatus;
                });
            }
            
            // Save to localStorage
            localStorage.setItem('users', JSON.stringify(users));
            
            // Update GitHub
            try {
                await updateUsersOnGitHub();
                showNotification(`✅ Payment status updated for ${userName}!\nStatus: ${paymentStatus}`, 'success');
                
                // Immediate performance review trigger for paid status
                if (paymentStatus === 'paid') {
                    console.log(`⭐ Payment completed for ${userName}, triggering performance review workflow...`);
                    
                    // Add immediate notification
                    addNotification(
                        'Performance Review Needed',
                        `${userName} has completed a paid project and needs a performance review.`,
                        'performance'
                    );
                    
                    // Show immediate alert
                    showImmediatePerformanceReviewAlert(userName);
                    
                    // Trigger immediate performance review check
                    setTimeout(async () => {
                        await checkForNewPerformanceReviews();
                    }, 1000);
                    
                    showNotification(`⭐ Performance review workflow triggered for ${userName}`, 'info');
                }
                
            } catch (error) {
                console.error('❌ Error updating GitHub:', error);
                showNotification(`⚠️ Payment status saved locally but GitHub update failed: ${error.message}`, 'warning');
            }
            
            // Refresh the display
            displayUsers();
        }
        
        // Show immediate performance review alert
        function showImmediatePerformanceReviewAlert(userName) {
            const alertContainer = document.createElement('div');
            alertContainer.id = 'immediatePerformanceAlert';
            alertContainer.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #f59e0b, #d97706);
                color: white;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.4);
                z-index: 10001;
                max-width: 400px;
                text-align: center;
                animation: pulse 2s infinite;
            `;
            
            alertContainer.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <i class="fas fa-star" style="font-size: 3rem; color: #FFD700;"></i>
                </div>
                <h3 style="margin: 0 0 1rem 0; color: white;">Performance Review Required</h3>
                <p style="margin: 0 0 1.5rem 0; font-size: 1.1rem;">
                    ${userName} has completed a paid project and needs a performance review.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button onclick="showPerformanceReviewModal('${userName}'); this.closest('div').remove();" 
                            style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                        Review Now
                    </button>
                    <button onclick="this.closest('div').remove()" 
                            style="background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 0.75rem 1.5rem; border-radius: 6px; cursor: pointer;">
                        Later
                    </button>
                </div>
            `;
            
            document.body.appendChild(alertContainer);
            
            // Auto-hide after 15 seconds
            setTimeout(() => {
                if (alertContainer.parentNode) {
                    alertContainer.remove();
                }
            }, 15000);
        }
        
        // Cleanup function for performance review monitoring
        function cleanupPerformanceReviewMonitoring() {
            if (performanceReviewPollingInterval) {
                clearInterval(performanceReviewPollingInterval);
                performanceReviewPollingInterval = null;
                console.log('🔄 Performance review monitoring stopped');
            }
            
            // Update monitoring status
            updateMonitoringStatus(false);
        }
        
        // Update monitoring status indicator
        function updateMonitoringStatus(isActive) {
            const statusElement = document.getElementById('monitoringStatus');
            if (statusElement) {
                if (isActive) {
                    statusElement.style.background = 'rgba(34, 197, 94, 0.2)';
                    statusElement.style.borderColor = '#22c55e';
                    statusElement.style.color = '#22c55e';
                    statusElement.innerHTML = `
                        <i class="fas fa-circle" style="font-size: 0.6rem; animation: pulse 2s infinite;"></i>
                        <span>Real-time Monitoring Active</span>
                    `;
                } else {
                    statusElement.style.background = 'rgba(239, 68, 68, 0.2)';
                    statusElement.style.borderColor = '#ef4444';
                    statusElement.style.color = '#ef4444';
                    statusElement.innerHTML = `
                        <i class="fas fa-circle" style="font-size: 0.6rem;"></i>
                        <span>Monitoring Inactive</span>
                    `;
                }
            }
        }
        
        // Manual performance review check
        async function manualPerformanceReviewCheck() {
            console.log('🔄 Manual performance review check triggered...');
            
            try {
                // Show loading notification
                showNotification('Checking for performance reviews...', 'info');
                
                // Perform the check
                await checkForNewPerformanceReviews();
                
                // Show completion notification
                const pendingReviews = Object.values(users).filter(userData => {
                    return shouldShowPerformanceReview(userData);
                });
                
                if (pendingReviews.length > 0) {
                    showNotification(`Found ${pendingReviews.length} pending performance review${pendingReviews.length > 1 ? 's' : ''}`, 'success');
                } else {
                    showNotification('No pending performance reviews found', 'info');
                }
                
            } catch (error) {
                console.error('❌ Error during manual performance review check:', error);
                showNotification('Error checking performance reviews', 'error');
            }
        }
        
        // Add CSS for animations
        const performanceReviewStyles = document.createElement('style');
        performanceReviewStyles.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes pulse {
                0% { transform: translate(-50%, -50%) scale(1); }
                50% { transform: translate(-50%, -50%) scale(1.05); }
                100% { transform: translate(-50%, -50%) scale(1); }
            }
        `;
        document.head.appendChild(performanceReviewStyles);
    </script>
    
    <style>
        :root {
            --primary: #FFB200;
            --primary-dark: #FF9000;
            --gold: #FFD700;
            --black: #000000;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray-medium: #6c757d;
            --gray-dark: #343a40;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('https://static.wixstatic.com/media/aeef42_a910287f24764299afec1bfd88559221~mv2.gif') center center fixed;
            background-size: cover;
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: -1;
        }
        
        /* Login Screen Styles */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            position: relative;
            overflow: hidden;
        }
        
        .login-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(255,178,0,0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .login-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 3rem;
            border-radius: 16px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.5),
                0 0 0 1px rgba(255,178,0,0.2);
            text-align: center;
            max-width: 450px;
            width: 100%;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .login-logo {
            width: 140px;
            height: auto;
            margin-bottom: 2rem;
            filter: 
                drop-shadow(0 0 3px #FFB200)
                drop-shadow(0 0 6px #FFB200)
                drop-shadow(2px 2px 0px #000000);
            animation: logoGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes logoGlow {
            0% {
                filter: 
                    drop-shadow(0 0 3px #FFB200)
                    drop-shadow(0 0 6px #FFB200)
                    drop-shadow(2px 2px 0px #000000);
            }
            100% {
                filter: 
                    drop-shadow(0 0 5px #FFB200)
                    drop-shadow(0 0 8px #FFB200)
                    drop-shadow(2px 2px 0px #000000);
            }
        }
        
        .login-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .login-subtitle {
            color: rgba(255,255,255,0.8);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .login-form {
            text-align: left;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #FFB200;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-group input {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            font-size: 1rem;
            color: #fff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .form-group input:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.6);
            border-color: #FFB200;
            box-shadow: 0 0 0 2px rgba(255, 178, 0, 0.2);
        }
        
        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFB200;
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .login-btn:hover::before {
            transform: scaleX(1);
        }
        
        .login-btn:hover {
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
            backdrop-filter: blur(10px);
        }
        
        /* Main Admin Interface Styles */
        .admin-interface {
            display: none;
            min-height: 100vh;
            position: relative;
            z-index: 1;
            position: relative;
        }
        
        .admin-interface::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(255,178,0,0.05) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .header {
            background: rgba(0,0,0,0.4);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 2rem;
        }
        
        .header-left {
            flex: 1;
        }
        
        .header-left h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #FFB200;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .header-left p {
            color: rgba(255,255,255,0.8);
            font-size: 1.1rem;
            margin: 0;
        }
        
        .header-right {
            display: flex;
            align-items: center;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .quick-links {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-decoration: none;
        }
        
        .action-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: #FFB200;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255,178,0,0.2);
        }
        
        .link-btn {
            background: rgba(0, 0, 0, 0.6);
            border-color: rgba(255, 178, 0, 0.5);
            color: #FFB200;
        }
        
        .link-btn:hover {
            background: rgba(255, 178, 0, 0.1);
            border-color: #FFB200;
        }
        
        .notification-bell {
            background: rgba(0, 0, 0, 0.6);
            border-color: rgba(255, 178, 0, 0.5);
            color: #FFB200;
        }
        
        .notification-bell:hover {
            background: rgba(255, 178, 0, 0.1);
            border-color: #FFB200;
        }
        
        /* Notification System Styles */
        .notification-container {
            position: relative;
            display: inline-block;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 350px;
            max-height: 400px;
            background: #1a1a1a;
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            margin-top: 0.5rem;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 178, 0, 0.2);
        }

        .notification-header h3 {
            color: #FFB200;
            margin: 0;
            font-size: 1rem;
        }

        .clear-all-btn {
            background: none;
            border: none;
            color: #FFB200;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .clear-all-btn:hover {
            background: rgba(255, 178, 0, 0.1);
        }

        .notification-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 178, 0, 0.1);
            transition: background 0.3s ease;
        }

        .notification-item:hover {
            background: rgba(255, 178, 0, 0.05);
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .no-notifications {
            text-align: center;
            padding: 2rem;
            color: rgba(255,255,255,0.6);
        }

        .no-notifications i {
            font-size: 2rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .logout-btn {
            background: rgba(0, 0, 0, 0.6);
            border-color: rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }
        
        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .header-top {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }
            
            .header-left h1 {
                font-size: 2rem;
            }
            
            .header-actions {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .quick-links {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .header-left h1 {
                font-size: 1.8rem;
            }
            
            .action-btn {
                padding: 0.6rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .action-btn span {
                display: none;
            }
            
            .quick-links {
                gap: 0.25rem;
            }
        }
        
        /* Tab Navigation */
        .tab-navigation {
            background: rgba(0,0,0,0.4);
            padding: 1rem 2rem;
            margin: 0 2rem 2rem 2rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .tab-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            background: rgba(255, 178, 0, 0.1);
            border: 1px solid rgba(255, 178, 0, 0.3);
            color: #FFB200;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tab-btn:hover {
            background: rgba(255, 178, 0, 0.2);
            border-color: #FFB200;
        }
        
        .tab-btn.active {
            background: #FFB200;
            color: #000;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            margin: 2rem;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Common Form Styles */
        .form-section {
            background: rgba(0,0,0,0.4);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .form-section h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: #FFB200;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .workflow-info {
            background: rgba(255,178,0,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,178,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .workflow-info p {
            color: rgba(255,255,255,0.9);
            margin-bottom: 1rem;
        }
        
        .workflow-info ol {
            color: rgba(255,255,255,0.8);
            padding-left: 1.5rem;
        }
        
        .workflow-info li {
            margin-bottom: 0.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #FFB200;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(15px);
        }
        
        input::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.6);
            border-color: #FFB200;
            box-shadow: 0 0 0 2px rgba(255, 178, 0, 0.2);
        }
        
        textarea {
            height: 100px;
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            background: linear-gradient(135deg, #FFB200, #FFD700);
            color: #000;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            margin-right: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #FFB200;
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn:hover::before {
            transform: scaleX(1);
        }
        
        .btn:hover {
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,178,0,0.4);
        }
        
        /* List Styles */
        .list-section {
            background: rgba(0,0,0,0.4);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        .list-section h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: #FFB200;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }
        
        .item-card {
            border: 1px solid rgba(255,178,0,0.3);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .item-card:hover {
            border-color: #FFB200;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255,178,0,0.2);
        }
        
        .item-card h3 {
            margin: 0 0 0.5rem 0;
            color: #FFB200;
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
        }
        
        .item-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            flex-wrap: wrap;
        }
        
        .item-description {
            margin: 1rem 0;
            line-height: 1.6;
            color: rgba(255,255,255,0.9);
        }
        
        .actions {
            margin-top: 1rem;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        /* Upload section styles removed - manual upload functionality no longer needed */
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .login-container {
                margin: 1rem;
                padding: 2rem;
            }
            
            .header, .tab-navigation, .tab-content {
                margin: 1rem;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                justify-content: center;
            }
            
            .item-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn {
                margin-bottom: 0.5rem;
                width: 100%;
            }
        }

        /* Export Section Styles */
        .export-section {
            background: rgba(0, 0, 0, 0.8);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,178,0,0.2);
            position: relative;
            z-index: 2;
        }

        .export-section h2 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: #FFB200;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 10px rgba(255,178,0,0.3);
        }

        .export-section pre {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 178, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: #fff;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
            white-space: pre-wrap;
        }
        
        /* Notification System Styles */
        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,178,0,0.1);
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .notification-item:hover {
            background: rgba(255,178,0,0.05);
        }
        
        .notification-item.unread {
            background: rgba(255,178,0,0.1);
        }
        
        .notification-item.read {
            opacity: 0.7;
        }
        
        .notification-title {
            font-weight: bold;
            color: #FFB200;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .notification-message {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .notification-time {
            color: rgba(255,255,255,0.5);
            font-size: 0.8rem;
        }
        
        .no-notifications {
            text-align: center;
            padding: 2rem;
            color: rgba(255,255,255,0.5);
        }
        
        .no-notifications i {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <img src="https://static.wixstatic.com/media/aeef42_d31420a75a164d2cb4508bdd7d99ca88~mv2.png" alt="Cochran Films" class="login-logo">
            <h1 class="login-title">⚙️ Admin Dashboard</h1>
            <p class="login-subtitle">Manage jobs and contracts from one central location</p>
            
            <div id="errorMessage" class="error-message">
                Incorrect password. Please try again.
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" value="admin" readonly style="background: rgba(255,255,255,0.1);">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn">🔐 Login</button>
            </form>
        </div>
    </div>

    <!-- Main Admin Interface -->
    <div id="adminInterface" class="admin-interface">
        <div class="header">
            <!-- Modern Header Layout -->
            <div class="header-top">
                <div class="header-left">
                    <h1><i class="fas fa-cogs"></i> Admin Dashboard</h1>
                    <p>Cochran Films - Central Management System</p>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <div class="quick-links">
                            <a href="https://collaborate.cochranfilms.com" class="action-btn link-btn">
                                <i class="fas fa-list"></i>
                                <span>Job Listings</span>
                            </a>
                            <a href="contract.html" class="action-btn link-btn">
                                <i class="fas fa-file-contract"></i>
                                <span>Contracts</span>
                            </a>
                            <a href="user-portal.html" class="action-btn link-btn">
                                <i class="fas fa-users"></i>
                                <span>User Portal</span>
                            </a>
                            <a href="backend.html" class="action-btn link-btn">
                                <i class="fas fa-cogs"></i>
                                <span>Backend Docs</span>
                            </a>
                            <button class="action-btn link-btn" onclick="showPerformanceReviewManager()">
                                <i class="fas fa-star"></i>
                                <span>Performance Reviews</span>
                            </button>
                            <button class="action-btn link-btn" onclick="manualPerformanceReviewCheck()">
                                <i class="fas fa-sync-alt"></i>
                                <span>Check Reviews</span>
                            </button>
                            <div class="monitoring-status" id="monitoringStatus" style="
                                background: rgba(34, 197, 94, 0.2);
                                border: 1px solid #22c55e;
                                color: #22c55e;
                                padding: 0.5rem 1rem;
                                border-radius: 6px;
                                font-size: 0.8rem;
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                            ">
                                <i class="fas fa-circle" style="font-size: 0.6rem; animation: pulse 2s infinite;"></i>
                                <span>Real-time Monitoring Active</span>
                            </div>
                        </div>
                        
                        <div class="notification-container">
                            <button class="action-btn notification-bell" onclick="toggleNotifications()" id="notificationBell">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                            </button>
                            <div class="notification-dropdown" id="notificationDropdown" style="display: none;">
                                <div class="notification-header">
                                    <h3><i class="fas fa-bell"></i> Notifications</h3>
                                    <button onclick="clearAllNotifications()" class="clear-all-btn">
                                        <i class="fas fa-trash"></i> Clear All
                                    </button>
                                </div>
                                <div class="notification-list" id="notificationList"></div>
                            </div>
                        </div>
                        
                        <button class="action-btn logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('jobs')">
                    <span>📋</span> Job Listings
                </button>
                <button class="tab-btn" onclick="switchTab('contracts')">
                    <span>👥</span> Creator Management
                </button>

            </div>
        </div>

        <!-- Jobs Tab -->
        <div id="jobs-tab" class="tab-content active">

                
                <h2>Add/Edit Job</h2>
                <form id="jobForm">
                    <div class="form-group">
                        <label for="jobTitle">Job Title *</label>
                        <input type="text" id="jobTitle" name="title" placeholder="Enter job title" required>
                    </div>
                    <div class="form-group">
                        <label for="jobDate">Event Date</label>
                        <input type="datetime-local" id="jobDate" name="date">
                    </div>
                    <div class="form-group">
                        <label for="jobLocation">Location</label>
                        <select id="jobLocation" name="location" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a location...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jobPay">Pay Rate</label>
                        <select id="jobPay" name="pay" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a rate...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="jobDescription">Description</label>
                        <textarea id="jobDescription" name="description" placeholder="Describe the role, requirements, and responsibilities..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="jobStatus">Status</label>
                        <select id="jobStatus" name="status">
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Save Job</button>
                    <button type="button" class="btn" onclick="clearJobForm()">Clear Form</button>
                </form>
            </div>

            <div class="list-section">
                <h2>Current Jobs</h2>
                <div id="jobsList"></div>
            </div>


        </div>

        <!-- Contracts Tab -->
        <div id="contracts-tab" class="tab-content">

                
                <h2>Add/Edit Creator</h2>
                <form id="contractForm">
                    <div class="form-group">
                        <label for="freelancerName">Full Name *</label>
                        <input type="text" id="freelancerName" name="name" placeholder="Enter creator's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="freelancerEmail">Email Address *</label>
                        <input type="email" id="freelancerEmail" name="email" placeholder="Enter creator's email address" required>
                    </div>
                    <div class="form-group">
                        <label for="freelancerPassword" style="color: rgba(255,255,255,0.6);">Portal Password</label>
                        <input type="text" id="freelancerPassword" name="password" placeholder="Password will be set by creator during contract signing" readonly style="background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.6);">
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            🔄 Password will be set automatically when creator signs their contract
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="contractUrl">Contract URL *</label>
                        <input type="text" id="contractUrl" name="contractUrl" placeholder="contract.html" value="contract.html" readonly style="background: rgba(255,255,255,0.1);">
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            📝 All creators use the same contract.html portal. No individual files needed!
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="freelancerRole">Role *</label>
                        <select id="freelancerRole" name="role" required style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a role...</option>
                            <option value="Backdrop Photographer">Backdrop Photographer</option>
                            <option value="Editor">Editor</option>
                            <option value="Videographer">Videographer</option>
                            <option value="Photographer">Photographer</option>
                            <option value="Full Stack Designer">Full Stack Designer</option>
                            <option value="Video Editor">Video Editor</option>
                            <option value="Corporate Videographer">Corporate Videographer</option>
                        </select>
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            💡 Based on existing roles in your system
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="freelancerLocation">Project Location</label>
                        <select id="freelancerLocation" name="location" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a location...</option>
                            <option value="6695 Church Street, Douglasville, GA 30134">6695 Church Street, Douglasville, GA 30134</option>
                            <option value="Sandy Springs, GA">Sandy Springs, GA</option>
                            <option value="Douglasville, GA">Douglasville, GA</option>
                            <option value="Atlanta, GA">Atlanta, GA</option>
                            <option value="Atlanta Area">Atlanta Area</option>
                        </select>
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            📍 Based on existing locations in your system
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="projectStart">Project Start Date & Time</label>
                        <input type="datetime-local" id="projectStart" name="projectStart" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            📅 Select date and time for project start
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="freelancerRate">Rate *</label>
                        <select id="freelancerRate" name="rate" required style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                            <option value="">Select a rate...</option>
                            <option value="$400.00 USD (Flat)">$400.00 USD (Flat)</option>
                            <option value="$900.00 USD (Flat)">$900.00 USD (Flat)</option>
                            <option value="$300 + Tip">$300 + Tip</option>
                            <option value="$450.00 USD (Flat)">$450.00 USD (Flat)</option>
                            <option value="$750.00 USD (Flat)">$750.00 USD (Flat)</option>
                            <option value="$500.00 USD (Flat)">$500.00 USD (Flat)</option>
                        </select>
                        <small style="color: rgba(255,255,255,0.7); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                            💰 Based on existing rates in your system
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="approvedDate">Approved Date</label>
                        <input type="date" id="approvedDate" name="approvedDate" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                    </div>
                    <button type="submit" class="btn">Save Freelancer</button>
                    <button type="button" class="btn" onclick="clearContractForm()">Clear Form</button>
                </form>
            </div>

            <div class="list-section">
                <h2>Current Creators</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <p style="color: rgba(255,255,255,0.7); margin: 0;">Manage your creator contracts and assignments</p>
                        <p id="freelancerStatus" style="color: #22c55e; margin: 0.25rem 0 0 0; font-size: 0.9rem;">Loading creators...</p>
                    </div>
                    <button class="btn" onclick="refreshFreelancers()" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white;">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
                <div id="contractsList"></div>
                
                <!-- Uploaded Contracts Section -->
                <div style="margin-top: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: #FFB200; margin: 0;">📋 Uploaded Contracts</h3>
                        <button class="btn btn-danger" onclick="bulkDeleteContracts()" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                            <i class="fas fa-trash"></i> Bulk Delete Selected
                        </button>
                    </div>
                    <div id="contractAnalytics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;"></div>
                    <div id="uploadedContractsList"></div>
                </div>
            </div>

            <!-- Job Assignment Section -->
            <div class="form-section">
                <h2>🎯 Assign Additional Jobs to Creators</h2>
                <div class="workflow-info">
                    <p><strong>Additional Job Assignment:</strong> Assign extra jobs to creators using managed dropdown options. The primary job is automatically created from the creator details when you save them.</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">Select Creator</h3>
                        <select id="jobAssignmentFreelancer" style="margin-bottom: 1rem;">
                            <option value="">Choose a creator...</option>
                        </select>
                        
                        <div id="freelancerJobInfo" style="display: none; background: rgba(255,178,0,0.1); padding: 1rem; border-radius: 8px; border: 1px solid rgba(255,178,0,0.3); margin-bottom: 1rem;">
                            <h4 style="color: #FFB200; margin-bottom: 0.5rem;">Current Jobs:</h4>
                            <div id="currentJobsList"></div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 style="color: #22c55e; margin-bottom: 1rem;">Add New Job</h3>
                        <form id="jobAssignmentForm">
                            <div class="form-group">
                                <label for="jobId">Job ID *</label>
                                <input type="text" id="jobId" placeholder="e.g., job-001" required>
                            </div>
                            <div class="form-group">
                                <label for="jobRole">Role</label>
                                <select id="jobRole" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a role...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobLocation">Location</label>
                                <select id="assignmentJobLocation" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a location...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobProjectStart">Project Start</label>
                                <input type="datetime-local" id="assignmentJobProjectStart" placeholder="Select date and time">
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobRate">Rate</label>
                                <select id="assignmentJobRate" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a rate...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobStatus">Status</label>
                                <select id="assignmentJobStatus">
                                    <option value="upcoming">Upcoming</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobProjectType">Project Type</label>
                                <select id="assignmentJobProjectType" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.5); border: 1px solid #FFB200; color: white; border-radius: 6px;">
                                    <option value="">Select a project type...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="assignmentJobDescription">Description</label>
                                <textarea id="assignmentJobDescription" placeholder="Describe the job requirements..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="primaryJobCheckbox">
                                    <input type="checkbox" id="primaryJobCheckbox" style="width: auto; margin-right: 0.5rem;">
                                    Set as Primary Job
                                </label>
                            </div>
                            <button type="submit" class="btn">Add Job</button>
                        </form>
                    </div>
                </div>
            </div>



            <!-- Dropdown Options Management Section -->
            <div class="form-section">
                <h2>⚙️ Manage Dropdown Options</h2>
                <div class="workflow-info">
                    <p><strong>Dropdown Management:</strong> Add and manage options for dropdown selectors throughout the admin dashboard. These options are automatically loaded from dropdown-options.json and saved to GitHub for persistence across sessions.</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <!-- Roles Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">🎯 Roles</h3>
                        <div class="form-group">
                            <input type="text" id="newRole" placeholder="Add new role (e.g., Videographer)" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('roles', 'newRole')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Role
                            </button>
                        </div>
                        <div id="rolesList" style="margin-top: 1rem;">
                            <!-- Roles will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Locations Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">📍 Locations</h3>
                        <div class="form-group">
                            <input type="text" id="newLocation" placeholder="Add new location (e.g., Atlanta, GA)" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('locations', 'newLocation')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Location
                            </button>
                        </div>
                        <div id="locationsList" style="margin-top: 1rem;">
                            <!-- Locations will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Rates Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">💰 Rates</h3>
                        <div class="form-group">
                            <input type="text" id="newRate" placeholder="Add new rate (e.g., $500.00 USD (Flat))" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('rates', 'newRate')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Rate
                            </button>
                        </div>
                        <div id="ratesList" style="margin-top: 1rem;">
                            <!-- Rates will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Project Types Management -->
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(255,178,0,0.2);">
                        <h3 style="color: #FFB200; margin-bottom: 1rem;">🎬 Project Types</h3>
                        <div class="form-group">
                            <input type="text" id="newProjectType" placeholder="Add new project type (e.g., Corporate Video)" style="margin-bottom: 0.5rem;">
                            <button class="btn btn-small" onclick="addDropdownOption('projectTypes', 'newProjectType')" style="background: #22c55e;">
                                <i class="fas fa-plus"></i> Add Project Type
                            </button>
                        </div>
                        <div id="projectTypesList" style="margin-top: 1rem;">
                            <!-- Project types will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; text-align: center;">
                    <button class="btn" onclick="saveDropdownOptions()" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white;">
                        <i class="fas fa-save"></i> Save All Dropdown Options
                    </button>
                    <button class="btn" onclick="loadDropdownOptions()" style="background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; margin-left: 1rem;">
                        <i class="fas fa-sync"></i> Refresh Options
                    </button>
                </div>
            </div>


        </div>




</body>
</html>

